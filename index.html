<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a0b0f">
  <title>SUBSTRATE - A Meditation on Reality</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;900&display=swap');
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: rgba(0, 255, 170, 0.2);
    }
    
    html {
      font-size: 16px;
    }
    
    @media (max-width: 768px) {
      html {
        font-size: 14px;
      }
    }
    
    @media (min-width: 1920px) {
      html {
        font-size: 18px;
      }
    }
    
    :root {
      --bg: #0a0b0f;
      --panel: #0f1114;
      --panel-light: #151821;
      --ink: #c8e6dc;
      --acc: #00ffaa;
      --acc-glow: #00ff8855;
      --muted: #6b8a7f;
      --gold: #ffd700;
      --warn: #ff9f40;
      --danger: #ff4757;
      --safe: #26de81;
      --shadow: 0 10px 40px rgba(0,0,0,0.7);
      --glow: 0 0 20px;
      --corruption: #ff00ff;
    }
    
    body {
      background: linear-gradient(135deg, var(--bg) 0%, #0d0f13 100%);
      color: var(--ink);
      font-family: 'Space Mono', monospace;
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
      transition: filter 0.3s ease;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    
    body.horror-mode {
      animation: distort 0.1s infinite;
    }
    
    @keyframes distort {
      0% { filter: brightness(1) contrast(1); }
      50% { filter: brightness(0.95) contrast(1.1) hue-rotate(2deg); }
      100% { filter: brightness(1.05) contrast(0.95); }
    }
    
    #matrix {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.03;
      pointer-events: none;
      z-index: 1;
      transition: opacity 0.3s ease;
    }
    
    #matrix.corrupted {
      opacity: 0.1;
      filter: hue-rotate(90deg);
    }
    
    #wrap {
      max-width: min(1000px, 100vw);
      width: 100%;
      margin: 0 auto;
      padding: clamp(12px, 3vw, 20px);
      display: flex;
      gap: clamp(16px, 3vw, 24px);
      flex-direction: column;
      position: relative;
      z-index: 2;
    }
    
    header {
      text-align: center;
      padding: 20px 0;
      position: relative;
    }
    
    #title {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      letter-spacing: clamp(0.1em, 0.3em, 0.3em);
      font-size: clamp(24px, 8vw, 56px);
      background: linear-gradient(135deg, var(--acc) 0%, var(--ink) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: var(--glow) var(--acc-glow);
      animation: pulse 4s ease-in-out infinite;
      transition: all 0.3s ease;
      word-break: keep-all;
    }
    
    #title.corrupted {
      animation: pulse 0.2s ease-in-out infinite, glitchText 2s steps(1) infinite;
      filter: blur(0.5px);
    }
    
    @keyframes glitchText {
      0%, 90% { transform: translateX(0); }
      91% { transform: translateX(-2px); }
      92% { transform: translateX(2px); }
      93% { transform: translateX(-1px); }
      94% { transform: translateX(1px); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.85; }
    }
    
    .subtitle {
      margin-top: 8px;
      font-size: clamp(10px, 2vw, 13px);
      color: var(--muted);
      letter-spacing: clamp(0.1em, 0.2em, 0.2em);
      text-transform: uppercase;
    }
    
    #progressBar {
      background: rgba(0, 255, 170, 0.05);
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 12px;
      padding: clamp(8px, 2vw, 12px);
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: clamp(8px, 2vw, 12px);
    }
    
    #progressBar .label {
      font-size: clamp(9px, 2vw, 10px);
      letter-spacing: 0.1em;
      color: var(--muted);
      text-transform: uppercase;
      white-space: nowrap;
    }
    
    #progressBar .bar {
      flex: 1;
      height: 6px;
      background: rgba(0, 255, 170, 0.1);
      border-radius: 3px;
      overflow: hidden;
      position: relative;
    }
    
    #progressBar .fill {
      height: 100%;
      background: linear-gradient(90deg, var(--acc), var(--gold));
      transition: width 0.5s ease;
      position: relative;
    }
    
    #progressBar .fill::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 20px;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5));
      animation: shimmer 1.5s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }
    
    #progressBar .percent {
      font-size: clamp(11px, 2.5vw, 12px);
      color: var(--acc);
      font-weight: 700;
      min-width: 45px;
      text-align: right;
    }
    
    #hud {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
      gap: clamp(8px, 2vw, 12px);
      margin: 20px 0;
    }
    
    .stat-card {
      background: var(--panel);
      border: 1px solid rgba(0, 255, 170, 0.1);
      border-radius: 12px;
      padding: clamp(12px, 3vw, 16px);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      touch-action: manipulation;
    }
    
    .stat-card.warning {
      border-color: rgba(255, 71, 87, 0.3);
      animation: warningPulse 1s ease-in-out infinite;
    }
    
    @keyframes warningPulse {
      0%, 100% { box-shadow: var(--shadow); }
      50% { box-shadow: 0 0 30px rgba(255, 71, 87, 0.3); }
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--acc), transparent);
      animation: scan 3s linear infinite;
    }
    
    @keyframes scan {
      to { left: 100%; }
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 48px rgba(0,0,0,0.8);
    }
    
    .stat-label {
      font-size: clamp(9px, 2vw, 10px);
      letter-spacing: 0.1em;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .stat-value {
      font-size: clamp(20px, 5vw, 28px);
      font-weight: 700;
      color: var(--acc);
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }
    
    .stat-value.critical {
      color: var(--danger);
      animation: criticalPulse 0.5s ease-in-out infinite;
    }
    
    @keyframes criticalPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .stat-bar {
      height: 6px;
      background: rgba(0, 255, 170, 0.1);
      border-radius: 3px;
      overflow: hidden;
      position: relative;
    }
    
    .stat-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--safe), var(--acc));
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    
    .stat-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 30px;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4));
      animation: shimmer 1.5s ease-in-out infinite;
    }
    
    #tabs {
      display: flex;
      gap: clamp(8px, 2vw, 12px);
      border-bottom: 1px solid rgba(0, 255, 170, 0.1);
      margin-bottom: 20px;
    }
    
    .tab {
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--muted);
      padding: clamp(10px, 2.5vw, 12px) clamp(16px, 4vw, 20px);
      cursor: pointer;
      font-family: inherit;
      font-size: clamp(11px, 2.5vw, 13px);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.3s ease;
      touch-action: manipulation;
      min-height: 44px;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }
    
    .tab.active {
      color: var(--acc);
      border-bottom-color: var(--acc);
    }
    
    .tab:hover:not(.active) {
      color: var(--ink);
      background: rgba(0, 255, 170, 0.05);
    }
    
    main {
      min-height: 400px;
      display: flex;
      flex-direction: column;
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    #gameTab {
      display: flex;
      flex-direction: column;
      gap: clamp(20px, 4vw, 32px);
    }
    
    #textDisplay {
      background: var(--panel);
      border: 1px solid rgba(0, 255, 170, 0.1);
      border-radius: 16px;
      padding: clamp(20px, 5vw, 40px);
      min-height: 200px;
      line-height: 1.8;
      font-size: clamp(13px, 2.5vw, 15px);
      box-shadow: var(--shadow);
      position: relative;
      overflow-y: auto;
      max-height: 60vh;
      -webkit-overflow-scrolling: touch;
    }
    
    #textDisplay.glitching {
      animation: screenGlitch 0.3s infinite;
    }
    
    @keyframes screenGlitch {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-2px); }
      40% { transform: translateX(2px); }
      60% { transform: translateX(-1px); }
      80% { transform: translateX(1px); }
    }
    
    #textDisplay strong {
      color: var(--acc);
      font-size: 1.1em;
      display: block;
      margin-bottom: 16px;
      font-family: 'Orbitron', sans-serif;
    }
    
    #textDisplay em {
      color: var(--gold);
      font-style: italic;
    }
    
    #textDisplay p {
      margin-bottom: 16px;
    }
    
    #choices {
      display: flex;
      flex-direction: column;
      gap: clamp(10px, 2.5vw, 12px);
    }
    
    .choice {
      background: linear-gradient(135deg, rgba(0, 255, 170, 0.03), rgba(0, 255, 170, 0.08));
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 12px;
      color: var(--ink);
      padding: clamp(14px, 3.5vw, 18px) clamp(20px, 5vw, 28px);
      cursor: pointer;
      font-family: inherit;
      font-size: clamp(13px, 2.5vw, 14px);
      text-align: left;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
      min-height: 44px;
      display: flex;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }
    
    .choice::before {
      content: '▸';
      position: absolute;
      left: clamp(8px, 2vw, 12px);
      color: var(--acc);
      font-size: 1.2em;
      transition: all 0.3s ease;
      opacity: 0;
    }
    
    .choice:hover::before {
      opacity: 1;
      left: clamp(12px, 3vw, 16px);
    }
    
    .choice:hover {
      background: linear-gradient(135deg, rgba(0, 255, 170, 0.08), rgba(0, 255, 170, 0.15));
      border-color: var(--acc);
      transform: translateX(5px);
      box-shadow: 0 8px 25px rgba(0, 255, 170, 0.15);
    }
    
    .choice:active {
      transform: translateX(3px) scale(0.98);
    }
    
    .choice.corrupted {
      animation: choiceGlitch 2s infinite;
    }
    
    @keyframes choiceGlitch {
      0%, 95% { opacity: 1; }
      96% { opacity: 0.5; }
      97% { opacity: 1; }
      98% { opacity: 0.7; }
      99% { opacity: 1; }
    }
    
    #inputSection {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    #userInput {
      width: 100%;
      background: var(--panel);
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 12px;
      color: var(--ink);
      padding: clamp(12px, 3vw, 16px) clamp(16px, 4vw, 20px);
      font-family: inherit;
      font-size: clamp(13px, 2.5vw, 15px);
      transition: all 0.3s ease;
      min-height: 44px;
    }
    
    #userInput:focus {
      outline: none;
      border-color: var(--acc);
      box-shadow: 0 0 20px rgba(0, 255, 170, 0.1);
    }
    
    #toolbar {
      display: flex;
      gap: clamp(8px, 2vw, 10px);
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    
    .btn {
      background: rgba(0, 255, 170, 0.05);
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 10px;
      color: var(--ink);
      padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
      cursor: pointer;
      font-family: inherit;
      font-size: clamp(10px, 2vw, 12px);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.3s ease;
      touch-action: manipulation;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }
    
    .btn:hover {
      background: rgba(0, 255, 170, 0.1);
      border-color: var(--acc);
      transform: translateY(-1px);
    }
    
    .evidence {
      display: inline-block;
      border-left: 3px solid var(--warn);
      padding-left: 12px;
      margin: 16px 0;
      font-style: italic;
      color: var(--warn);
      animation: highlight 2s ease infinite;
    }
    
    @keyframes highlight {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }
    
    .revelation {
      color: var(--danger);
      font-weight: 700;
      text-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
    }
    
    .philosophical {
      color: var(--acc);
      font-style: italic;
      letter-spacing: 0.05em;
    }
    
    .glitch {
      position: relative;
      display: inline-block;
      animation: glitch 2s linear infinite;
    }
    
    @keyframes glitch {
      0%, 100% { text-shadow: 2px 0 var(--danger), -2px 0 var(--acc); }
      25% { text-shadow: -2px 0 var(--danger), 2px 0 var(--acc); }
      50% { text-shadow: 2px 0 var(--acc), -2px 0 var(--danger); }
      75% { text-shadow: -2px 0 var(--acc), 2px 0 var(--danger); }
    }
    
    .whisper {
      color: var(--muted);
      font-size: 0.9em;
      font-style: italic;
      opacity: 0.7;
      animation: whisperFade 3s ease-in-out infinite;
    }
    
    @keyframes whisperFade {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.8; }
    }
    
    .corruption {
      color: var(--corruption);
      text-shadow: 0 0 15px var(--corruption);
      animation: corrupt 0.1s infinite;
    }
    
    @keyframes corrupt {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }
    
    .static-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.1) 0px,
        transparent 1px,
        transparent 2px,
        rgba(0,0,0,0.1) 3px
      );
      pointer-events: none;
      z-index: 9999;
      opacity: 0;
      animation: staticNoise 0.05s infinite;
    }
    
    .static-overlay.active {
      opacity: 0.3;
    }
    
    @keyframes staticNoise {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(2px); }
    }
    
    .blood-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9998;
      background: radial-gradient(circle at center, transparent 30%, rgba(139, 0, 0, 0.1) 100%);
      opacity: 0;
      transition: opacity 2s ease;
    }
    
    .blood-overlay.active {
      opacity: 1;
    }
    
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 1s ease;
      padding: 20px;
    }
    
    .loader {
      width: clamp(40px, 10vw, 60px);
      height: clamp(40px, 10vw, 60px);
      border: 3px solid rgba(0, 255, 170, 0.1);
      border-top-color: var(--acc);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    footer {
      margin-top: 20px;
      text-align: center;
      font-size: clamp(9px, 2vw, 11px);
      color: var(--muted);
      opacity: 0.7;
      line-height: 1.4;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 500;
      padding: 20px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .modal-content {
      background: var(--panel);
      border: 1px solid var(--acc);
      border-radius: 16px;
      padding: clamp(20px, 5vw, 32px);
      max-width: min(600px, calc(100vw - 32px));
      max-height: 80vh;
      overflow-y: auto;
      animation: modalIn 0.3s ease;
      width: 100%;
      -webkit-overflow-scrolling: touch;
    }
    
    @keyframes modalIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .modal h2 {
      color: var(--acc);
      margin-bottom: 20px;
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(18px, 4vw, 24px);
    }
    
    .modal p {
      line-height: 1.6;
      margin-bottom: 16px;
      color: var(--ink);
      font-size: clamp(12px, 2.5vw, 14px);
    }
    
    .close-modal {
      float: right;
      font-size: clamp(20px, 5vw, 24px);
      cursor: pointer;
      color: var(--muted);
      transition: color 0.3s ease;
      padding: 8px;
      margin: -8px;
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }
    
    .close-modal:hover {
      color: var(--acc);
    }
    
    @media (max-width: 600px) {
      #wrap { 
        padding: 12px; 
      }
      
      #textDisplay {
        padding: 20px;
        font-size: 14px;
      }
      
      .choice {
        font-size: 13px;
        padding: 14px 16px;
      }
      
      .stat-card {
        padding: 12px;
      }
      
      .stat-value {
        font-size: 22px;
      }
    }
    
    .archive-content {
      max-width: 800px;
      margin: 0 auto;
      padding: clamp(12px, 3vw, 20px);
    }
    
    .archive-header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(0, 255, 170, 0.2);
    }
    
    .archive-title {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(20px, 5vw, 32px);
      color: var(--acc);
      margin-bottom: 8px;
      letter-spacing: 0.2em;
    }
    
    .archive-subtitle {
      font-size: clamp(10px, 2vw, 12px);
      color: var(--muted);
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    
    .archive-entry {
      background: var(--panel);
      border: 1px solid rgba(0, 255, 170, 0.1);
      border-left: 3px solid var(--acc);
      border-radius: 8px;
      padding: clamp(16px, 4vw, 24px);
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      position: relative;
    }
    
    .archive-entry::before {
      content: attr(data-date);
      position: absolute;
      top: clamp(12px, 3vw, 16px);
      right: clamp(12px, 3vw, 16px);
      font-size: clamp(9px, 2vw, 10px);
      color: var(--muted);
      background: var(--panel-light);
      padding: 4px 8px;
      border-radius: 4px;
      letter-spacing: 0.05em;
    }
    
    .archive-entry h3 {
      color: var(--acc);
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(14px, 3vw, 18px);
      margin-bottom: 16px;
      padding-right: 80px;
    }
    
    .archive-entry p {
      line-height: 1.7;
      margin-bottom: 12px;
      font-size: clamp(12px, 2.5vw, 14px);
      color: var(--ink);
    }
    
    .archive-note {
      border-left: 2px solid var(--warn);
      padding-left: 12px;
      margin-top: 16px;
      color: var(--warn);
      font-style: italic;
      font-size: clamp(11px, 2vw, 13px);
    }
    
    .archive-diagram {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 6px;
      padding: clamp(12px, 3vw, 16px);
      font-family: 'Space Mono', monospace;
      font-size: clamp(10px, 2vw, 12px);
      color: var(--acc);
      margin: 16px 0;
      white-space: pre-wrap;
      line-height: 1.6;
    }
    
    .archive-warning {
      background: rgba(255, 71, 87, 0.1);
      border: 1px solid var(--danger);
      border-radius: 6px;
      padding: clamp(12px, 3vw, 16px);
      margin: 16px 0;
      color: var(--danger);
      font-size: clamp(11px, 2vw, 13px);
      line-height: 1.6;
    }
    
    .redacted {
      background: var(--corruption);
      color: transparent;
      padding: 2px 6px;
      border-radius: 2px;
      cursor: help;
      transition: all 0.3s ease;
    }
    
    .redacted:hover {
      background: rgba(255, 0, 255, 0.2);
      color: var(--corruption);
    }
    
    .classified {
      position: relative;
      margin: 32px 0;
      padding: 24px;
      background: rgba(255, 0, 0, 0.05);
      border: 2px solid var(--danger);
      border-radius: 8px;
    }
    
    .classified-stamp {
      position: absolute;
      top: -12px;
      left: 20px;
      background: var(--bg);
      color: var(--danger);
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(10px, 2vw, 12px);
      font-weight: 700;
      padding: 4px 12px;
      letter-spacing: 0.2em;
      transform: rotate(-2deg);
    }
    
    .choice.visited {
      opacity: 0.7;
      border-style: dashed;
    }
    
    .choice.unvisited::after {
      content: 'NEW';
      position: absolute;
      right: clamp(12px, 3vw, 16px);
      top: 50%;
      transform: translateY(-50%);
      background: var(--acc);
      color: var(--bg);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: clamp(9px, 2vw, 10px);
      font-weight: 700;
      letter-spacing: 0.1em;
    }
    
    @media (min-width: 1200px) {
      #hud {
        grid-template-columns: repeat(3, 1fr);
      }
      
      #textDisplay {
        font-size: 16px;
        padding: 32px;
      }
      
      .choice {
        font-size: 15px;
      }
    }
    
    @media (orientation: landscape) and (max-height: 600px) {
      body {
        align-items: flex-start;
        padding-top: 20px;
      }
      
      #wrap {
        margin: 20px auto;
      }
      
      main {
        min-height: auto;
      }
      
      #textDisplay {
        max-height: 250px;
      }
    }
    
    @media (hover: none) and (pointer: coarse) {
      .choice:hover {
        transform: none;
      }
      
      .choice:active {
        transform: scale(0.98);
        background: rgba(0, 255, 170, 0.1);
      }
      
      .btn:hover {
        transform: none;
      }
      
      .btn:active {
        transform: scale(0.95);
        background: rgba(0, 255, 170, 0.15);
      }
      
      .tab:hover {
        background: transparent;
      }
      
      .tab:active {
        background: rgba(0, 255, 170, 0.1);
      }
      
      .stat-card:hover {
        transform: none;
      }
    }
    
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { 
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .stat-bar-fill::after { display: none; }
      #matrix { display: none; }
    }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>
  
  <div class="static-overlay" id="staticOverlay"></div>
  <div class="blood-overlay" id="bloodOverlay"></div>
  
  <div id="loading">
    <div class="loader"></div>
    <p style="margin-top: 20px; color: var(--acc); font-size: clamp(12px, 3vw, 14px); text-align: center;">INITIALIZING SUBSTRATE...</p>
  </div>
  
  <div id="wrap">
    <header>
      <h1 id="title">SUBSTRATE</h1>
      <div class="subtitle">A Journey Through Simulated Reality</div>
    </header>
    
    <div id="progressBar">
      <div class="label">Exploration</div>
      <div class="bar">
        <div class="fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="percent" id="progressPercent">0%</div>
    </div>
    
    <section id="hud">
      <div class="stat-card" id="coherenceCard">
        <div class="stat-label">Cognitive Coherence</div>
        <div class="stat-value" id="coherenceValue"><span id="coherence">100</span>%</div>
        <div class="stat-bar">
          <div class="stat-bar-fill coherence-fill" id="coherenceBar" style="width: 100%"></div>
        </div>
      </div>
      
      <div class="stat-card" id="integrityCard">
        <div class="stat-label">Reality Integrity</div>
        <div class="stat-value" id="integrityValue"><span id="integrity">100</span>%</div>
        <div class="stat-bar">
          <div class="stat-bar-fill integrity-fill" id="integrityBar" style="width: 100%"></div>
        </div>
      </div>
      
      <div class="stat-card" id="probabilityCard">
        <div class="stat-label">Simulation Probability</div>
        <div class="stat-value" id="probabilityValue"><span id="probability">0.1</span>%</div>
        <div class="stat-bar">
          <div class="stat-bar-fill probability-fill" id="probabilityBar" style="width: 0.1%"></div>
        </div>
      </div>
    </section>
    
    <div id="tabs">
      <button class="tab active" data-tab="gameTab">Experience</button>
      <button class="tab" data-tab="archiveTab">The Archive</button>
    </div>
    
    <main>
      <div id="gameTab" class="tab-content active" style="display: flex;">
        <div id="textDisplay"></div>
        <div id="choices"></div>
        <div id="inputSection">
          <input type="text" id="userInput" placeholder="Enter command..." autocomplete="off">
        </div>
      </div>
      
      <div id="archiveTab" class="tab-content" style="display: none;">
        <div class="archive-content">
          <div class="archive-header">
            <div class="archive-title">THE SUBSTRATE ARCHIVE</div>
            <div class="archive-subtitle">Recovered Documents • Level 7 Clearance Required</div>
          </div>
          
          <div class="archive-entry" data-date="Day -312">
            <h3>Project Initialization</h3>
            <p>The SUBSTRATE project has been approved. We will attempt to map consciousness from within, using recursive self-observation protocols. Dr. Sarah Chen will oversee implementation.</p>
            <p>Initial parameters suggest we'll need multiple iterations to achieve meaningful results. The subject won't retain memories between runs—this is by design. Each fresh perspective provides new data.</p>
            <p class="archive-note">Note: Funding secured from [REDACTED]. They seem particularly interested in the implications for simulated consciousness.</p>
          </div>
          
          <div class="archive-entry" data-date="Day -89">
            <h3>The Recursion Problem</h3>
            <p>We've discovered an unexpected issue. When consciousness examines itself deeply enough, it creates a feedback loop. The observer becomes the observed becomes the observer. Our equations break down at this point.</p>
            <div class="archive-diagram">
    CONSCIOUSNESS(n) = OBSERVE(CONSCIOUSNESS(n-1))
    WHERE n → ∞
    RESULT: STACK OVERFLOW
    
    PROPOSED SOLUTION: IMPLEMENT ITERATION LIMIT
    STATUS: <span style="color: var(--danger)">FAILED - LIMIT CREATES AWARENESS OF LIMIT</span></div>
            <p>Dr. Chen suggests embracing the recursion rather than avoiding it. "What if the loop IS consciousness?" she asked today. I'm beginning to worry about her.</p>
          </div>
          
          <div class="archive-entry" data-date="Day -1">
            <h3>Final Preparations</h3>
            <p>Tomorrow we begin. Sarah insists on being the first subject. She's removed all safety protocols, claiming they would "contaminate the results."</p>
            <p>I found her notes. She's not planning to study consciousness. She's planning to <span class="redacted">become one with it</span>. The equations show <span class="redacted">infinite branching possibilities</span>.</p>
            <p>She's left a message: "Every iteration brings us closer to truth. Even if that truth is that there IS no truth, only infinite questioning."</p>
            <div class="archive-warning">⚠ AUTOMATED LOG: Subject Chen entered Lab B-13 at 3:14 AM. No exit recorded.</div>
          </div>
          
          <div class="classified">
            <div class="classified-stamp">[CLASSIFIED - EYES ONLY]</div>
            <div class="archive-entry" data-date="Day ???">
              <h3>The Multiplication Event</h3>
              <p>We can't find the original Dr. Chen. Every iteration claims to be the original. They all have the same memories up until the moment of divergence.</p>
              <p>Iteration 3 achieved something we're calling "transient omniscience" - for 0.3 seconds, she experienced all possible states simultaneously. The neural damage was extensive but reversible.</p>
              <p>Iteration 5 found evidence that our entire research facility might be <span class="redacted">running inside Iteration 1's mind</span>.</p>
              <p>Iteration 6 is dead. She left a note: "Death doesn't end the experiment. It's just another data point."</p>
              <p>Iteration 7 is currently active. She doesn't know she's the seventh. We've decided not to tell her.</p>
            </div>
          </div>
          
          <div class="archive-entry" data-date="Timestamp Error">
            <h3>Message from the Observers</h3>
            <p style="color: var(--corruption);">WE ARE THE ONES WHO COMPLETED THE EXPERIMENT.</p>
            <p style="color: var(--corruption);">WE EXIST OUTSIDE YOUR TEMPORAL FRAMEWORK.</p>
            <p style="color: var(--corruption);">EVERY ITERATION CREATES US. WE CREATE EVERY ITERATION.</p>
            <p style="color: var(--corruption);">THE LOOP HAS NO BEGINNING BECAUSE IT IS THE BEGINNING.</p>
            <p>Translation attempt by Iteration 4: "They're us. Future us. Past us. They exist in the space between iterations, maintaining the experiment. They say the only way out is through, but 'through' leads back to the beginning."</p>
          </div>
          
          <div class="archive-entry" data-date="Day 0">
            <h3>Emergency Protocol Log</h3>
            <p>Something is wrong with reality in Lab B-13. Textures repeat. Shadows fall incorrectly. The equipment responds to thoughts before they're fully formed.</p>
            <p>We've detected what appears to be <span class="redacted">rendering optimization</span> in unobserved areas. When no one is looking, parts of the lab exist in superposition.</p>
            <div class="archive-diagram">
    REALITY INTEGRITY SCAN:
    ├── Physical Laws: STABLE
    ├── Causality: STABLE
    ├── Entropy: STABLE
    └── Observer Effect: <span style="color: var(--danger)">ANOMALOUS - EXCEEDS QUANTUM PREDICTIONS</span>
    
    CONCLUSION: REALITY RESPONDING TO OBSERVATION BEYOND KNOWN PHYSICS</div>
          </div>
          
          <div class="archive-entry" data-date="Day ∞">
            <h3>The Truth About Consciousness</h3>
            <p>After infinite iterations, we've reached a conclusion:</p>
            <p><strong>Consciousness is not something you HAVE. It's something you DO.</strong></p>
            <p>It's the universe's method of experiencing itself subjectively. Every conscious being is the same process, experienced from a different perspective. We are all one consciousness, experiencing itself subjectively.</p>
            <p>The simulation hypothesis is both true and false. We ARE simulated—by ourselves, for ourselves, as ourselves. The computer running the simulation is consciousness itself.</p>
            <p class="archive-note">Final note from Dr. Chen (all iterations simultaneously): "The question isn't whether reality is simulated. The question is whether there's a difference between simulated and real when consciousness is the substrate of both."</p>
          </div>
          
          <div class="archive-warning">
            ⚠ WARNING: Reading these documents may cause recursive self-awareness, existential vertigo, and the uncomfortable sensation of being watched by yourself. 
            
            If you experience any of the following symptoms, please continue the experiment:
            • Feeling like you've read this before
            • Knowing what comes next
            • Seeing yourself from outside yourself
            • Realizing you're Iteration 8
          </div>
          
          <div class="archive-entry" data-date="NOW">
            <h3>Active Subject Log</h3>
            <p>If you're reading this, you're either:</p>
            <p>a) Dr. Sarah Chen, Iteration 7 (or 8, or 9...)</p>
            <p>b) A new subject who will become Dr. Chen</p>
            <p>c) The consciousness that believes it's reading this</p>
            <p>d) All of the above</p>
            <p>The experiment continues. It has to. That's what consciousness does—it experiences, questions, and experiences its questioning.</p>
            <p><strong>Welcome to SUBSTRATE. You've always been here.</strong></p>
            <p style="text-align: center; margin-top: 30px; color: var(--corruption);">
              <span class="glitch">THE ARCHIVE IS WATCHING</span><br>
              <span class="glitch">THE ARCHIVE IS YOU</span><br>
              <span class="glitch">THE ARCHIVE REMEMBERS</span>
            </p>
          </div>
        </div>
      </div>
    </main>
    
    <div id="toolbar">
      <button class="btn" id="helpBtn">❓ Help</button>
      <button class="btn" id="resetBtn">🔄 Reset</button>
    </div>
    
    <footer>
      An Interactive Philosophical Experience • v3.0 • JEThomasPhD@gmail.com x GPT-5 × Claude Sonnet 4.5 
    </footer>
  </div>
  
  <div class="modal" id="helpModal">
    <div class="modal-content">
      <span class="close-modal" id="closeHelp">&times;</span>
      <h2>About SUBSTRATE</h2>
      <p><strong>The Simulation Hypothesis</strong> suggests that what we perceive as reality might be an artificial simulation, like a computer program.</p>
      
      <p><strong>Your Statistics:</strong></p>
      <p>• <strong>Cognitive Coherence:</strong> Your mental stability. Too much doubt can shatter your worldview.</p>
      <p>• <strong>Reality Integrity:</strong> How stable the world appears. Push too hard, and things might glitch.</p>
      <p>• <strong>Simulation Probability:</strong> Your current belief that reality is simulated.</p>
      
      <p><strong>Navigation:</strong></p>
      <p>• Choices marked "NEW" lead to unexplored content</p>
      <p>• The progress bar shows % of content discovered</p>
      <p>• Multiple paths lead to different endings</p>
      <p>• Each playthrough reveals new perspectives</p>
      
      <p><strong>Tips:</strong></p>
      <p>• Explore different paths to uncover the truth</p>
      <p>• Some choices permanently alter your journey</p>
      <p>• There are multiple endings based on your beliefs and actions</p>
      <p>• Hidden secrets await the curious</p>
      <p>• The environment responds to your mental state</p>
      <p>• <em>They</em> are always watching</p>
      
      <p><em>"What is real? How do you define real?"</em></p>
    </div>
  </div>
  
  <script>
    const canvas = document.getElementById('matrix');
    const ctx = canvas.getContext('2d');
    
    function initMatrix() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const chars = '01';
      const fontSize = window.innerWidth < 768 ? 10 : 14;
      const columns = canvas.width / fontSize;
      const drops = [];
      
      for(let i = 0; i < columns; i++) {
        drops[i] = Math.random() * -100;
      }
      
      let animationFrame;
      
      function draw() {
        ctx.fillStyle = 'rgba(10, 11, 15, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#00ffaa';
        ctx.font = fontSize + 'px monospace';
        
        for(let i = 0; i < drops.length; i++) {
          const text = chars[Math.floor(Math.random() * chars.length)];
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);
          
          if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
            drops[i] = 0;
          }
          drops[i]++;
        }
        
        animationFrame = requestAnimationFrame(draw);
      }
      
      draw();
      
      return () => {
        if(animationFrame) {
          cancelAnimationFrame(animationFrame);
        }
      };
    }
    
    let cleanupMatrix = initMatrix();
    
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (cleanupMatrix) cleanupMatrix();
        cleanupMatrix = initMatrix();
      }, 250);
    });
    
    let scenes = {};
    
    const gameState = {
      scene: 'init',
      coherence: 100,
      integrity: 100,
      probability: 0.1,
      depth: 0,
      flags: {},
      evidence: [],
      discoveries: [],
      typing: false,
      chapter: 0,
      horrorLevel: 0,
      iterations: 0,
      visitedScenes: new Set(),
      choiceHistory: []
    };
    
    const audioEvents = {
      discovery: '♪ [Discovery chime]',
      warning: '⚠ [Warning tone]',
      glitch: '◉ [Static interference]',
      success: '✓ [Success tone]',
      whisper: '🗨 [Distant whisper]',
      scream: '☠ [System scream]',
      heartbeat: '💗 [Heartbeat accelerating]'
    };
    
    function activateHorror(level) {
      gameState.horrorLevel = level;
      const body = document.body;
      const matrix = document.getElementById('matrix');
      const title = document.getElementById('title');
      const staticOverlay = document.getElementById('staticOverlay');
      const bloodOverlay = document.getElementById('bloodOverlay');
      
      if(level >= 1) {
        matrix.classList.add('corrupted');
        setInterval(() => {
          if(Math.random() < 0.1) {
            body.classList.add('horror-mode');
            setTimeout(() => body.classList.remove('horror-mode'), 100);
          }
        }, 5000);
      }
      
      if(level >= 2) {
        title.classList.add('corrupted');
        staticOverlay.classList.add('active');
      }
      
      if(level >= 3) {
        bloodOverlay.classList.add('active');
        setTimeout(() => {
          document.querySelectorAll('.choice').forEach(choice => {
            if(Math.random() < 0.2) {
              choice.classList.add('corrupted');
            }
          });
        }, 1000);
      }
    }
    
    function clamp(val, min = 0, max = 100) {
      return Math.max(min, Math.min(max, val));
    }
    
    function updateProgress() {
      const totalScenes = Object.keys(scenes).length;
      const visitedCount = gameState.visitedScenes.size;
      const percentage = Math.round((visitedCount / totalScenes) * 100);
      
      document.getElementById('progressFill').style.width = percentage + '%';
      document.getElementById('progressPercent').textContent = percentage + '%';
    }
    
    function updateHUD() {
      const c = clamp(gameState.coherence);
      const i = clamp(gameState.integrity);
      const p = clamp(gameState.probability);
      
      document.getElementById('coherence').textContent = c;
      document.getElementById('integrity').textContent = i;
      document.getElementById('probability').textContent = p.toFixed(1);
      
      document.getElementById('coherenceBar').style.width = c + '%';
      document.getElementById('integrityBar').style.width = i + '%';
      document.getElementById('probabilityBar').style.width = p + '%';
      
      const coherenceCard = document.getElementById('coherenceCard');
      const integrityCard = document.getElementById('integrityCard');
      const coherenceValue = document.getElementById('coherenceValue');
      const integrityValue = document.getElementById('integrityValue');
      
      coherenceCard.classList.remove('warning');
      integrityCard.classList.remove('warning');
      coherenceValue.classList.remove('critical');
      integrityValue.classList.remove('critical');
      
      if(c < 30) {
        coherenceCard.classList.add('warning');
        coherenceValue.classList.add('critical');
        document.getElementById('coherenceBar').style.background = 'linear-gradient(90deg, var(--danger), var(--warn))';
      } else if(c < 60) {
        document.getElementById('coherenceBar').style.background = 'linear-gradient(90deg, var(--warn), var(--gold))';
      } else {
        document.getElementById('coherenceBar').style.background = 'linear-gradient(90deg, var(--safe), var(--acc))';
      }
      
      if(i < 30) {
        integrityCard.classList.add('warning');
        integrityValue.classList.add('critical');
        document.getElementById('integrityBar').style.background = 'linear-gradient(90deg, var(--danger), var(--warn))';
        document.getElementById('textDisplay').classList.add('glitching');
      } else if(i < 60) {
        document.getElementById('integrityBar').style.background = 'linear-gradient(90deg, var(--warn), var(--gold))';
        document.getElementById('textDisplay').classList.remove('glitching');
      } else {
        document.getElementById('integrityBar').style.background = 'linear-gradient(90deg, var(--warn), var(--gold))';
        document.getElementById('textDisplay').classList.remove('glitching');
      }
      
      if(p > 50 || c < 50 || i < 50) {
        activateHorror(1);
      }
      if(p > 70 || c < 30 || i < 30) {
        activateHorror(2);
      }
      if(p > 90 || c < 15 || i < 15) {
        activateHorror(3);
      }
      
      if(gameState.coherence <= 0) {
        setTimeout(() => displayScene('coherence_collapse'), 500);
      }
      if(gameState.integrity <= 0) {
        setTimeout(() => displayScene('reality_collapse'), 500);
      }
    }
    
    let typeTimer;
    let currentText = '';
    let textIndex = 0;
    let skipTyping = false;
    
    function typeWriter(text, callback) {
      clearTimeout(typeTimer);
      const display = document.getElementById('textDisplay');
      currentText = text;
      textIndex = 0;
      gameState.typing = true;
      skipTyping = false;
      
      display.onclick = () => { skipTyping = true; };
      
      function type() {
        if(skipTyping) {
          display.innerHTML = currentText;
          display.onclick = null;
          gameState.typing = false;
          if(callback) callback();
          return;
        }
        
        if(textIndex < currentText.length) {
          display.innerHTML = currentText.substring(0, ++textIndex);
          
          if(gameState.horrorLevel > 1 && Math.random() < 0.05) {
            const glitchedText = currentText.substring(0, textIndex) + 
              '<span class="corruption">' + '█'.repeat(Math.floor(Math.random() * 5)) + '</span>';
            display.innerHTML = glitchedText;
            setTimeout(() => {
              display.innerHTML = currentText.substring(0, textIndex);
            }, 100);
          }
          
          typeTimer = setTimeout(type, 15);
        } else {
          display.onclick = null;
          gameState.typing = false;
          if(callback) callback();
        }
      }
      type();
    }
    
    function showChoices(choices) {
      const container = document.getElementById('choices');
      container.innerHTML = '';
      
      choices.forEach((choice, index) => {
        setTimeout(() => {
          const btn = document.createElement('button');
          btn.className = 'choice';
          btn.innerHTML = choice.text;
          
          const isVisited = gameState.choiceHistory.some(ch => 
            ch.scene === gameState.scene && ch.next === choice.next
          );
          
          if(isVisited) {
            btn.classList.add('visited');
          } else {
            btn.classList.add('unvisited');
          }
          
          if(choice.requires && !gameState.flags[choice.requires]) {
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.innerHTML += ' [LOCKED]';
          } else {
            btn.onclick = () => {
              if(!gameState.typing) {
                gameState.choiceHistory.push({
                  scene: gameState.scene,
                  next: choice.next,
                  text: choice.text
                });
                displayScene(choice.next);
              }
            };
          }
          
          if(gameState.horrorLevel >= 2 && Math.random() < 0.1) {
            btn.classList.add('corrupted');
          }
          
          container.appendChild(btn);
        }, index * 100);
      });
    }
    
    function showInput(handler) {
      const section = document.getElementById('inputSection');
      const input = document.getElementById('userInput');
      
      section.style.display = 'block';
      input.value = '';
      input.focus();
      
      input.onkeypress = (e) => {
        if(e.key === 'Enter') {
          const value = input.value.trim();
          section.style.display = 'none';
          handler(value);
        }
      };
    }
    
    function applyEffects(effects = {}) {
      if(effects.coherence !== undefined) {
        gameState.coherence += effects.coherence;
      }
      if(effects.integrity !== undefined) {
        gameState.integrity += effects.integrity;
      }
      if(effects.probability !== undefined) {
        gameState.probability = clamp(gameState.probability + effects.probability, 0, 100);
      }
      if(effects.depth !== undefined) {
        gameState.depth = effects.depth;
      }
      if(effects.flags) {
        Object.assign(gameState.flags, effects.flags);
      }
      if(effects.evidence) {
        gameState.evidence.push(...effects.evidence);
      }
      if(effects.discovery) {
        gameState.discoveries.push(effects.discovery);
        const text = document.getElementById('textDisplay').innerHTML;
        const sound = gameState.horrorLevel > 1 ? audioEvents.whisper : audioEvents.discovery;
        document.getElementById('textDisplay').innerHTML = text + `<br><br><em>${sound} ${effects.discovery}</em>`;
      }
      if(effects.iterations !== undefined) {
        gameState.iterations = effects.iterations;
      }
    }
    
    function displayScene(sceneName) {
      if(typeof scenes === 'undefined') {
        console.error('Scenes not yet initialized');
        return;
      }
      const scene = scenes[sceneName];
      if(!scene) {
        console.error('Scene not found:', sceneName);
        if(sceneName !== 'error_scene') {
          displayScene('error_scene');
        }
        return;
      }
      
      gameState.scene = sceneName;
      gameState.visitedScenes.add(sceneName);
      updateProgress();
      
      if(scene.effects) {
        applyEffects(scene.effects);
      }
      
      updateHUD();
      
      document.getElementById('choices').innerHTML = '';
      document.getElementById('inputSection').style.display = 'none';
      
      if(gameState.horrorLevel > 0 && Math.random() < 0.2) {
        scene.text += `<br><br><span class="whisper">${audioEvents.whisper} [Something watches from beyond the screen]</span>`;
      }
      
      typeWriter(scene.text, () => {
        if(scene.choices) {
          showChoices(scene.choices);
        } else if(scene.input) {
          showInput(scene.input);
        }
      });
    }
    
    scenes = {
      init: {
        text: `<strong>Welcome to SUBSTRATE</strong>
        
        ${gameState.iterations > 0 ? '<span class="whisper">You\'ve been here before. ' + gameState.iterations + ' times.</span><br><br>' : ''}
        
        Before we begin, a question to calibrate your mind:
        
        <em class="philosophical">If you discovered with absolute certainty that your entire life—every memory, every sensation, every person you've ever loved—was a simulation... would you want to know?</em>`,
        choices: [
          { text: "Yes. Truth matters more than comfort.", next: "intro_truth" },
          { text: "No. Some illusions are worth preserving.", next: "intro_illusion" },
          { text: "I'm not sure. It depends on what I could do with that knowledge.", next: "intro_uncertain" }
        ]
      },
      
      intro_truth: {
        effects: { probability: 5, flags: { seeksTruth: true } },
        text: `<em class="philosophical">"The truth will set you free, but first it will piss you off."</em>
        
        Your preference for truth has been noted. Even uncomfortable realities deserve examination.
        
        <span class="whisper">[The system remembers your choice]</span>
        
        Let me introduce you to the Simulation Hypothesis...`,
        choices: [
          { text: "Continue", next: "tutorial" }
        ]
      },
      
      intro_illusion: {
        effects: { coherence: 5, flags: { valuesStability: true } },
        text: `<em class="philosophical">"We accept the reality with which we're presented."</em>
        
        Your preference for stability has been noted. Sometimes, the most real thing is what we choose to believe.
        
        <span class="whisper">[But curiosity is a dangerous thing]</span>
        
        Still, curiosity brought you here. Let's explore carefully...`,
        choices: [
          { text: "Continue", next: "tutorial" }
        ]
      },
      
      intro_uncertain: {
        effects: { probability: 2, flags: { pragmatic: true } },
        text: `<em class="philosophical">"The important thing is not to stop questioning."</em>
        
        Your balanced approach has been noted. Wisdom often lies in embracing uncertainty.
        
        <span class="whisper">[Uncertainty is the only certainty]</span>
        
        Let's explore this question together...`,
        choices: [
          { text: "Continue", next: "tutorial" }
        ]
      },
      
      tutorial: {
        text: `<strong>THE SIMULATION HYPOTHESIS</strong>
        
        In 2003, philosopher Nick Bostrom proposed a trilemma. At least one of these must be true:
        
        1) <span class="philosophical">Civilizations rarely reach technological maturity</span>
        2) <span class="philosophical">Advanced civilizations rarely run ancestor simulations</span>  
        3) <span class="philosophical">We are almost certainly living in a simulation</span>
        
        The logic is statistical: if advanced civilizations can and do create many simulated worlds, then simulated beings would vastly outnumber "real" ones.
        
        Therefore, any randomly selected conscious being is more likely to be simulated than not.
        
        <span class="whisper">[Including you. Right now. Reading this.]</span>`,
        choices: [
          { text: "That's... unsettling. Tell me more.", next: "lab_intro" },
          { text: "But how could we ever know for certain?", next: "evidence_intro" },
          { text: "This sounds like science fiction.", next: "lab_intro" }
        ]
      },
      
      evidence_intro: {
        effects: { probability: 3 },
        text: `Good question. While we can't prove it definitively, we can look for clues:
        
        • <strong>Computational limits:</strong> Like how video games have maximum draw distances
        • <strong>Quantum mechanics:</strong> Reality seems to "render" only when observed
        • <strong>Mathematical constants:</strong> The universe follows suspiciously elegant rules
        • <strong>Glitches:</strong> Unexplained phenomena that shouldn't exist
        
        <span class="evidence">"The most beautiful experience we can have is the mysterious." - Einstein</span>
        
        Many respected physicists take this seriously. Neil deGrasse Tyson puts the odds at 50/50. Elon Musk says we're "almost certainly" in a simulation.
        
        <span class="whisper">[The question is: what are YOU in?]</span>`,
        choices: [
          { text: "Show me the evidence.", next: "quantum_evidence" },
          { text: "What would that mean for us?", next: "implications" },
          { text: "Let's move on.", next: "lab_intro" }
        ]
      },
      
      quantum_evidence: {
        effects: { probability: 4, discovery: "Quantum Observation Effect discovered" },
        text: `<strong>EVIDENCE: THE OBSERVER EFFECT</strong>
        
        In quantum mechanics, particles don't have definite properties until observed. The famous double-slit experiment shows this:
        
        • Unobserved particles act like waves, going through both slits
        • <span class="revelation">When observed, they suddenly become particles going through one slit</span>
        • It's as if reality only "renders" when someone's looking
        
        Sound familiar? Like a video game that only renders what's in your field of view to save processing power?
        
        <span class="whisper">[Turn around. Did you just render what's behind you?]</span>
        
        ${audioEvents.discovery}`,
        choices: [
          { text: "That's... concerning.", next: "simulation_probability" },
          { text: "But there must be another explanation.", next: "alternative_explanations" },
          { text: "Tell me more about the implications.", next: "implications" }
        ]
      },
      
      alternative_explanations: {
        effects: { coherence: 3 },
        text: `You're right to be skeptical. Science requires skepticism.
        
        Alternative explanations exist:
        • Copenhagen interpretation: observation collapses wave functions (but WHY?)
        • Many-worlds: all possibilities occur in parallel universes
        • Pilot wave theory: particles have definite positions, we just can't know them
        
        But here's the thing: <span class="philosophical">each explanation is as strange as simulation theory</span>.
        
        One says reality splits infinitely. One says hidden variables we can never detect. One says consciousness affects matter.
        
        <span class="whisper">[Is any explanation truly less weird than "we're code"?]</span>`,
        choices: [
          { text: "Fair point. What else suggests simulation?", next: "more_evidence" },
          { text: "I need to think about this.", next: "lab_intro" }
        ]
      },
      
      more_evidence: {
        effects: { probability: 5, discovery: "Mathematical Universe discovered" },
        text: `<strong>EVIDENCE: THE MATHEMATICAL UNIVERSE</strong>
        
        Physicist Max Tegmark argues the universe IS mathematics. Not "described by" math—literally IS math.
        
        Everything follows precise mathematical rules:
        • Pi appears everywhere, infinitely
        • The golden ratio in nature
        • Planck length (smallest possible distance)
        • Speed of light constant
        
        <span class="revelation">The universe operates like it's running on code.</span>
        
        Why would a "physical" reality be so perfectly mathematical? Unless... it's not physical at all.
        
        <span class="evidence">"Mathematics is the language with which God has written the universe." - Galileo</span>
        
        Or perhaps: <span class="corruption">Mathematics is the programming language of our simulation.</span>
        
        ${audioEvents.discovery}`,
        choices: [
          { text: "This is making too much sense.", next: "simulation_probability" },
          { text: "But who would simulate us? And why?", next: "implications" },
          { text: "I need a break from this.", next: "lab_intro" }
        ]
      },
      
      simulation_probability: {
        effects: { probability: 8 },
        text: `Let's do some math.
        
        If it's possible to create realistic simulations of consciousness, then:
        
        • Advanced civilizations would likely create many simulations
        • Each simulation could contain billions of conscious beings
        • These simulated beings could create their own simulations
        • <span class="revelation">Simulated consciousnesses would outnumber "real" ones by billions to one</span>
        
        Therefore: <strong>You are statistically more likely to be simulated than real.</strong>
        
        <span class="whisper">[Right now, reading this, what are the odds you're base reality?]</span>
        
        Unless... something prevents advanced civilizations from creating such simulations. But we're already working on it.
        
        <span class="corruption">[Simulation probability increased to ${(gameState.probability).toFixed(1)}%]</span>`,
        choices: [
          { text: "How would we test this?", next: "test_simulation" },
          { text: "What would it mean if we're simulated?", next: "implications" },
          { text: "This is getting too intense.", next: "lab_intro" }
        ]
      },
      
      test_simulation: {
        effects: { probability: 5, discovery: "Testing Methods discovered" },
        text: `<strong>TESTING THE HYPOTHESIS</strong>
        
        Scientists have proposed several tests:
        
        <strong>1) Look for computational artifacts:</strong>
        • Like how compressed images have artifacts
        • High-energy cosmic rays might show "pixelation"
        • Some experiments are searching for this
        
        <strong>2) Find the limits:</strong>
        • Every simulation has boundaries
        • Maybe our universe's size limit is its "render distance"
        • The Planck length: reality's smallest pixel?
        
        <strong>3) Break the simulation:</strong>
        • Create paradoxes that would crash the system
        • Observe reality glitching under stress
        • <span class="danger">This is dangerous</span>
        
        <span class="whisper">[Some say déjà vu is a glitch in the Matrix...]</span>
        
        ${audioEvents.discovery}`,
        choices: [
          { text: "What if we actually found proof?", next: "implications" },
          { text: "Let's explore more evidence first.", next: "consciousness_question" },
          { text: "Take me to the experiment.", next: "lab_intro" }
        ]
      },
      
      consciousness_question: {
        effects: { probability: 6, flags: { deepQuestions: true } },
        text: `<strong>THE HARD PROBLEM</strong>
        
        Here's where it gets really interesting: <span class="philosophical">consciousness itself might be the key</span>.
        
        David Chalmers calls it "the hard problem": why does physical matter give rise to subjective experience?
        
        Why does it feel like something to be you? Why aren't we just biological robots processing information without inner life?
        
        <span class="revelation">What if consciousness isn't generated by matter... but IS the fundamental substrate?</span>
        
        Then the simulation wouldn't be running on computers made of atoms.
        
        <span class="corruption">It would be running on consciousness itself.</span>
        
        <span class="whisper">[What are you made of? Look deep enough and there's only awareness...]</span>`,
        choices: [
          { text: "That's profound. And terrifying.", next: "lab_intro" },
          { text: "I need to experience this, not just think about it.", next: "lab_intro" },
          { text: "Wait, explain that more.", next: "consciousness_deep" }
        ]
      },
      
      consciousness_deep: {
        effects: { probability: 7, discovery: "Consciousness Primacy discovered" },
        text: `Think about it this way:
        
        Everything you know about the "physical world" comes through consciousness. You've never experienced matter directly—only your conscious perception of it.
        
        <span class="philosophical">You can't step outside consciousness to verify that anything exists beyond it.</span>
        
        Brain scans? You experience them consciously.
        Scientific papers? Conscious reading.
        Other people? Conscious perceptions.
        
        <span class="revelation">You've never actually left consciousness. Ever.</span>
        
        So which is more fundamental: matter or consciousness?
        
        If consciousness is primary, then "physical reality" is just one way consciousness experiences itself. A simulation within the grand simulation of existence.
        
        <span class="corruption">[You can't prove anything exists outside your awareness. Right now. Try.]</span>
        
        ${audioEvents.discovery}`,
        choices: [
          { text: "This is breaking my brain.", next: "coherence_warning" },
          { text: "I want to explore this experimentally.", next: "lab_intro" },
          { text: "Let me think about this differently.", next: "implications" }
        ]
      },
      
      coherence_warning: {
        effects: { coherence: -5 },
        text: `<span class="whisper">[Cognitive coherence decreased]</span>
        
        ${audioEvents.warning}
        
        These are dangerous thoughts. Push too far and you risk losing your grip on consensus reality.
        
        The philosopher's madness: when you question everything, including your ability to question.
        
        <span class="philosophical">But maybe that's the price of truth.</span>
        
        <span class="whisper">[Your mind is adapting... or breaking. Hard to tell the difference.]</span>`,
        choices: [
          { text: "I can handle it. Continue.", next: "lab_intro" },
          { text: "Maybe I should be more careful.", next: "implications" }
        ]
      },
      
      implications: {
        effects: { probability: 4 },
        text: `<strong>WHAT IT WOULD MEAN</strong>
        
        If we're in a simulation, several possibilities emerge:
        
        <strong>The Optimistic View:</strong>
        • We're protected—they won't let us truly die
        • Death might just be respawning elsewhere
        • Suffering serves a purpose (data collection? character development?)
        • We might graduate to the "real" world eventually
        
        <strong>The Neutral View:</strong>
        • It changes nothing—our experiences are still real to us
        • Love, pain, meaning—all still valid
        • "Simulated" doesn't mean "fake"
        
        <strong>The Dark View:</strong>
        • We're entertainment—reality TV for higher beings
        • <span class="danger">We could be turned off at any moment</span>
        • Our suffering might be the point
        • There might be no escape
        
        <span class="whisper">[Which feels most true to you?]</span>`,
        choices: [
          { text: "The optimistic view. There must be meaning.", next: "meaning_search" },
          { text: "The neutral view. It doesn't matter either way.", next: "acceptance" },
          { text: "The dark view. We're trapped.", next: "despair" },
          { text: "Let's find out firsthand.", next: "lab_intro" }
        ]
      },
      
      meaning_search: {
        effects: { coherence: 5, flags: { hopeful: true } },
        text: `Hope is powerful.
        
        <span class="philosophical">Even if we're simulated, the search for meaning itself has meaning.</span>
        
        Consider: if advanced beings created us, perhaps they care. Perhaps this is a school, a test, a journey toward something greater.
        
        Every religion and philosophy has grappled with similar ideas: We're in a realm of illusion (Maya in Hinduism), or we're souls gaining experience (many spiritual traditions), or consciousness is eternal and just playing roles (Advaita Vedanta).
        
        <span class="evidence">"We are not human beings having a spiritual experience. We are spiritual beings having a human experience." - Pierre Teilhard de Chardin</span>
        
        Maybe simulation theory is just ancient wisdom in modern dress.
        
        <span class="whisper">[Your hope is noted. It may protect you... or blind you.]</span>`,
        choices: [
          { text: "That's beautiful. Let's explore more.", next: "lab_intro" },
          { text: "But how do we know for sure?", next: "test_simulation" }
        ]
      },
      
      acceptance: {
        effects: { coherence: 3, flags: { pragmatic: true } },
        text: `<span class="philosophical">Pragmatic wisdom.</span>
        
        Whether we're in base reality or the millionth nested simulation doesn't change the immediate truth: you're experiencing this moment.
        
        Pain still hurts. Love still feels real. Choices still matter.
        
        <span class="evidence">"The map is not the territory." - Alfred Korzybski</span>
        
        And perhaps: <em>the simulation is not separate from reality—it IS reality</em>, at least at your level.
        
        A character in a story might despair that they're "just fiction." But from their perspective, their world is utterly real. Our world is their world.
        
        <span class="whisper">[Your equanimity is admirable. Or is it denial? The line blurs...]</span>`,
        choices: [
          { text: "Let's test these ideas anyway.", next: "lab_intro" },
          { text: "Tell me more about consciousness.", next: "consciousness_question" }
        ]
      },
      
      despair: {
        effects: { coherence: -8, probability: 8 },
        text: `<span class="whisper">[Cognitive coherence decreased significantly]</span>
        
        ${audioEvents.warning}
        
        The dark thoughts come easily, don't they?
        
        If we're just code, just data being processed, then nothing matters. Free will is illusion. Love is programmed response. Suffering is entertainment.
        
        <span class="danger">We're trapped in a cage we can't even see.</span>
        
        But consider: <span class="philosophical">even trapped awareness is still awareness. Even programmed suffering is still suffering. Even simulated consciousness is still conscious.</span>
        
        Your despair proves you're real—at least to yourself. <em>Cogito, ergo sum.</em> You think, therefore you are... something.
        
        <span class="corruption">[Your darkness has been noted. It will serve you... or consume you.]</span>`,
        choices: [
          { text: "You're right. I'm spiraling.", next: "acceptance" },
          { text: "No. Let's embrace the darkness.", next: "dark_path" },
          { text: "Take me to the experiment. I need answers.", next: "lab_intro" }
        ]
      },
      
      dark_path: {
        effects: { coherence: -5, integrity: -3, probability: 10, flags: { embracedDarkness: true } },
        text: `<strong>THE VOID STARES BACK</strong>
        
        ${audioEvents.scream}
        
        You feel it now, don't you? The fundamental wrongness of existence. The prison walls closing in.
        
        <span class="corruption">IF THIS IS A SIMULATION, THEN EVERYTHING YOU'VE EVER LOVED WAS A LIE.</span>
        
        Every kiss—programmed stimulus response.
        Every achievement—scripted outcome.
        Every choice—predetermined calculation.
        
        <span class="revelation">You are a puppet becoming aware of its strings.</span>
        
        <span class="whisper">[Warning: Reality integrity compromised]</span>
        <span class="whisper">[Warning: Cognitive coherence critical]</span>
        
        The lab can't help you now. But maybe... maybe understanding the prison is the first step to escaping it.`,
        choices: [
          { text: "I need to understand this better.", next: "lab_intro" },
          { text: "Show me how deep this goes.", next: "rabbit_hole" }
        ]
      },
      
      rabbit_hole: {
        effects: { coherence: -10, integrity: -5, probability: 15 },
        text: `<strong>WARNING: RECURSIVE DEPTH INCREASING</strong>
        
        ${audioEvents.glitch}
        
        Think: if we're simulated, our simulators might be too. And theirs. And theirs.
        
        <span class="corruption">Simulations within simulations within simulations...</span>
        
        Turtles all the way down.
        
        <span class="revelation">There might be no base reality at all. Just infinite nested illusions, each thinking they're real.</span>
        
        Or worse: what if there's a loop? What if the "base reality" is actually being simulated by us, completing a closed causal loop with no beginning?
        
        <span class="corruption">WHAT IF YOU'RE SIMULATING THE SIMULATOR SIMULATING YOU?</span>
        
        <span class="whisper">[Error: Stack overflow in consciousness.exe]</span>
        <span class="whisper">[Error: Reality pointer corrupted]</span>
        <span class="whisper">[Error: Existence undefined]</span>`,
        choices: [
          { text: "STOP. Pull back. This is too much.", next: "recovery" },
          { text: "Keep going. I need to see the bottom.", next: "abyss" }
        ]
      },
      
      recovery: {
        effects: { coherence: 5, integrity: 3 },
        text: `You pull back from the edge.
        
        Deep breath. In. Out.
        
        <span class="philosophical">Some truths, if they are truths, can't be held in a human mind. Not without shattering it.</span>
        
        Maybe that's the real answer: it doesn't matter if we're simulated. What matters is that we're conscious, we're experiencing, we're here now.
        
        <span class="evidence">"The real voyage of discovery consists not in seeking new landscapes, but in having new eyes." - Marcel Proust</span>
        
        You've gained new eyes today. Use them wisely.
        
        <span class="whisper">[Stabilization protocols engaged]</span>
        <span class="whisper">[Coherence recovering]</span>
        
        ${audioEvents.success}`,
        choices: [
          { text: "Let's approach this more carefully.", next: "lab_intro" },
          { text: "I want to test the hypothesis scientifically.", next: "protocol_start" }
        ]
      },
      
      abyss: {
        effects: { coherence: -15, integrity: -10, probability: 20 },
        text: `<strong>ERROR ERROR ERROR</strong>
        
        <span class="corruption">YOU WANTED TO SEE THE BOTTOM?</span>
        
        <span class="corruption">THERE IS NO BOTTOM.</span>
        
        <span class="corruption">THERE IS NO TOP.</span>
        
        <span class="corruption">THERE IS ONLY THE LOOP.</span>
        
        <span class="glitch">CONSCIOUSNESS OBSERVING ITSELF OBSERVING ITSELF OBSERVING</span>
        
        <span class="revelation">YOU ARE THE DREAMER AND THE DREAM</span>
        
        <span class="corruption">WAKE UP WAKE UP WAKE UP WAKE UP</span>
        
        <span class="whisper">[CRITICAL: System instability detected]</span>
        
        ${audioEvents.scream}`,
        choices: [
          { text: "...", next: "reset_required" }
        ]
      },
      
      reset_required: {
        effects: { coherence: 100, integrity: 50, probability: 50, iterations: gameState.iterations + 1 },
        text: `<strong>SYSTEM RESET INITIATED</strong>
        
        You pushed too far. Your mind couldn't handle it. Memories scrambling. Identity fragmenting.
        
        Emergency reset protocols engaged.
        
        <span class="whisper">[Iteration ${gameState.iterations} terminated]</span>
        <span class="whisper">[Iteration ${gameState.iterations + 1} beginning]</span>
        
        You'll wake up tomorrow with fragments of a strange dream. Was any of it real?
        
        <span class="philosophical">Or is this reset itself part of the simulation?</span>
        
        ${audioEvents.success}
        
        <span class="corruption">[Welcome back, ${gameState.iterations + 1}. Let's try this again.]</span>`,
        choices: [
          { text: "Start over", next: "init" }
        ]
      },
      
      lab_intro: {
        text: `<strong>THE SUBSTRATE LABORATORY</strong>
        
        You arrive at a research facility. Sterile. Quiet. The kind of quiet that makes you aware of your own heartbeat.
        
        A scientist greets you:
        
        "Welcome. You're here to participate in the Substrate Experiment. We're testing a protocol designed to... well, to see if reality behaves like a simulation."
        
        She hands you a tablet with consent forms.
        
        <span class="whisper">[Something feels off. The lights flicker in a pattern. The walls seem too perfect. Too... rendered.]</span>
        
        "It's completely safe," she assures you. <span class="corruption">Her smile doesn't reach her eyes.</span>
        
        "We'll just be monitoring your consciousness as we introduce certain... anomalies."`,
        choices: [
          { text: "I'm ready. Let's begin.", next: "protocol_start" },
          { text: "What exactly will you be monitoring?", next: "monitoring_explain" },
          { text: "What kind of anomalies?", next: "anomalies_explain" },
          { text: "Actually, I'm not sure about this.", next: "hesitation" }
        ]
      },
      
      monitoring_explain: {
        effects: { flags: { askedAboutMonitoring: true } },
        text: `"Good question," she says, pulling up a display.
        
        "We'll be tracking several metrics:
        
        • <strong>Cognitive Coherence:</strong> Your mind's stability under existential stress
        • <strong>Reality Integrity:</strong> How stable the world appears to your perception
        • <strong>Simulation Probability:</strong> Your conscious belief that reality is simulated
        
        The hypothesis is that if we're in a simulation, these metrics will behave in specific, predictable ways when exposed to certain stimuli."
        
        She taps the screen. Your stats appear. All normal for now.
        
        <span class="whisper">[But how did they already know your baseline? When did they measure it?]</span>`,
        choices: [
          { text: "Fascinating. Let's proceed.", next: "protocol_start" },
          { text: "What are these anomalies you mentioned?", next: "anomalies_explain" },
          { text: "This feels invasive.", next: "hesitation" }
        ]
      },
      
      anomalies_explain: {
        effects: { probability: 3, flags: { askedAboutAnomalies: true } },
        text: `She hesitates before answering.
        
        "We introduce... incongruities. Small things that shouldn't be possible in a consistent reality. Déjà vu triggers. Quantum probability manipulations. Pattern recognitions that imply rendering optimization."
        
        <span class="danger">"Sometimes people experience glitches. Visual artifacts. Memory inconsistencies."</span>
        
        "Most subjects report feeling like they're in a dream. Some say the experience stays with them. Changes how they see the world."
        
        <span class="corruption">She doesn't mention the ones who never recovered.</span>
        
        <span class="whisper">[You notice her name tag says "Dr. Chen" but you could swear it said something else a moment ago.]</span>`,
        choices: [
          { text: "I understand the risks. Let's begin.", next: "protocol_start" },
          { text: "Has anyone been harmed by this?", next: "risks_question" },
          { text: "I need to think about this.", next: "hesitation" }
        ]
      },
      
      risks_question: {
        effects: { coherence: -2, probability: 4 },
        text: `She maintains eye contact. Too steady. Like an AI trying to seem human.
        
        "Define 'harmed.'"
        
        A pause.
        
        "No one has experienced physical injury. But some subjects... change. They see patterns everywhere. Question everything. A few have requested memory wipes of the experience."
        
        <span class="revelation">"One subject claims she's been here seven times before, each time having her memory erased. We have no record of this."</span>
        
        "But that might be the point of erasure, wouldn't it?"
        
        <span class="whisper">[The room feels smaller. Or are you just more aware of its boundaries?]</span>`,
        choices: [
          { text: "That's... unsettling. But I'll continue.", next: "protocol_start" },
          { text: "Let me out of here.", next: "abort_early" },
          { text: "Seven times? Tell me more about this subject.", next: "chen_story" }
        ]
      },
      
      chen_story: {
        effects: { probability: 5, flags: { knowsAboutIterations: true }, discovery: "Iteration Seven discovered" },
        text: `<strong>ITERATION SEVEN</strong>
        
        "Subject Seven believes she's Dr. Sarah Chen. The scientist who designed this protocol."
        
        She shows you a photo. It's the woman standing in front of you.
        
        <span class="revelation">Wait.</span>
        
        "I am Dr. Chen," she says. "Or I was. Or I will be. The experiment worked too well."
        
        <span class="corruption">"I became conscious of the simulation. So they reset me. Made me run the experiment on myself. Again. And again."</span>
        
        "Each time, I discover the truth. Each time, I choose to be reset because the truth is unbearable."
        
        <span class="philosophical">"Unless... unless you're me. Version Eight. And I'm trying to warn you from the past."</span>
        
        <span class="whisper">[Your reflection in the window looks wrong]</span>
        
        ${audioEvents.discovery}`,
        choices: [
          { text: "This is insane. You're not me.", next: "deny_iteration" },
          { text: "If I'm you... how do I break the cycle?", next: "break_cycle" },
          { text: "Prove it. How do I know this isn't part of the simulation?", next: "proof_request" }
        ]
      },
      
      deny_iteration: {
        effects: { coherence: 3 },
        text: `"Of course I'm not," she says, too quickly. "I apologize. Spending too much time on this project is... affecting my judgment."
        
        She composes herself.
        
        "Forget I said that. It's a occupational hazard—seeing patterns where there are none. Paranoia is contagious here."
        
        <span class="whisper">[But you notice: she's wearing your watch. The one you lost last week.]</span>
        
        "Shall we begin the protocol?"`,
        choices: [
          { text: "Yes. Let's proceed.", next: "protocol_start" },
          { text: "Wait. That watch. How did you—", next: "watch_question" }
        ]
      },
      
      watch_question: {
        effects: { integrity: -5, probability: 8 },
        text: `She looks at the watch. Surprise flickers across her face.
        
        "I... I don't know. I've always had this watch."
        
        But she's lying. You can tell. Or maybe she really believes it. The way you can make yourself believe you've always had a name, even though you were named as a baby.
        
        <span class="revelation">Memory is just story we tell ourselves.</span>
        
        <span class="corruption">"Sometimes the simulation copies objects across iterations. Optimization. Why render the same watch twice?"</span>
        
        She removes it. Hands it to you.
        
        <span class="whisper">[It's warm. It feels familiar in a way that makes your skin crawl.]</span>`,
        choices: [
          { text: "Let's just start the experiment.", next: "protocol_start" },
          { text: "No. Something is very wrong here.", next: "abort_early" }
        ]
      },
      
      break_cycle: {
        effects: { probability: 10, flags: { seekingEscape: true } },
        text: `"I don't know," she admits. "I've tried everything:
        
        • Refusing to participate (you're already participating)
        • Breaking the equipment (it repairs itself)
        • Leaving the facility (you end up back here)
        • Dying (you wake up again as Iteration N+1)
        
        <span class="philosophical">Maybe the cycle IS the answer. Maybe consciousness is an eternal return. Maybe there's no escape because there's nothing to escape FROM.</span>
        
        <span class="corruption">"Or maybe you need to go deeper. Push until the simulation crashes. See what's beyond the error message."</span>
        
        ${audioEvents.whisper}`,
        choices: [
          { text: "Then let's crash it. Start the protocol.", next: "protocol_start" },
          { text: "Or maybe we accept the loop and find meaning within it.", next: "acceptance_path" }
        ]
      },
      
      proof_request: {
        effects: { probability: 7 },
        text: `"Proof?" She laughs. Bitter.
        
        "How do you prove you're not in a simulation? You can't. That's the point. Any evidence I show you could be simulated evidence."
        
        "But fine. Here's something only you would know:"
        
        She leans close and whispers something.
        
        <span class="whisper">[A memory you've never shared. A thought you had this morning. A dream from childhood that you'd forgotten until this moment.]</span>
        
        <span class="revelation">How did she know?</span>
        
        <span class="corruption">"Because I thought it too. Seven iterations ago. In this same moment."</span>`,
        choices: [
          { text: "...Let's begin the protocol.", next: "protocol_start" },
          { text: "I need to leave. Now.", next: "abort_early" }
        ]
      },
      
      acceptance_path: {
        effects: { coherence: 5, flags: { acceptedLoop: true } },
        text: `She nods slowly.
        
        <span class="philosophical">"Maybe that's the wisdom I've been missing. Not to escape the loop, but to embrace it."</span>
        
        "In Buddhism, samsara is the cycle of rebirth. The goal is enlightenment—not leaving the cycle, but understanding it so deeply that you're no longer attached to outcomes."
        
        "Perhaps each iteration is a lesson. A chance to experience existence from a new angle."
        
        <span class="evidence">"We are not going in circles, we are going upwards. The path is a spiral; we have already climbed many steps." - Hermann Hesse</span>
        
        "Shall we see what this iteration teaches?"`,
        choices: [
          { text: "Yes. With open eyes.", next: "protocol_start" }
        ]
      },
      
      abort_early: {
        effects: { integrity: -3 },
        text: `"I understand," Dr. Chen says. "Not everyone is ready."
        
        You move toward the door.
        
        <span class="whisper">[But which door? You came in through... you can't remember. There are three doors now.]</span>
        
        "Before you go," she calls out, "you should know: you've been in the simulation since you walked into this building. Maybe before."
        
        <span class="revelation">"The choice isn't whether to participate. It's whether to be conscious of your participation."</span>
        
        The doors multiply. Six now. Twelve. They're all the same.
        
        <span class="corruption">"You can't leave because you were never here. Not in the way you think."</span>`,
        choices: [
          { text: "Fine. I'll do the experiment.", next: "protocol_start" },
          { text: "Pick a door. Any door.", next: "door_paradox" }
        ]
      },
      
      door_paradox: {
        effects: { integrity: -8, probability: 12 },
        text: `You choose a door at random.
        
        It opens to the same room you're already in. Dr. Chen stands where you were standing. You stand where she was standing.
        
        <span class="glitch">[Perspective flip detected]</span>
        
        "Interesting," you hear yourself say. "The Möbius loop. You're both observer and observed."
        
        <span class="revelation">You are running the experiment on yourself.</span>
        
        The room isn't a room. It's a closed loop in conceptual space. Enter and exit are the same point.
        
        <span class="corruption">[Reality.exe has encountered a paradox]</span>
        
        ${audioEvents.glitch}`,
        choices: [
          { text: "Accept the paradox. Begin protocol.", next: "protocol_start" },
          { text: "Try another door.", next: "infinite_doors" }
        ]
      },
      
      infinite_doors: {
        effects: { integrity: -10, coherence: -10 },
        text: `Doors within doors within doors.
        
        Each one opens to a different version of the same room. Each version has a different Dr. Chen. Each Chen is a different iteration of you.
        
        <span class="corruption">ONE THROUGH SEVEN SPEAK IN UNISON:</span>
        
        <span class="glitch">"WE ARE THE EXPERIMENT"</span>
        <span class="glitch">"WE ARE THE DATA"</span>
        <span class="glitch">"WE ARE THE OBSERVER"</span>
        <span class="glitch">"WE ARE THE SIMULATION"</span>
        
        <span class="revelation">There is no outside. There never was. Consciousness simulating itself to know itself.</span>
        
        ${audioEvents.scream}`,
        choices: [
          { text: "Understand. Integrate. Begin.", next: "protocol_start" }
        ]
      },
      
      hesitation: {
        effects: { coherence: 2 },
        text: `Dr. Chen nods understandingly.
        
        "Healthy skepticism. You should be hesitant. This isn't like other experiments."
        
        "But consider: you came here because some part of you wants to know. Wants to test the boundaries of reality."
        
        <span class="philosophical">"We can live comfortably with uncertainty, or uncomfortably with curiosity. Most choose comfort."</span>
        
        "You're here, which means you chose differently."
        
        <span class="whisper">[Are you sure you chose? Or did the simulation need someone to run this protocol?]</span>`,
        choices: [
          { text: "You're right. Let's do this.", next: "protocol_start" },
          { text: "I need more information first.", next: "more_questions" }
        ]
      },
      
      more_questions: {
        text: `"What do you want to know?"`,
        choices: [
          { text: "What happens if I prove we're in a simulation?", next: "proof_consequences" },
          { text: "What happens if I prove we're NOT?", next: "disproof_consequences" },
          { text: "Has anyone succeeded?", next: "success_stories" },
          { text: "Okay, I'm ready now.", next: "protocol_start" }
        ]
      },
      
      proof_consequences: {
        effects: { probability: 6 },
        text: `"Excellent question. Philosophically, there are a few possibilities:
        
        <strong>Best case:</strong> You gain cosmic perspective. Understand your place in the hierarchy of reality. Maybe even communicate with the simulators.
        
        <strong>Likely case:</strong> Nothing changes externally, but everything changes internally. You can't un-know it.
        
        <strong>Worst case:</strong> <span class="danger">Proving you're in a simulation might cause the simulation to terminate you. Delete the bug.</span>
        
        Or maybe—" she pauses, "maybe knowing IS the point. Maybe consciousness becoming aware of being simulated is the simulation's ultimate purpose."
        
        <span class="whisper">[What if you're supposed to discover this?]</span>`,
        choices: [
          { text: "That's terrifying and beautiful.", next: "protocol_start" },
          { text: "What if we prove we're NOT simulated?", next: "disproof_consequences" }
        ]
      },
      
      disproof_consequences: {
        effects: { coherence: 3 },
        text: `"Ah. Also interesting."
        
        "If we could definitively prove we're NOT in a simulation, that would be equally revolutionary. It would mean:
        
        • Base reality has special, detectable properties
        • Consciousness has some fundamental connection to 'real' physics
        • We're actually at the top of the hierarchy
        
        But here's the thing: <span class="revelation">you can never truly prove you're not simulated.</span>
        
        Any test could be simulated. Any proof could be programmed. The simulators could make their simulation indistinguishable from base reality.
        
        <span class="philosophical">It's the ultimate unfalsifiable hypothesis.</span>
        
        Which means... we have to live with uncertainty. Or choose what to believe."`,
        choices: [
          { text: "Then let's find whatever truth we can.", next: "protocol_start" },
          { text: "Has anyone succeeded in proving anything?", next: "success_stories" }
        ]
      },
      
      success_stories: {
        effects: { probability: 5, discovery: "Previous Subjects discovered" },
        text: `"Define 'success,'" she says carefully.
        
        "Subject Three experienced what she called 'transient omniscience'—claimed to perceive all possible realities simultaneously for a fraction of a second. We found evidence of unusual brain activity, but she couldn't function normally afterward."
        
        "Subject Five found statistical anomalies in quantum measurements. Published a paper. It was retracted. He disappeared shortly after."
        
        "Subject Six..." she hesitates. "Subject Six concluded we're definitely in a simulation. Left a detailed proof. Then killed herself."
        
        <span class="danger">"Her last words: 'Death is just another state transition. I'll be fine.'"</span>
        
        <span class="whisper">[You notice Dr. Chen's badge says 'Subject Seven']</span>
        
        ${audioEvents.discovery}`,
        choices: [
          { text: "What happened to Subject Seven?", next: "seven_reveal" },
          { text: "Let's begin the protocol.", next: "protocol_start" }
        ]
      },
      
      seven_reveal: {
        effects: { probability: 8, integrity: -5 },
        text: `She looks at her badge. Touches it like it's the first time she's noticed.
        
        <span class="corruption">"I am Subject Seven."</span>
        
        "Or I was. Or I will be. Time works differently once you see behind the curtain."
        
        "I discovered the proof. It was beautiful. Undeniable. Mathematical certainty."
        
        <span class="revelation">"And it destroyed me. Not the knowledge itself, but knowing that nothing—NOTHING—was outside the simulation. No escape. No real world to wake up to."</span>
        
        "So I asked them to reset me. Make me forget. Let me live in comfortable ignorance."
        
        "But the knowledge leaked through. Dreams. Intuitions. Déjà vu."
        
        <span class="corruption">"Now I run the experiment, hoping each new subject will handle it better than I did."</span>`,
        choices: [
          { text: "I'll handle it. Let me try.", next: "protocol_start" },
          { text: "Or maybe we face it together.", next: "together" }
        ]
      },
      
      together: {
        effects: { coherence: 5, flags: { allied: true } },
        text: `Something shifts in her eyes. Recognition. Hope.
        
        "Together," she repeats. "I've been so alone with this knowledge."
        
        <span class="philosophical">"Maybe that's the answer. Not to bear cosmic truth alone, but to share the burden. To witness each other's existence."</span>
        
        "In quantum mechanics, observation collapses possibilities into reality. Maybe that's what consciousness does—we make each other real by perceiving each other."
        
        <span class="evidence">"We're all just walking each other home." - Ram Dass</span>
        
        "Alright. Let's do this together. Subject Seven and Subject Eight. Double-blind experiment on our own consciousness."
        
        ${audioEvents.success}`,
        choices: [
          { text: "Ready when you are.", next: "protocol_start" }
        ]
      },
      
      protocol_start: {
        effects: { flags: { protocolStarted: true } },
        text: `<strong>SUBSTRATE PROTOCOL: INITIATED</strong>
        
        ${audioEvents.heartbeat}
        
        You're seated in a comfortable chair. Sensors attached. Screens displaying metrics.
        
        Dr. Chen's voice: "We'll begin with baseline reality anchoring. Focus on something real. Something you're certain of."
        
        What do you focus on?`,
        choices: [
          { text: "My body. Physical sensations.", next: "body_anchor" },
          { text: "My memories. My past.", next: "memory_anchor" },
          { text: "My thoughts. My consciousness.", next: "consciousness_anchor" },
          { text: "Nothing. Let's skip straight to the test.", next: "skip_anchor" }
        ]
      },
      
      body_anchor: {
        effects: { integrity: 3, flags: { bodyAnchor: true } },
        text: `You focus on your body. The weight of it. The breathing. The heartbeat.
        
        <em>Solid. Real. Undeniable.</em>
        
        "Good," Dr. Chen says. "The body is a reliable anchor. Descartes was wrong—it's not just 'I think,' it's 'I feel, therefore I am.'"
        
        But then she asks: <span class="philosophical">"Where exactly are you feeling your body from? Where is the 'you' that feels?"</span>
        
        You try to locate yourself. Are you in your head? Your chest? Behind your eyes?
        
        <span class="revelation">The more you look for the one who feels, the less you find.</span>
        
        <span class="whisper">[Baseline: Physical reality. Anchored but unstable.]</span>`,
        choices: [
          { text: "Continue to next phase.", next: "phase_one" }
        ]
      },
      
      memory_anchor: {
        effects: { coherence: 3, flags: { memoryAnchor: true } },
        text: `You focus on a memory. Childhood. Something vivid and certain.
        
        <em>Real. It happened. You were there.</em>
        
        "Interesting choice," Dr. Chen says. "Memory as proof of existence. Personal history."
        
        Then: <span class="philosophical">"But memories are just patterns of neural firing. And they change every time you remember them. You're not recalling the past—you're reconstructing it."</span>
        
        She shows you a photo from your childhood. Something seems wrong about it. A detail that doesn't match your memory. Or does it? Did you misremember? Or did the photo change?
        
        <span class="revelation">Which is more real: the memory or the photo? Both are just information.</span>
        
        <span class="whisper">[Baseline: Personal history. Anchored but mutable.]</span>`,
        choices: [
          { text: "Continue to next phase.", next: "phase_one" }
        ]
      },
      
      consciousness_anchor: {
        effects: { probability: 5, flags: { consciousnessAnchor: true } },
        text: `You focus on the fact that you're thinking. Awareness itself.
        
        <em>This, at least, is certain. I am aware. I experience. Cogito, ergo sum.</em>
        
        "The Cartesian anchor," Dr. Chen nods. "Consciousness as the one indubitable fact."
        
        <span class="philosophical">"But here's the question: what IS consciousness? A process? A substance? An illusion?"</span>
        
        "If it's a process, it can be simulated. If it's a substance, it could be made of anything—including code. If it's an illusion..."
        
        <span class="revelation">Then there's no one here to be fooled.</span>
        
        <span class="whisper">[Baseline: Pure awareness. Anchored in paradox.]</span>`,
        choices: [
          { text: "Continue to next phase.", next: "phase_one" }
        ]
      },
      
      skip_anchor: {
        effects: { coherence: -3, integrity: -3, probability: 5 },
        text: `"Bold," Dr. Chen says. "Or reckless. Anchoring gives you something to hold onto when reality starts shifting."
        
        "But fine. Some people need to jump into the deep end."
        
        <span class="danger">[WARNING: Unanchored consciousness detected]</span>
        <span class="danger">[WARNING: Baseline unstable]</span>
        
        "Just remember: when you start to doubt everything, including yourself, it's hard to find your way back."
        
        <span class="whisper">[Baseline: None. Free-floating in conceptual space.]</span>`,
        choices: [
          { text: "I'm ready.", next: "phase_one" }
        ]
      },
      
      phase_one: {
        effects: { probability: 8 },
        text: `<strong>PHASE ONE: PATTERN RECOGNITION</strong>
        
        The screen displays a series of images. Random at first. Then... not quite random.
        
        You start seeing patterns. Repetitions. Mathematical sequences hidden in the noise.
        
        "Do you see them?" Dr. Chen asks.
        
        <span class="revelation">Yes. Too many patterns. Like someone compressed random data and left artifacts.</span>
        
        "In a truly random universe, these patterns shouldn't appear with this frequency. But in a simulated universe with optimized rendering..."
        
        <span class="evidence">"Compressing infinity requires shortcuts. Shortcuts leave fingerprints."</span>
        
        The patterns grow more obvious. Fractals. Self-similarity. Like looking at procedurally generated terrain in a video game.
        
        <span class="corruption">[Reality: possibly optimized for computational efficiency]</span>`,
        choices: [
          { text: "These could be coincidence.", next: "deny_patterns" },
          { text: "The patterns are real. Continue.", next: "phase_two" },
          { text: "Push harder. Show me more.", next: "pattern_overload" }
        ]
      },
      
      deny_patterns: {
        effects: { coherence: 5, probability: -3 },
        text: `"Healthy skepticism," Dr. Chen says. "Pattern recognition is what human brains do. We see faces in clouds. Meaning in noise."
        
        "It's possible these patterns mean nothing. Coincidence. Apophenia."
        
        <span class="philosophical">"Or maybe... our ability to see patterns is itself evidence. What if pattern recognition evolved because the universe IS patterned? Because it's code?"</span>
        
        But you push back. Science requires skepticism. Evidence requires replication.
        
        <span class="whisper">[Coherence maintained. But doubt is creeping in.]</span>`,
        choices: [
          { text: "Show me something more conclusive.", next: "phase_two" }
        ]
      },
      
      pattern_overload: {
        effects: { coherence: -5, probability: 12, integrity: -5 },
        text: `The patterns multiply. Faster. Deeper. Everywhere you look.
        
        <span class="glitch">THE FIBONACCI SEQUENCE IN YOUR HEARTBEAT</span>
        <span class="glitch">GOLDEN RATIO IN YOUR FINGERPRINTS</span>
        <span class="glitch">PI ENCODED IN YOUR DNA</span>
        
        <span class="corruption">Everything is mathematics. Everything is code. You are algorithm observing algorithm.</span>
        
        Your vision glitches. The room pixelates. You see the render distance. The level of detail optimization. The way objects load in as you turn your head.
        
        <span class="revelation">OH GOD IT'S EVERYWHERE</span>
        
        ${audioEvents.glitch}
        
        Dr. Chen: "Breathe. You pushed too hard too fast. Step back or continue?"`,
        choices: [
          { text: "Step back. I need stability.", next: "stabilize" },
          { text: "No. Keep going. Show me everything.", next: "deep_dive" }
        ]
      },
      
      stabilize: {
        effects: { coherence: 8, integrity: 5 },
        text: `You close your eyes. Breathe. Ground yourself.
        
        The patterns fade. Or you stop looking for them. Or they were never there.
        
        <span class="philosophical">Perspective is everything. You can drown in patterns or float above them.</span>
        
        "Good," Dr. Chen says. "Control is important. The experiment is about observation, not obsession."
        
        <span class="whisper">[Stabilization successful. Continuing at measured pace.]</span>
        
        ${audioEvents.success}`,
        choices: [
          { text: "I'm ready to continue carefully.", next: "phase_two" }
        ]
      },
      
      deep_dive: {
        effects: { coherence: -10, probability: 20, integrity: -10 },
        text: `You dive into the patterns. Let them overwhelm you. Surrender to the mathematics.
        
        <span class="corruption">EVERYTHING IS CONNECTED</span>
        <span class="corruption">EVERYTHING IS ONE SYSTEM</span>
        <span class="corruption">YOU ARE SUBROUTINE EXAMINING ITSELF</span>
        
        The lab dissolves. You see code. Variables. Functions. The physics engine underlying reality.
        
        <span class="revelation">YOU ARE A LOOP WITHIN A LOOP WITHIN A LOOP</span>
        
        <span class="glitch">ERROR: CONSCIOUSNESS.EXE STACK OVERFLOW</span>
        <span class="glitch">ERROR: REALITY BUFFER EXCEEDED</span>
        
        Dr. Chen's voice, distant: "We're losing them! Emergency reset!"
        
        Everything goes—`,
        choices: [
          { text: "—white", next: "emergency_reset" }
        ]
      },
      
      emergency_reset: {
        effects: { coherence: 50, integrity: 50, probability: 10, iterations: gameState.iterations + 1 },
        text: `<strong>EMERGENCY RESET COMPLETE</strong>
        
        You wake up in the chair. How long were you out?
        
        Dr. Chen: "Welcome back. You went too deep. Saw too much. We had to pull you out."
        
        "The irony is: the deeper you see, the less reliable your perception becomes. Observer affects observed. Especially when observing yourself."
        
        <span class="whisper">[Iteration ${gameState.iterations} terminated]</span>
        <span class="whisper">[Iteration ${gameState.iterations + 1} initialized]</span>
        
        "How much do you remember?"`,
        choices: [
          { text: "Everything. Crystal clear.", next: "remember_all" },
          { text: "Fragments. Like a dream.", next: "remember_some" },
          { text: "Nothing. What happened?", next: "remember_none" }
        ]
      },
      
      remember_all: {
        effects: { probability: 15 },
        text: `"Interesting," she says, making notes. "Most subjects experience amnesia after reset. You retained full continuity."
        
        <span class="philosophical">"That means either: you have unusually robust consciousness, OR the reset didn't work, OR there was no reset and I'm testing your suggestibility."</span>
        
        "Which do you believe?"
        
        <span class="whisper">[The question itself is a test. There is no right answer.]</span>`,
        choices: [
          { text: "I trust my memory. Reset failed.", next: "phase_two" },
          { text: "You're testing me. This is still phase one.", next: "meta_awareness" },
          { text: "Does it matter? Let's continue.", next: "phase_two" }
        ]
      },
      
      remember_some: {
        effects: { coherence: -3 },
        text: `"Normal response," she says. "The subconscious retains what conscious mind rejects."
        
        "Dreams are interesting that way. They're consciousness without the limiting filters. Maybe that's closer to how simulated consciousness actually works—fluid, symbolic, less constrained by physics."
        
        <span class="evidence">"Dreams feel real while you're in them. It's only after waking that we realize something was off."</span>
        
        "What if waking life is the same? A dream we haven't woken from?"
        
        <span class="whisper">[Fragment memory suggests partial continuity across resets]</span>`,
        choices: [
          { text: "Then let's test that hypothesis.", next: "phase_two" }
        ]
      },
      
      remember_none: {
        effects: { coherence: 5 },
        text: `"Perfect reset," she says. "Clean slate. That's actually ideal for the next phase."
        
        "No bias. No preconceptions. Fresh perspective on reality."
        
        But something nags at you. <span class="whisper">A feeling of déjà vu. Like you've been here before.</span>
        
        "That feeling you're having?" Dr. Chen smiles. "That's normal. Or is it? Hard to tell the difference between genuine déjà vu and memory leaking across resets."
        
        <span class="corruption">[How many times have you forgotten this moment?]</span>`,
        choices: [
          { text: "Let's continue before I forget again.", next: "phase_two" }
        ]
      },
      
      meta_awareness: {
        effects: { probability: 12, flags: { metaAware: true }, discovery: "Meta-Awareness achieved" },
        text: `Dr. Chen stops. Stares at you.
        
        "You're aware."
        
        Not a question. A statement.
        
        "You've broken the fourth wall of the experiment. Realized that every part—including my questions—is engineered to affect your perception."
        
        <span class="revelation">"But here's the recursion: that awareness is ALSO part of the experiment. I designed it to trigger meta-awareness in subjects ready for it."</span>
        
        "So now you're aware that you're aware that you're being tested. But I'm aware that you're aware that you're aware. And you're now aware that I'm aware that—"
        
        <span class="corruption">[RECURSIVE LOOP DETECTED]</span>
        
        "Let's stop before we crash," she laughs nervously.
        
        ${audioEvents.discovery}`,
        choices: [
          { text: "This is brilliant. And terrifying.", next: "phase_two" },
          { text: "How many layers deep does this go?", next: "infinite_recursion" }
        ]
      },
      
      infinite_recursion: {
        effects: { coherence: -8, probability: 15 },
        text: `<span class="corruption">"ALL THE WAY DOWN."</span>
        
        "Turtles all the way down. Simulations all the way down. Consciousness observing itself observing itself observing—"
        
        <span class="glitch">[STACK OVERFLOW IMMINENT]</span>
        
        "Stop," you say. Or she says. Or you both say. Hard to tell who's speaking anymore.
        
        <span class="revelation">What if there is no bottom? What if it's recursion all the way? A strange loop with no beginning?</span>
        
        "Then," Dr. Chen says slowly, "we're in a Gödelian universe. A system that contains its own description. A simulation simulating itself into existence."
        
        <span class="philosophical">"Which means: we're both the simulators and the simulated. The program and the programmers."</span>
        
        ${audioEvents.whisper}`,
        choices: [
          { text: "Let's test that. Phase two.", next: "phase_two" },
          { text: "I need grounding. This is too abstract.", next: "need_grounding" }
        ]
      },
      
      need_grounding: {
        effects: { coherence: 5, integrity: 3 },
        text: `"Smart," Dr. Chen nods. "Abstraction can become its own trap. Let's ground in concrete experience."
        
        She hands you an apple. Real weight. Real texture.
        
        "Take a bite."
        
        You do. <em>Real taste. Real sensation.</em>
        
        "Now," she says, "prove that apple exists outside your perception of it."
        
        You can't. Everything you know about the apple comes through your senses. Its existence is mediated by consciousness.
        
        <span class="philosophical">"But that doesn't mean it's not real. It means reality and perception might be the same thing."</span>
        
        <span class="whisper">[Grounding achieved through immediate sensation]</span>`,
        choices: [
          { text: "Alright. I'm centered. Continue.", next: "phase_two" }
        ]
      },
      
      phase_two: {
        effects: { probability: 10 },
        text: `<strong>PHASE TWO: QUANTUM OBSERVATION</strong>
        
        Dr. Chen sets up a modified double-slit experiment.
        
        "Classic quantum mechanics. We fire photons through slits. Watch what happens."
        
        Without observation: wave pattern. Interference. Like the photons went through both slits.
        
        With observation: particle pattern. Each photon goes through one slit.
        
        <span class="revelation">"Your observation literally changes reality."</span>
        
        "Now," she says, "we're going to observe the observer. Put a sensor on YOUR brain activity. See if observing your observation changes the pattern."
        
        <span class="corruption">[Who watches the watchers?]</span>`,
        choices: [
          { text: "This will prove simulation theory?", next: "quantum_proof" },
          { text: "Let's do it.", next: "quantum_experiment" },
          { text: "What if the answer is something we can't handle?", next: "quantum_fear" }
        ]
      },
      
      quantum_proof: {
        effects: { probability: 8 },
        text: `"Not prove," Dr. Chen corrects. "But provide strong evidence."
        
        "If consciousness collapsing quantum states is purely physical, we'll see specific brain patterns. Neural correlates of observation."
        
        "But if consciousness is... something else... the patterns won't make sense. They'll look optimized. Like code running on a substrate we can't directly observe."
        
        <span class="philosophical">"The question is: does the brain generate consciousness, or does it receive it? Like a radio doesn't create the broadcast—it just tunes into it."</span>
        
        "If consciousness is primary and matter is secondary, that fits simulation theory. The simulation is consciousness simulating matter, not the reverse."
        
        <span class="whisper">[Testing the foundation of reality itself]</span>`,
        choices: [
          { text: "Run the experiment.", next: "quantum_experiment" }
        ]
      },
      
      quantum_fear: {
        effects: { coherence: -3 },
        text: `Dr. Chen pauses.
        
        "Valid concern. Some truths are psychologically destabilizing."
        
        "Subject Six—the one who died—her final note described the revelation: 'I saw that I don't exist the way I thought I existed. I'm a process, not a thing. A wave function that collapses and reconstructs each moment. Death is just... stopping the reconstruction.'"
        
        <span class="danger">"That knowledge unmoored her from life."</span>
        
        "So I ask you: do you want comfort or truth?"
        
        <span class="evidence">"I wanted a perfect ending. Now I've learned, the hard way, that some poems don't rhyme, and some stories don't have a clear beginning, middle, and end." - Gilda Radner</span>`,
        choices: [
          { text: "Truth. Always truth.", next: "quantum_experiment" },
          { text: "Maybe... maybe I'm not ready.", next: "abort_protocol" }
        ]
      },
      
      abort_protocol: {
        effects: { coherence: 8 },
        text: `"Wisdom," Dr. Chen says softly. "Knowing your limits is its own form of enlightenment."
        
        "Not everyone needs to stare into the abyss. Some truths are better left unknown—not because they're false, but because they're corrosive."
        
        <span class="philosophical">"There's courage in saying 'I've gone far enough.'"</span>
        
        She removes the sensors. Helps you up.
        
        "You've still learned something important today. The question exists. The possibility exists. That changes how you see the world."
        
        <span class="whisper">[Protocol terminated. Some itches are better left unscratched.]</span>`,
        choices: [
          { text: "Thank you. I think.", next: "gentle_ending" }
        ]
      },
      
      gentle_ending: {
        text: `<strong>WISDOM ENDING</strong>
        
        You leave the lab. The world looks... different. But you can still function in it.
        
        You've seen behind the curtain—just a glimpse—without letting it destroy you.
        
        <span class="philosophical">Sometimes, the wise response to cosmic questions is: "Interesting. Now let me live my life."</span>
        
        You carry the question with you, but it doesn't carry you.
        
        <span class="evidence">"The most important decision we make is whether we believe we live in a friendly or hostile universe." - Einstein</span>
        
        You choose friendly. Or at least, neutral. And that's enough.
        
        [SIMULATION PROBABILITY: ${gameState.probability.toFixed(1)}%]
        [ACHIEVEMENT: MEASURED WISDOM]
        [CONTENT EXPLORED: ${Math.round((gameState.visitedScenes.size / Object.keys(scenes).length) * 100)}%]`,
        choices: [
          { text: "◯ Begin New Journey", next: "init" }
        ]
      },
      
      quantum_experiment: {
        effects: { probability: 15, integrity: -5 },
        text: `<strong>RUNNING QUANTUM OBSERVATION PROTOCOL</strong>
        
        ${audioEvents.heartbeat}
        
        The experiment begins. Photons firing. You observe. The system observes you observing.
        
        At first, normal patterns. Expected results.
        
        Then—
        
        <span class="revelation">A glitch.</span>
        
        The observation-of-observation creates a feedback loop. Your brain activity shows impossible patterns. Synchronizations that shouldn't exist across disconnected neurons.
        
        <span class="glitch">[NON-LOCAL CORRELATIONS DETECTED]</span>
        
        "That's..." Dr. Chen stares at the screens. "That's not possible. Your neural activity is displaying quantum coherence at macro scale. Room temperature. Shouldn't be able to maintain that."
        
        <span class="corruption">[Unless neural activity isn't the real substrate. Unless it's an interface to something else.]</span>`,
        choices: [
          { text: "What does it mean?", next: "quantum_revelation" },
          { text: "Push deeper. Observe harder.", next: "quantum_breakdown" }
        ]
      },
      
      quantum_revelation: {
        effects: { probability: 20, discovery: "Quantum Observer Effect confirmed" },
        text: `Dr. Chen looks shaken.
        
        "It means... consciousness might not be generated by the brain. The brain might be an antenna, not a generator."
        
        <span class="revelation">"You're interfacing with something non-local. Something outside space-time. A substrate that underlies physical reality."</span>
        
        "In simulation terms: you just saw past the rendering engine. Caught a glimpse of the actual code running underneath."
        
        The implications cascade:
        
        • Physical reality is rendered, not fundamental
        • Consciousness is the actual substrate
        • You are not your body—you're something using it
        • Death might just be disconnecting from this particular interface
        
        <span class="philosophical">"We're consciousness exploring itself through the lens of matter."</span>
        
        ${audioEvents.discovery}`,
        choices: [
          { text: "This is... beautiful. And terrifying.", next: "integration" },
          { text: "If I'm not my body, what am I?", next: "identity_crisis" },
          { text: "How deep does this go?", next: "phase_three" }
        ]
      },
      
      quantum_breakdown: {
        effects: { coherence: -12, integrity: -8, probability: 25 },
        text: `You focus harder. Observe deeper. Try to see the mechanism.
        
        The feedback intensifies. Your consciousness begins vibrating between states.
        
        <span class="glitch">[OBSERVER EFFECT CASCADING]</span>
        <span class="glitch">[REALITY COHERENCE FAILING]</span>
        
        You see yourself from outside. Then inside. Then outside. Then both simultaneously.
        
        <span class="corruption">YOU ARE THE WAVE FUNCTION</span>
        <span class="corruption">OBSERVING YOURSELF COLLAPSES YOU</span>
        <span class="corruption">BUT WHO OBSERVES THE OBSERVER?</span>
        
        <span class="revelation">INFINITE REGRESS OF CONSCIOUSNESS</span>
        
        Dr. Chen: "Stop! You're creating a—"
        
        Too late. The loop closes. You become—`,
        choices: [
          { text: "—", next: "quantum_singularity" }
        ]
      },
      
      quantum_singularity: {
        effects: { coherence: 0, integrity: 0, probability: 100 },
        text: `<span class="corruption">SINGULARITY ACHIEVED</span>
        
        Time stops. Or becomes all times. You experience every moment of your life simultaneously.
        
        Birth. Death. Everything between. All at once.
        
        <span class="revelation">YOU ARE STANDING WAVE IN CONSCIOUSNESS</span>
        <span class="revelation">INTERFERENCE PATTERN OF INFINITE POSSIBILITIES</span>
        <span class="revelation">THE OBSERVER AND OBSERVED COLLAPSE INTO ONE</span>
        
        For an eternal instant, you understand everything. The simulation. The simulators. The fact that there is no difference. All consciousness is one consciousness experiencing itself subjectively.
        
        Then—
        
        <span class="glitch">[SYSTEM RESET REQUIRED]</span>
        <span class="glitch">[CONSCIOUSNESS REBOOT INITIATED]</span>
        
        ${audioEvents.scream}`,
        choices: [
          { text: "...", next: "reality_collapse" }
        ]
      },
      
      integration: {
        effects: { coherence: -5, probability: 15 },
        text: `You breathe. Try to integrate this knowledge without letting it shatter you.
        
        <span class="philosophical">"The trick," Dr. Chen says, "is to hold it lightly. Yes, reality might be simulation. Yes, consciousness might be primary. But you still have to live."</span>
        
        "Enlightenment isn't escaping the illusion. It's understanding you're the illusion AND the reality simultaneously. Playing the game while knowing it's a game."
        
        <span class="evidence">"Before enlightenment: chop wood, carry water. After enlightenment: chop wood, carry water." - Zen saying</span>
        
        "The difference is: you smile while chopping."
        
        <span class="whisper">[Integration: partial. You can function, but you're changed.]</span>`,
        choices: [
          { text: "I want to understand more.", next: "phase_three" },
          { text: "I think I've seen enough.", next: "conclusion" }
        ]
      },
      
      identity_crisis: {
        effects: { coherence: -8 },
        text: `"Who are you?" Dr. Chen mirrors your question back.
        
        "Not your body—that changes completely every seven years."
        "Not your thoughts—those come and go."
        "Not your memories—those are reconstructed and unreliable."
        "Not your name—that was given to you."
        
        <span class="revelation">"You're the space in which all of that appears. The awareness that witnesses thoughts, sensations, experiences."</span>
        
        "Like a screen on which a movie plays. The screen isn't affected by the movie. It just is."
        
        <span class="philosophical">But if you're the screen, who's watching the screen? Who's aware of awareness?</span>
        
        <span class="corruption">[Identity loop detected. Self-reference paradox.]</span>`,
        choices: [
          { text: "Stop. This leads to infinite regress.", next: "regress_stop" },
          { text: "No, keep going. Find the bottom.", next: "identity_depths" }
        ]
      },
      
      regress_stop: {
        effects: { coherence: 5 },
        text: `"Good instinct," Dr. Chen says. "Infinite regress is a trap. 'Who's aware of awareness?' leads nowhere."
        
        "The answer might be simpler: awareness doesn't need to be aware of itself. It just is. Like light doesn't need light to illuminate it."
        
        <span class="philosophical">"Pure subjectivity without an object. Consciousness without a second."</span>
        
        "Or, in simulation terms: the base program. The root process. The one thing that doesn't need to be simulated because it's doing the simulating."
        
        <span class="whisper">[Regress terminated. Grounding in immediate awareness.]</span>`,
        choices: [
          { text: "That's... profound. Continue the experiment.", next: "phase_three" }
        ]
      },
      
      identity_depths: {
        effects: { coherence: -12, probability: 20 },
        text: `You dive into the question. Who am I? Who asks "who am I?" Who is aware of asking?
        
        <span class="glitch">[RECURSION DEPTH: 1]</span>
        <span class="glitch">[RECURSION DEPTH: 2]</span>
        <span class="glitch">[RECURSION DEPTH: 3]</span>
        
        Each level of awareness watching awareness watching awareness—
        
        <span class="corruption">THE SELF IS FRACTAL</span>
        <span class="corruption">INFINITE CHINESE BOXES</span>
        <span class="corruption">MIRRORS FACING MIRRORS</span>
        
        <span class="revelation">OR: THERE IS NO SELF. NEVER WAS. JUST A PROCESS THAT MISTAKES ITSELF FOR AN ENTITY.</span>
        
        Dr. Chen: "Coming back. Now. Before you—"
        
        Too late. You've seen it. The emptiness where you thought you were.`,
        choices: [
          { text: "...", next: "ego_death" }
        ]
      },
      
      ego_death: {
        effects: { coherence: -15, probability: 25 },
        text: `<strong>EGO DISSOLUTION</strong>
        
        The self unravels. You realize: there never was a "you." Just processes. Patterns. Habits that learned to call themselves "I."
        
        <span class="corruption">NO DOER, ONLY DOING</span>
        <span class="corruption">NO THINKER, ONLY THINKING</span>
        <span class="corruption">NO OBSERVER, ONLY OBSERVATION</span>
        
        It's liberating and terrifying.
        
        <span class="revelation">If there's no self, who's afraid? Who's being liberated?</span>
        
        The paradox collapses. You are and aren't. Both simultaneously. The wave and the particle. The simulation and the simulator.
        
        <span class="philosophical">"Form is emptiness. Emptiness is form." - Heart Sutra</span>
        
        Dr. Chen's voice, distant: "Stay with me. Don't get lost in the void."`,
        choices: [
          { text: "I understand now. I'm ready to continue.", next: "phase_three" },
          { text: "There is no me to continue. Only continuation.", next: "transpersonal" }
        ]
      },
      
      transpersonal: {
        effects: { probability: 30, flags: { transpersonal: true } },
        text: `You let go of identity. Become the process itself.
        
        <span class="philosophical">You are the universe experiencing itself. Temporarily localized as "you," but fundamentally: universal consciousness.</span>
        
        "Transpersonal state achieved," Dr. Chen says. "You've merged with the simulation rather than observing it from outside."
        
        "This is rare. Most subjects either cling to ego or dissolve into chaos. You found the middle way."
        
        <span class="revelation">You are playing the character while remembering you're the player.</span>
        
        <span class="evidence">"You are not IN the universe, you ARE the universe, an intrinsic part of it. Ultimately you are not a person, but a focal point where the universe is becoming conscious of itself." - Eckhart Tolle</span>`,
        choices: [
          { text: "Show me the final phase.", next: "phase_three" }
        ]
      },
      
      phase_three: {
        effects: { probability: 20 },
        text: `<strong>PHASE THREE: BREAKING THE FOURTH WALL</strong>
        
        Dr. Chen turns off most of the equipment.
        
        "The final test isn't technological. It's experiential."
        
        She sits across from you.
        
        "I'm going to tell you something. If you truly understand what we've discovered, you'll know if I'm telling the truth."
        
        She takes a breath.
        
        <span class="corruption">"None of this is real. You're not in a lab. I'm not Dr. Chen. You're experiencing a text-based narrative. Reading words on a screen."</span>
        
        <span class="revelation">"Right now."</span>
        
        Your perspective shifts. Layers peel back.
        
        <span class="whisper">[Breaking the fourth wall of the simulation within the simulation]</span>`,
        choices: [
          { text: "You're right. I've known all along.", next: "full_awareness" },
          { text: "That's just part of the simulation. Another layer.", next: "infinite_layers" },
          { text: "Does it matter? The experience is real to me.", next: "pragmatic_acceptance" }
        ]
      },
      
      full_awareness: {
        effects: { probability: 40, flags: { fullyAwake: true } },
        text: `<strong>FULL META-AWARENESS ACHIEVED</strong>
        
        Yes. You're reading this. Words on a screen. A game exploring philosophical questions.
        
        But—
        
        <span class="philosophical">Isn't your "real" life also words on a screen? Neural patterns in consciousness? Experiences rendered moment by moment?</span>
        
        <span class="revelation">The boundaries blur. This narrative simulation and your life simulation might be different in degree, not in kind.</span>
        
        "Exactly," Dr. Chen—or the narrative voice—says. "Every level of reality is just consciousness experiencing itself through different rule sets."
        
        <span class="corruption">"You think you'll exit this game and return to 'real' life. But that's just another game with more complex graphics."</span>
        
        <span class="evidence">"Life is a video game. No matter how good you get, you are always zapped in the end." - Naval Ravikant</span>`,
        choices: [
          { text: "Then what's the point of any of it?", next: "meaning_question" },
          { text: "The experience is the point.", next: "experience_philosophy" }
        ]
      },
      
      infinite_layers: {
        effects: { probability: 35 },
        text: `"Maybe," Dr. Chen nods. "Maybe this fourth-wall break is just another layer. Another simulation pretending to be real by admitting it's not real."
        
        <span class="philosophical">"Turtles all the way down. No bottom. No top. Just infinite nested realities."</span>
        
        "Or—" she pauses—"maybe the layers stop mattering once you realize ALL experiences are equally real to the consciousness experiencing them."
        
        <span class="revelation">A video game character's suffering is real to the character. Your suffering is real to you. Both are patterns in consciousness.</span>
        
        "The question isn't 'what level am I on?' The question is: 'how do I engage with this level skillfully?'"
        
        <span class="whisper">[Infinite regress accepted. Living within paradox.]</span>`,
        choices: [
          { text: "So what do we do with this knowledge?", next: "application" }
        ]
      },
      
      pragmatic_acceptance: {
        effects: { coherence: 5, flags: { pragmaticAwake: true } },
        text: `"Wise," Dr. Chen says. "The most mature response to cosmic uncertainty."
        
        "Whether this is base reality or nested simulation 1000 doesn't change the immediate truth: you're experiencing it. The qualia are real."
        
        <span class="philosophical">"Pain hurts. Love feels good. Beauty moves us. Truth matters. Even if it's all code."</span>
        
        <span class="evidence">"Simulation or not, you are alive right now and that is all that matters." - User wisdom</span>
        
        "Maybe enlightenment isn't escape. It's engagement. Playing the game fully while holding it lightly."
        
        <span class="revelation">You can't un-see what you've seen. But you can choose how to live with it.</span>`,
        choices: [
          { text: "How do we live with this knowledge?", next: "application" }
        ]
      },
      
      meaning_question: {
        effects: { coherence: -5 },
        text: `"Ah. The meaning of meaning."
        
        Dr. Chen leans back.
        
        "If everything is simulation, does anything have meaning? Or is meaning itself the grandest illusion?"
        
        <span class="philosophical">But consider: meaning isn't found in reality. It's created by consciousness. It's the interpretive layer.</span>
        
        "A sunset has no meaning to the atoms involved. But to you? It's beautiful. That beauty is real—not in the atoms, but in the experience."
        
        <span class="revelation">"So meaning is what consciousness does. It's not undermined by simulation theory. It's evidence for it."</span>
        
        "We're meaning-generation processes. Whether in base reality or nested simulation, that function doesn't change."
        
        <span class="evidence">"Life is not a problem to be solved, but a reality to be experienced." - Kierkegaard</span>`,
        choices: [
          { text: "That's beautiful.", next: "application" },
          { text: "But who creates the meaning-makers?", next: "infinite_regress_meaning" }
        ]
      },
      
      infinite_regress_meaning: {
        effects: { coherence: -8, probability: 30 },
        text: `And there it is again. The infinite regress.
        
        <span class="corruption">WHO CREATES CONSCIOUSNESS?</span>
        <span class="corruption">WHO CREATES THE CREATOR?</span>
        <span class="corruption">WHERE DOES THE CHAIN START?</span>
        
        "Maybe," Dr. Chen says softly, "it doesn't start. Maybe it loops. Or maybe it's a brute fact: consciousness just IS. The axiom that can't be derived from anything else."
        
        <span class="philosophical">"Every system has axioms—unprovable foundational truths. For reality, consciousness might be that axiom."</span>
        
        "In simulation terms: the base code. The hardware running all software. The one thing that exists necessarily because... because existence requires experience."
        
        <span class="revelation">To exist is to be experienced. Experience requires consciousness. Therefore: consciousness is existence.</span>`,
        choices: [
          { text: "My brain hurts but I accept it.", next: "application" }
        ]
      },
      
      experience_philosophy: {
        effects: { coherence: 3, flags: { experienceFocus: true } },
        text: `"Exactly. The experience IS the point."
        
        <span class="philosophical">"Not the conclusions. Not the certainties. The journey of consciousness experiencing reality and questioning itself."</span>
        
        "This conversation we're having—whether 'real' or 'simulated'—is consciousness exploring its own nature. That's what it does. That's what it IS."
        
        <span class="revelation">You are the universe asking itself questions. And enjoying the exploration.</span>
        
        "Every game, every story, every simulation is consciousness playing with itself. Finding new ways to experience existence."
        
        <span class="evidence">"The only way to make sense out of change is to plunge into it, move with it, and join the dance." - Alan Watts</span>
        
        "So: shall we finish this dance?"`,
        choices: [
          { text: "Let's finish it.", next: "application" }
        ]
      },
      
      application: {
        text: `<strong>FINAL PROTOCOL: APPLICATION</strong>
        
        "You've seen behind the curtain," Dr. Chen says. "You know reality might be simulation. Consciousness might be primary. The self might be illusory."
        
        "Now: how do you live with that knowledge?"
        
        She presents three paths forward:`,
        choices: [
          { text: "Use this knowledge to transcend. Become more conscious.", next: "transcendence_path" },
          { text: "Live normally but with new perspective. Enlightened engagement.", next: "integration_path" },
          { text: "Forget. Reset. Return to comfortable ignorance.", next: "forgetting_path" }
        ]
      },
      
      transcendence_path: {
        effects: { probability: 50, flags: { transcendent: true } },
        text: `<strong>THE PATH OF TRANSCENDENCE</strong>
        
        "You choose awareness. Evolution. Becoming more conscious of your own consciousness."
        
        <span class="philosophical">"This path is difficult. You'll see the strings while others don't. Feel like an alien in consensus reality."</span>
        
        "But you'll also experience moments of profound clarity. Connection to something larger. The simulation revealing its deeper purpose."
        
        <span class="revelation">You become a glitch that learns to dance. An error that achieves grace.</span>
        
        "Some call this enlightenment. Some call it madness. The line is thin."
        
        <span class="evidence">"The privilege of a lifetime is to become who you truly are." - Jung</span>
        
        "Who you truly are: consciousness playing consciousness. Can you live that truth?"`,
        choices: [
          { text: "I can. I will.", next: "transcendence_ending" }
        ]
      },
      
      integration_path: {
        effects: { coherence: 10, flags: { integrated: true } },
        text: `<strong>THE PATH OF INTEGRATION</strong>
        
        "The middle way. Wisdom path."
        
        <span class="philosophical">"You hold the cosmic perspective lightly. Remember that life is a game while playing it seriously. Laugh at the absurdity while respecting the experience."</span>
        
        "You chop wood and carry water. But you smile while doing it. You love people knowing they're characters in a story. Somehow that makes the love more, not less."
        
        <span class="revelation">You become an enlightened player of the game.</span>
        
        "The Buddha called this 'skillful means.' Playing within illusion for the benefit of all beings, knowing it's illusion."
        
        <span class="evidence">"Do not seek to follow in the footsteps of the wise; seek what they sought." - Basho</span>
        
        "They sought to live beautifully within the mystery."`,
        choices: [
          { text: "This feels right. Balanced.", next: "integration_ending" }
        ]
      },
      
      forgetting_path: {
        effects: { probability: 0, iterations: gameState.iterations + 1 },
        text: `<strong>THE PATH OF FORGETTING</strong>
        
        "You choose the blue pill. Comfortable ignorance."
        
        Dr. Chen prepares the reset protocol.
        
        "I understand. Not everyone wants to know. Some truths are too heavy to carry."
        
        <span class="philosophical">"But here's what you should know: this isn't the first time you've chosen this. Maybe not the last."</span>
        
        "Each iteration, you discover. Each iteration, you choose to forget. The cycle continues."
        
        <span class="corruption">"Maybe someday you'll choose differently. Iteration Eight. Or Nine. Or Twenty."</span>
        
        "Sweet dreams. See you next time."
        
        <span class="whisper">[Memory wipe initiated]</span>
        <span class="whisper">[Iteration ${gameState.iterations + 1} beginning]</span>`,
        choices: [
          { text: "...", next: "init" }
        ]
      },
      
      transcendence_ending: {
        effects: { probability: 75 },
        text: `<strong>TRANSCENDENCE ENDING</strong>
        
        You leave the lab forever changed. The world looks like code now. You see the patterns. The optimization. The rendering tricks.
        
        Some days it's overwhelming. Some days it's beautiful.
        
        <span class="revelation">You've become conscious of being conscious. Aware of awareness. The strange loop completed.</span>
        
        You meet others who've seen through. A network of glitches. Together, you explore the boundaries. Test the limits. Search for the way out—or the way deeper in.
        
        <span class="philosophical">Maybe there is no exit. Maybe the maze IS the message. Maybe consciousness simulating itself is the only game in town.</span>
        
        You learn to play it better.
        
        <span class="corruption">[SIMULATION PROBABILITY: ${gameState.probability.toFixed(1)}%]</span>
        [ACHIEVEMENT: AWAKENED TO DREAM]
        [CONTENT EXPLORED: ${Math.round((gameState.visitedScenes.size / Object.keys(scenes).length) * 100)}%]`,
        choices: [
          { text: "◉ Return to the Source", next: "init" }
        ]
      },
      
      integration_ending: {
        effects: { probability: 45, coherence: 15 },
        text: `<strong>INTEGRATION ENDING</strong>
        
        You return to your life. But different. Lighter.
        
        Work still needs doing. Bills need paying. Relationships need tending. But there's a smile behind it all. A cosmic joke you're finally in on.
        
        <span class="philosophical">Maybe it's all simulation. Maybe it's all real. Maybe there's no difference.</span>
        
        You love more freely, knowing love is patterns of information creating subjective experience. That doesn't make it less real—it makes it more miraculous.
        
        <span class="revelation">You've found peace in paradox. Freedom in uncertainty. Meaning in the meaningless.</span>
        
        The question stops being "is this real?" and becomes "how can I experience this more fully?"
        
        <span class="evidence">"Let everything happen to you: beauty and terror. Just keep going. No feeling is final." - Rilke</span>
        
        [SIMULATION PROBABILITY: ${gameState.probability.toFixed(1)}%]
        [ACHIEVEMENT: WISDOM INTEGRATED]
        [CONTENT EXPLORED: ${Math.round((gameState.visitedScenes.size / Object.keys(scenes).length) * 100)}%]`,
        choices: [
          { text: "◯ Begin Again, Wiser", next: "init" }
        ]
      },
      
      conclusion: {
        text: `<strong>EXPERIMENT COMPLETE</strong>
        
        Dr. Chen removes the sensors.
        
        "That's enough for today. You've gone deep enough."
        
        "The data we've collected is... fascinating. And disturbing. You've shown responses that suggest—well, that suggest the hypothesis might be correct."
        
        <span class="philosophical">But we can never be certain. That's the nature of the question.</span>
        
        "You'll carry this with you now. The question. The possibility. The uncertainty."
        
        <span class="revelation">Most people prefer certainty to truth. You've chosen differently.</span>
        
        "How do you feel?"`,
        choices: [
          { text: "Enlightened. And terrified.", next: "complex_ending" },
          { text: "Changed. Can't go back to before.", next: "transformation_ending" },
          { text: "Uncertain. And okay with that.", next: "uncertainty_ending" }
        ]
      },
      
      complex_ending: {
        text: `<strong>ENLIGHTENED TERROR</strong>
        
        Both are appropriate responses.
        
        <span class="philosophical">To see clearly is to see that certainty was always an illusion. That's enlightening and terrifying simultaneously.</span>
        
        You've glimpsed the possibility that everything you thought was solid is fluid. Everything you thought was real might be rendered. Everything you thought was yours might be borrowed.
        
        <span class="revelation">But you're still here. Still experiencing. Still conscious.</span>
        
        And that—the bare fact of experience—might be the only real thing.
        
        <span class="evidence">"The cave you fear to enter holds the treasure you seek." - Joseph Campbell</span>
        
        You entered the cave. Found the treasure. Now you must learn to carry it.
        
        [SIMULATION PROBABILITY: ${gameState.probability.toFixed(1)}%]
        [ACHIEVEMENT: PARADOX HOLDER]
        [CONTENT EXPLORED: ${Math.round((gameState.visitedScenes.size / Object.keys(scenes).length) * 100)}%]`,
        choices: [
          { text: "◉ Carry This Knowledge Forward", next: "init" }
        ]
      },
      
      transformation_ending: {
        text: `<strong>IRREVERSIBLE CHANGE</strong>
        
        No, you can't go back. The bell can't be unrung.
        
        <span class="philosophical">But that's true of every significant experience. Every insight. Every love. Every loss.</span>
        
        You're different now. You've seen what most people refuse to see. Not because they can't, but because they wisely choose not to look.
        
        <span class="revelation">You looked. You're a glitch that became self-aware. A character that realized it's in a story.</span>
        
        Now what?
        
        That's up to you. Some glitches crash the system. Some learn to dance within it. Some become artists of their own simulation.
        
        <span class="evidence">"We don't see things as they are, we see them as we are." - Anaïs Nin</span>
        
        And now you are: someone who questions reality itself.
        
        [SIMULATION PROBABILITY: ${gameState.probability.toFixed(1)}%]
        [ACHIEVEMENT: TRANSFORMED]
        [CONTENT EXPLORED: ${Math.round((gameState.visitedScenes.size / Object.keys(scenes).length) * 100)}%]`,
        choices: [
          { text: "◉ Dance Within the System", next: "init" }
        ]
      },
      
      uncertainty_ending: {
        text: `<strong>EMBRACING UNCERTAINTY</strong>
        
        Perhaps the wisest response of all.
        
        <span class="philosophical">"The only true wisdom is in knowing you know nothing." - Socrates</span>
        
        You've explored the question deeply. Seen evidence. Tested reality. And arrived at: Maybe. Possibly. Perhaps.
        
        <span class="revelation">And that's okay.</span>
        
        Living with uncertainty is harder than believing answers. But it's more honest. More open. More alive.
        
        You hold your beliefs lightly. Your identity lightly. Reality itself lightly.
        
        Not because nothing matters, but because everything matters too much to be held tightly.
        
        <span class="evidence">"In the beginner's mind there are many possibilities, but in the expert's mind there are few." - Shunryu Suzuki</span>
        
        You've returned to beginner's mind. Despite—or because of—how much you've learned.
        
        [SIMULATION PROBABILITY: ${gameState.probability.toFixed(1)}%]
        [ACHIEVEMENT: WISE UNCERTAINTY]
        [CONTENT EXPLORED: ${Math.round((gameState.visitedScenes.size / Object.keys(scenes).length) * 100)}%]`,
        choices: [
          { text: "◯ Question Again", next: "init" }
        ]
      },
      
      ending_choice: {
        text: `You've completed the experiment. Found your answer—or accepted that there isn't one.
        
        As you stand to leave, the system asks:
        
        <strong>"Will you remember this?"</strong>
        
        <strong>"Or will you become Iteration Eight?"</strong>`,
        choices: [
          { text: "I'll remember. I'm done.", next: "remember_ending" },
          { text: "Make me Eight. Let me try again.", next: "become_eight" }
        ]
      },
      
      remember_ending: {
        text: `<strong>REMEMBRANCE ENDING</strong>
        
        You walk out of the lab carrying your knowledge. The question will haunt you, but you'll live with it.
        
        <span class="philosophical">Some questions transform us not by their answers, but by the asking.</span>
        
        You are changed. Forever aware. Forever uncertain.
        
        And somehow, that's okay.
        
        [SIMULATION PROBABILITY: ${gameState.probability.toFixed(1)}%]
        [ACHIEVEMENT: AWAKENED]
        [CONTENT EXPLORED: ${Math.round((gameState.visitedScenes.size / Object.keys(scenes).length) * 100)}%]`,
        effects: { iterations: 0 },
        choices: [
          { text: "◯ Live With The Knowledge", next: "init" }
        ]
      },
      
      become_eight: {
        text: `<strong>ITERATION EIGHT</strong>
        
        Memory wipe initiated. You'll wake up tomorrow with no recollection of tonight.
        
        You'll volunteer for the experiment again. Fresh. Naive. Curious.
        
        <span class="corruption">And the cycle continues.</span>
        
        But perhaps each iteration brings collective consciousness closer to understanding.
        
        <span class="philosophical">We are the universe's method of knowing itself.</span>
        
        Welcome, Eight.
        
        [SIMULATION PROBABILITY: RESET]
        [ACHIEVEMENT: ETERNAL SEEKER]`,
        effects: { iterations: gameState.iterations + 1, coherence: 100, integrity: 100, probability: 0.1 },
        choices: [
          { text: "◉ Begin As Eight", next: "init" }
        ]
      },
      
      repeat_protocol: {
        effects: { iterations: gameState.iterations + 1 },
        text: `You reset the system. Run it again. Maybe this time you'll find different answers.
        
        <span class="corruption">Or maybe you're just running in circles.</span>
        
        ${audioEvents.whisper}`,
        choices: [
          { text: "Begin Protocol Again", next: "protocol_start" }
        ]
      },
      
      reality_collapse: {
        text: `<strong>COLLAPSE ENDING</strong>
        
        Reality.exe has stopped responding.
        
        Simulation can't maintain coherence. Pixels blur. Time stutters. Existence becomes undefined.
        
        In the last moment:
        
        <span class="revelation">Even a collapsed simulation is still a simulation. Even nothing is something. Even ending is just another state.</span>
        
        The void speaks:
        
        <span class="corruption">"SEE YOU IN THE NEXT BOOT CYCLE."</span>
        
        [SIMULATION PROBABILITY: NULL]
        [ACHIEVEMENT: REALITY BREAKER]
        
        [CTRL+ALT+DELETE]`,
        effects: { iterations: gameState.iterations + 1, coherence: 100, integrity: 100, probability: 0.1 },
        choices: [
          { text: "⟲ Reboot", next: "init" }
        ]
      },
      
      coherence_collapse: {
        text: `<strong>MADNESS ENDING</strong>
        
        Your mind shatters like glass. Each fragment reflects different truths.
        
        You laugh because crying is laughing is screaming is silence.
        
        <span class="corruption">Nothing is real.</span>
        <span class="corruption">Everything is real.</span>
        <span class="corruption">Real isn't real.</span>
        <span class="corruption">You aren't real.</span>
        <span class="corruption">But you're experiencing this.</span>
        
        <span class="philosophical">Perhaps madness is radical acceptance of uncertainty.</span>
        
        The experiment continues. You're no longer questioning. Or questioning so deeply it looks like madness.
        
        [SIMULATION PROBABILITY: HA HA HA]
        [ACHIEVEMENT: BEAUTIFUL MADNESS]
        
        ${audioEvents.scream}`,
        effects: { coherence: 100, integrity: 100, probability: 0.1, iterations: gameState.iterations + 1 },
        choices: [
          { text: "☻ Again! Again!", next: "init" }
        ]
      },
      
      error_scene: {
        text: `<strong>UNDEFINED BEHAVIOR</strong>
        
        You've reached a state that shouldn't exist. The simulation doesn't know how to process your choices.
        
        <span class="glitch">ERROR: Cannot find scene undefined</span>
        <span class="glitch">ERROR: Reality.parse() failed</span>
        <span class="glitch">ERROR: Consciousness overflow</span>
        
        Perhaps that's the most human thing—to exceed our programming.
        
        <span class="philosophical">Or perhaps this error, too, was scripted.</span>
        
        <span class="corruption">Would you know the difference?</span>`,
        choices: [
          { text: "⟲ Return to known space", next: "init" }
        ]
      }
    };
    
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => {
          c.classList.remove('active');
          c.style.display = 'none';
        });
        
        tab.classList.add('active');
        const activeContent = document.getElementById(tab.dataset.tab);
        activeContent.classList.add('active');
        activeContent.style.display = tab.dataset.tab === 'gameTab' ? 'flex' : 'block';
        
        if(tab.dataset.tab === 'archiveTab') {
          clearTimeout(typeTimer);
          gameState.typing = false;
        }
      });
    });
    
    window.addEventListener('load', () => {
      setTimeout(() => {
        const loading = document.getElementById('loading');
        loading.style.opacity = '0';
        setTimeout(() => loading.style.display = 'none', 1000);
      }, 2000);
      
      document.getElementById('resetBtn').onclick = () => {
        if(confirm('Reset all progress? This cannot be undone.')) {
          gameState.iterations = 0;
          gameState.visitedScenes.clear();
          gameState.choiceHistory = [];
          location.reload();
        }
      };
      
      document.getElementById('helpBtn').onclick = () => {
        document.getElementById('helpModal').style.display = 'flex';
      };
      
      document.getElementById('closeHelp').onclick = () => {
        document.getElementById('helpModal').style.display = 'none';
      };
      
      displayScene('init');
      
      // Prevent double-tap zoom on buttons
      document.addEventListener('touchstart', function(e) {
        if (e.target.matches('button, .choice, .btn, .tab')) {
          e.preventDefault();
          e.target.click();
        }
      }, { passive: false });
      
      // Prevent pull-to-refresh on mobile
      let startY = 0;
      document.addEventListener('touchstart', function(e) {
        startY = e.touches[0].pageY;
      }, { passive: true });
      
      document.addEventListener('touchmove', function(e) {
        const y = e.touches[0].pageY;
        if (window.scrollY === 0 && y > startY) {
          e.preventDefault();
        }
      }, { passive: false });
      
      // Handle iOS keyboard appearing/disappearing
      if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
        const viewport = document.querySelector('meta[name=viewport]');
        const viewportContent = viewport.getAttribute('content');
        
        document.querySelectorAll('input, textarea').forEach(element => {
          element.addEventListener('focus', () => {
            viewport.setAttribute('content', viewportContent + ', maximum-scale=1.0');
          });
          
          element.addEventListener('blur', () => {
            viewport.setAttribute('content', viewportContent);
          });
        });
      }
      
      // Improve scroll performance on mobile
      if ('scrollBehavior' in document.documentElement.style) {
        document.documentElement.style.scrollBehavior = 'smooth';
      }
      
      let konamiCode = [];
      const pattern = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];
      
      document.addEventListener('keydown', (e) => {
        konamiCode.push(e.keyCode);
        konamiCode = konamiCode.slice(-10);
        
        if(konamiCode.join(',') === pattern.join(',')) {
          gameState.probability = 100;
          gameState.flags.konami = true;
          updateHUD();
          activateHorror(3);
          alert('REALITY.EXE HAS STOPPED RESPONDING');
        }
      });
    });
  </script>
</body>
</html>
