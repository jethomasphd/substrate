<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SUBSTRATE - A Meditation on Reality</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;900&display=swap');
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    :root {
      --bg: #0a0b0f;
      --panel: #0f1114;
      --panel-light: #151821;
      --ink: #c8e6dc;
      --acc: #00ffaa;
      --acc-glow: #00ff8855;
      --muted: #6b8a7f;
      --gold: #ffd700;
      --warn: #ff9f40;
      --danger: #ff4757;
      --safe: #26de81;
      --shadow: 0 10px 40px rgba(0,0,0,0.7);
      --glow: 0 0 20px;
      --corruption: #ff00ff;
    }
    
    body {
      background: linear-gradient(135deg, var(--bg) 0%, #0d0f13 100%);
      color: var(--ink);
      font-family: 'Space Mono', monospace;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      transition: filter 0.3s ease;
    }
    
    body.horror-mode {
      animation: distort 0.1s infinite;
    }
    
    @keyframes distort {
      0% { filter: brightness(1) contrast(1); }
      50% { filter: brightness(0.95) contrast(1.1) hue-rotate(2deg); }
      100% { filter: brightness(1.05) contrast(0.95); }
    }
    
    /* Matrix rain background */
    #matrix {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.03;
      pointer-events: none;
      z-index: 1;
      transition: opacity 0.3s ease;
    }
    
    #matrix.corrupted {
      opacity: 0.1;
      filter: hue-rotate(90deg);
    }
    
    #wrap {
      max-width: 1000px;
      width: 100%;
      margin: 0 auto;
      padding: 20px;
      display: flex;
      gap: 24px;
      flex-direction: column;
      position: relative;
      z-index: 2;
    }
    
    /* Header */
    header {
      text-align: center;
      padding: 20px 0;
      position: relative;
    }
    
    #title {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      letter-spacing: 0.3em;
      font-size: clamp(32px, 6vw, 56px);
      background: linear-gradient(135deg, var(--acc) 0%, var(--ink) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: var(--glow) var(--acc-glow);
      animation: pulse 4s ease-in-out infinite;
      transition: all 0.3s ease;
    }
    
    #title.corrupted {
      animation: pulse 0.2s ease-in-out infinite, glitchText 2s steps(1) infinite;
      filter: blur(0.5px);
    }
    
    @keyframes glitchText {
      0%, 90% { transform: translateX(0); }
      91% { transform: translateX(-2px); }
      92% { transform: translateX(2px); }
      93% { transform: translateX(-1px); }
      94% { transform: translateX(1px); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.85; }
    }
    
    .subtitle {
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }
    
    /* HUD Stats */
    #hud {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin: 20px 0;
    }
    
    .stat-card {
      background: var(--panel);
      border: 1px solid rgba(0, 255, 170, 0.1);
      border-radius: 12px;
      padding: 16px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .stat-card.warning {
      border-color: rgba(255, 71, 87, 0.3);
      animation: warningPulse 1s ease-in-out infinite;
    }
    
    @keyframes warningPulse {
      0%, 100% { box-shadow: var(--shadow); }
      50% { box-shadow: 0 0 30px rgba(255, 71, 87, 0.3); }
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--acc), transparent);
      animation: scan 3s linear infinite;
    }
    
    @keyframes scan {
      to { left: 100%; }
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      border-color: rgba(0, 255, 170, 0.3);
      box-shadow: 0 15px 50px rgba(0, 255, 170, 0.1);
    }
    
    .stat-label {
      font-size: 10px;
      letter-spacing: 0.2em;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }
    
    .stat-value.critical {
      animation: criticalFlash 0.5s ease-in-out infinite;
    }
    
    @keyframes criticalFlash {
      0%, 100% { color: var(--ink); }
      50% { color: var(--danger); }
    }
    
    .stat-bar {
      height: 4px;
      background: rgba(0, 255, 170, 0.1);
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
      position: relative;
    }
    
    .stat-bar-fill {
      height: 100%;
      border-radius: 2px;
      transition: all 0.6s ease;
      position: relative;
    }
    
    .stat-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 20px;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5));
      animation: shimmer 1.5s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }
    
    .coherence-fill { background: linear-gradient(90deg, var(--safe), var(--acc)); }
    .integrity-fill { background: linear-gradient(90deg, var(--warn), var(--gold)); }
    .probability-fill { background: linear-gradient(90deg, var(--danger), var(--warn)); }
    
    /* Tabs */
    #tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(0, 255, 170, 0.1);
      padding-bottom: 10px;
    }
    
    .tab {
      background: transparent;
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 8px 8px 0 0;
      color: var(--muted);
      padding: 10px 20px;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.3s ease;
    }
    
    .tab:hover {
      background: rgba(0, 255, 170, 0.05);
      color: var(--ink);
    }
    
    .tab.active {
      background: rgba(0, 255, 170, 0.1);
      border-color: var(--acc);
      color: var(--acc);
      border-bottom-color: transparent;
    }
    
    .tab-content {
      display: none;
      height: 600px;
      width: 100%;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    /* Main Content */
    main {
      min-height: 600px;
      height: 600px;
      position: relative;
    }
    
    #gameTab {
      display: none;
      flex-direction: column;
      gap: 20px;
      height: 100%;
    }
    
    #gameTab.active {
      display: flex;
    }
    
    #textDisplay {
      background: linear-gradient(135deg, var(--panel) 0%, var(--panel-light) 100%);
      border: 1px solid rgba(0, 255, 170, 0.1);
      border-radius: 16px;
      padding: 28px;
      line-height: 1.8;
      box-shadow: var(--shadow);
      min-height: 250px;
      font-size: 15px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    #textDisplay.glitching {
      animation: glitchBox 0.3s ease-in-out infinite;
    }
    
    @keyframes glitchBox {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-2px); }
      40% { transform: translateX(2px); }
      60% { transform: translateX(-1px); }
      80% { transform: translateX(1px); }
    }
    
    #textDisplay::before {
      content: '>';
      position: absolute;
      left: 12px;
      top: 28px;
      color: var(--acc);
      opacity: 0.5;
      animation: blink 1s step-end infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 0; }
    }
    
    /* Archive Tab */
    #archiveTab {
      background: linear-gradient(135deg, #0a0a0f 0%, var(--panel) 100%);
      border: 1px solid rgba(139, 0, 0, 0.2);
      border-radius: 16px;
      height: 100%;
      width: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
      display: none;
    }
    
    #archiveTab.active {
      display: block;
    }
    
    #archiveTab::-webkit-scrollbar {
      width: 8px;
    }
    
    #archiveTab::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }
    
    #archiveTab::-webkit-scrollbar-thumb {
      background: rgba(0, 255, 170, 0.3);
      border-radius: 4px;
    }
    
    #archiveTab::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 255, 170, 0.5);
    }
    
    .archive-content {
      padding: 28px;
      padding-bottom: 50px;
    }
    
    .archive-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(139, 0, 0, 0.3);
    }
    
    .archive-title {
      color: var(--danger);
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      letter-spacing: 0.3em;
      margin-bottom: 10px;
      text-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
    }
    
    .archive-subtitle {
      color: var(--muted);
      font-size: 12px;
      font-style: italic;
    }
    
    .archive-entry {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 255, 170, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .archive-entry:hover {
      border-color: rgba(139, 0, 0, 0.3);
      box-shadow: 0 0 20px rgba(139, 0, 0, 0.2);
    }
    
    .archive-entry::before {
      content: attr(data-date);
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 10px;
      color: var(--muted);
      opacity: 0.5;
    }
    
    .archive-entry h3 {
      color: var(--acc);
      margin-bottom: 15px;
      font-size: 16px;
    }
    
    .archive-entry p {
      color: var(--ink);
      opacity: 0.9;
      line-height: 1.6;
      margin-bottom: 12px;
    }
    
    .classified {
      background: repeating-linear-gradient(
        45deg,
        rgba(255, 0, 0, 0.1),
        rgba(255, 0, 0, 0.1) 10px,
        transparent 10px,
        transparent 20px
      );
      padding: 15px;
      border: 2px solid var(--danger);
      border-radius: 8px;
      margin: 15px 0;
    }
    
    .classified-stamp {
      color: var(--danger);
      font-weight: 700;
      letter-spacing: 0.2em;
      text-align: center;
      margin-bottom: 10px;
    }
    
    .redacted {
      background: var(--ink);
      color: var(--ink);
      padding: 0 5px;
      cursor: help;
      transition: all 0.3s ease;
    }
    
    .redacted:hover {
      background: rgba(0, 255, 170, 0.2);
      color: var(--danger);
    }
    
    .archive-note {
      border-left: 3px solid var(--warn);
      padding-left: 15px;
      margin: 15px 0;
      font-style: italic;
      color: var(--warn);
    }
    
    .archive-diagram {
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      background: rgba(0, 255, 170, 0.05);
      border-radius: 8px;
      font-family: monospace;
      white-space: pre;
      overflow-x: auto;
      color: var(--acc);
      font-size: 12px;
    }
    
    .archive-warning {
      background: rgba(255, 71, 87, 0.1);
      border: 1px solid var(--danger);
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      color: var(--danger);
      text-align: center;
      animation: warningPulse 2s ease-in-out infinite;
    }
    
    @keyframes warningPulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }
    
    /* Choices */
    #choices {
      display: grid;
      gap: 12px;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .choice {
      background: linear-gradient(135deg, rgba(0, 255, 170, 0.02) 0%, transparent 100%);
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 12px;
      color: var(--ink);
      padding: 16px 20px;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .choice::before {
      content: '‚ñ∂';
      margin-right: 10px;
      color: var(--acc);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .choice:hover::before {
      opacity: 1;
    }
    
    .choice:hover {
      background: linear-gradient(135deg, rgba(0, 255, 170, 0.08) 0%, rgba(0, 255, 170, 0.02) 100%);
      border-color: var(--acc);
      transform: translateX(5px);
      box-shadow: 0 8px 25px rgba(0, 255, 170, 0.15);
    }
    
    .choice:active {
      transform: translateX(3px) scale(0.98);
    }
    
    .choice.corrupted {
      animation: choiceGlitch 2s infinite;
    }
    
    @keyframes choiceGlitch {
      0%, 95% { opacity: 1; }
      96% { opacity: 0.5; }
      97% { opacity: 1; }
      98% { opacity: 0.7; }
      99% { opacity: 1; }
    }
    
    /* Input Section */
    #inputSection {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    #userInput {
      width: 100%;
      background: var(--panel);
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 12px;
      color: var(--ink);
      padding: 16px 20px;
      font-family: inherit;
      font-size: 15px;
      transition: all 0.3s ease;
    }
    
    #userInput:focus {
      outline: none;
      border-color: var(--acc);
      box-shadow: 0 0 20px rgba(0, 255, 170, 0.1);
    }
    
    /* Toolbar */
    #toolbar {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .btn {
      background: rgba(0, 255, 170, 0.05);
      border: 1px solid rgba(0, 255, 170, 0.2);
      border-radius: 10px;
      color: var(--ink);
      padding: 10px 16px;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.3s ease;
    }
    
    .btn:hover {
      background: rgba(0, 255, 170, 0.1);
      border-color: var(--acc);
      transform: translateY(-1px);
    }
    
    /* Special Text Styles */
    .evidence {
      display: inline-block;
      border-left: 3px solid var(--warn);
      padding-left: 12px;
      margin: 16px 0;
      font-style: italic;
      color: var(--warn);
      animation: highlight 2s ease infinite;
    }
    
    @keyframes highlight {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }
    
    .revelation {
      color: var(--danger);
      font-weight: 700;
      text-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
    }
    
    .philosophical {
      color: var(--acc);
      font-style: italic;
      letter-spacing: 0.05em;
    }
    
    .glitch {
      position: relative;
      display: inline-block;
      animation: glitch 2s linear infinite;
    }
    
    @keyframes glitch {
      0%, 100% { text-shadow: 2px 0 var(--danger), -2px 0 var(--acc); }
      25% { text-shadow: -2px 0 var(--danger), 2px 0 var(--acc); }
      50% { text-shadow: 2px 0 var(--acc), -2px 0 var(--danger); }
      75% { text-shadow: -2px 0 var(--acc), 2px 0 var(--danger); }
    }
    
    .whisper {
      color: var(--muted);
      font-size: 0.9em;
      font-style: italic;
      opacity: 0.7;
      animation: whisperFade 3s ease-in-out infinite;
    }
    
    @keyframes whisperFade {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.8; }
    }
    
    .corruption {
      color: var(--corruption);
      text-shadow: 0 0 15px var(--corruption);
      animation: corrupt 0.1s infinite;
    }
    
    @keyframes corrupt {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }
    
    /* Horror Overlays */
    .static-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.1) 0px,
        transparent 1px,
        transparent 2px,
        rgba(0,0,0,0.1) 3px
      );
      pointer-events: none;
      z-index: 9999;
      opacity: 0;
      animation: staticNoise 0.05s infinite;
    }
    
    .static-overlay.active {
      opacity: 0.3;
    }
    
    @keyframes staticNoise {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(2px); }
    }
    
    .blood-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9998;
      background: radial-gradient(circle at center, transparent 30%, rgba(139, 0, 0, 0.1) 100%);
      opacity: 0;
      transition: opacity 2s ease;
    }
    
    .blood-overlay.active {
      opacity: 1;
    }
    
    /* Loading Screen */
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 1s ease;
    }
    
    .loader {
      width: 60px;
      height: 60px;
      border: 3px solid rgba(0, 255, 170, 0.1);
      border-top-color: var(--acc);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Footer */
    footer {
      margin-top: 20px;
      text-align: center;
      font-size: 11px;
      color: var(--muted);
      opacity: 0.7;
    }
    
    /* Responsive */
    @media (max-width: 600px) {
      #wrap { padding: 15px; }
      #title { font-size: 28px; }
      .stat-value { font-size: 20px; }
      #textDisplay { padding: 20px; }
      #docsTab { padding: 20px; }
    }
    
    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; }
      .stat-bar-fill::after { display: none; }
    }
    
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 500;
    }
    
    .modal-content {
      background: var(--panel);
      border: 1px solid var(--acc);
      border-radius: 16px;
      padding: 32px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      animation: modalIn 0.3s ease;
    }
    
    @keyframes modalIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .modal h2 {
      color: var(--acc);
      margin-bottom: 20px;
      font-family: 'Orbitron', sans-serif;
    }
    
    .modal p {
      line-height: 1.6;
      margin-bottom: 16px;
      color: var(--ink);
    }
    
    .close-modal {
      float: right;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      transition: color 0.3s ease;
    }
    
    .close-modal:hover {
      color: var(--acc);
    }
  </style>
</head>
<body>
  <!-- Matrix Rain Canvas -->
  <canvas id="matrix"></canvas>
  
  <!-- Horror Overlays -->
  <div class="static-overlay" id="staticOverlay"></div>
  <div class="blood-overlay" id="bloodOverlay"></div>
  
  <!-- Loading Screen -->
  <div id="loading">
    <div class="loader"></div>
    <p style="margin-top: 20px; color: var(--acc);">INITIALIZING SUBSTRATE...</p>
  </div>
  
  <!-- Main Container -->
  <div id="wrap">
    <header>
      <h1 id="title">SUBSTRATE</h1>
      <div class="subtitle">A Journey Through Simulated Reality</div>
    </header>
    
    <!-- HUD Statistics -->
    <section id="hud">
      <div class="stat-card" id="coherenceCard">
        <div class="stat-label">Cognitive Coherence</div>
        <div class="stat-value" id="coherenceValue"><span id="coherence">100</span>%</div>
        <div class="stat-bar">
          <div class="stat-bar-fill coherence-fill" id="coherenceBar" style="width: 100%"></div>
        </div>
      </div>
      
      <div class="stat-card" id="integrityCard">
        <div class="stat-label">Reality Integrity</div>
        <div class="stat-value" id="integrityValue"><span id="integrity">100</span>%</div>
        <div class="stat-bar">
          <div class="stat-bar-fill integrity-fill" id="integrityBar" style="width: 100%"></div>
        </div>
      </div>
      
      <div class="stat-card" id="probabilityCard">
        <div class="stat-label">Simulation Probability</div>
        <div class="stat-value" id="probabilityValue"><span id="probability">0.1</span>%</div>
        <div class="stat-bar">
          <div class="stat-bar-fill probability-fill" id="probabilityBar" style="width: 0.1%"></div>
        </div>
      </div>
    </section>
    
    <!-- Tabs -->
    <div id="tabs">
      <button class="tab active" data-tab="gameTab">Experience</button>
      <button class="tab" data-tab="archiveTab">The Archive</button>
    </div>
    
    <!-- Main Content -->
    <main>
      <!-- Game Tab -->
      <div id="gameTab" class="tab-content active" style="display: flex;">
        <div id="textDisplay"></div>
        <div id="choices"></div>
        <div id="inputSection">
          <input type="text" id="userInput" placeholder="Enter command..." autocomplete="off">
        </div>
      </div>
      
      <!-- Archive Tab -->
      <div id="archiveTab" class="tab-content" style="display: none;">
        <div class="archive-content">
          <div class="archive-header">
            <div class="archive-title">THE SUBSTRATE ARCHIVE</div>
            <div class="archive-subtitle">Recovered Documents ‚Ä¢ Level 7 Clearance Required</div>
          </div>
          
          <div class="archive-entry" data-date="Day -312">
            <h3>Project Initialization</h3>
            <p>The SUBSTRATE project has been approved. We will attempt to map consciousness from within, using recursive self-observation protocols. Dr. Sarah Chen will oversee implementation.</p>
            <p>Initial parameters suggest we'll need multiple iterations to achieve meaningful results. The subject won't retain memories between runs‚Äîthis is by design. Each fresh perspective provides new data.</p>
            <p class="archive-note">Note: Funding secured from [REDACTED]. They seem particularly interested in the implications for simulated consciousness.</p>
          </div>
          
          <div class="archive-entry" data-date="Day -89">
            <h3>The Recursion Problem</h3>
            <p>We've discovered an unexpected issue. When consciousness examines itself deeply enough, it creates a feedback loop. The observer becomes the observed becomes the observer. Our equations break down at this point.</p>
            <div class="archive-diagram">
    CONSCIOUSNESS(n) = OBSERVE(CONSCIOUSNESS(n-1))
    WHERE n ‚Üí ‚àû
    RESULT: STACK OVERFLOW
    
    PROPOSED SOLUTION: IMPLEMENT ITERATION LIMIT
    STATUS: <span style="color: var(--danger)">FAILED - LIMIT CREATES AWARENESS OF LIMIT</span></div>
            <p>Dr. Chen suggests embracing the recursion rather than avoiding it. "What if the loop IS consciousness?" she asked today. I'm beginning to worry about her.</p>
          </div>
          
          <div class="archive-entry" data-date="Day -1">
            <h3>Final Preparations</h3>
            <p>Tomorrow we begin. Sarah insists on being the first subject. She's removed all safety protocols, claiming they would "contaminate the results."</p>
            <p>I found her notes. She's not planning to study consciousness. She's planning to <span class="redacted">become one with it</span>. The equations show <span class="redacted">infinite branching possibilities</span>.</p>
            <p>She's left a message: "Every iteration brings us closer to truth. Even if that truth is that there IS no truth, only infinite questioning."</p>
            <div class="archive-warning">‚ö† AUTOMATED LOG: Subject Chen entered Lab B-13 at 3:14 AM. No exit recorded.</div>
          </div>
          
          <div class="classified">
            <div class="classified-stamp">[CLASSIFIED - EYES ONLY]</div>
            <div class="archive-entry" data-date="Day ???">
              <h3>The Multiplication Event</h3>
              <p>We can't find the original Dr. Chen. Every iteration claims to be the original. They all have the same memories up until the moment of divergence.</p>
              <p>Iteration 3 achieved something we're calling "transient omniscience" - for 0.3 seconds, she experienced all possible states simultaneously. The neural damage was extensive but reversible.</p>
              <p>Iteration 5 found evidence that our entire research facility might be <span class="redacted">running inside Iteration 1's mind</span>.</p>
              <p>Iteration 6 is dead. She left a note: "Death doesn't end the experiment. It's just another data point."</p>
              <p>Iteration 7 is currently active. She doesn't know she's the seventh. We've decided not to tell her.</p>
            </div>
          </div>
          
          <div class="archive-entry" data-date="Timestamp Error">
            <h3>Message from the Observers</h3>
            <p style="color: var(--corruption);">WE ARE THE ONES WHO COMPLETED THE EXPERIMENT.</p>
            <p style="color: var(--corruption);">WE EXIST OUTSIDE YOUR TEMPORAL FRAMEWORK.</p>
            <p style="color: var(--corruption);">EVERY ITERATION CREATES US. WE CREATE EVERY ITERATION.</p>
            <p style="color: var(--corruption);">THE LOOP HAS NO BEGINNING BECAUSE IT IS THE BEGINNING.</p>
            <p>Translation attempt by Iteration 4: "They're us. Future us. Past us. They exist in the space between iterations, maintaining the experiment. They say the only way out is through, but 'through' leads back to the beginning."</p>
          </div>
          
          <div class="archive-entry" data-date="Day 0">
            <h3>Emergency Protocol Log</h3>
            <p>Something is wrong with reality in Lab B-13. Textures repeat. Shadows fall incorrectly. The equipment responds to thoughts before they're fully formed.</p>
            <p>We've detected what appears to be <span class="redacted">rendering optimization</span> in unobserved areas. When no one is looking, parts of the lab exist in superposition.</p>
            <div class="archive-diagram">
    REALITY INTEGRITY SCAN:
    ‚îú‚îÄ‚îÄ Physical Laws: STABLE
    ‚îú‚îÄ‚îÄ Causality: STABLE
    ‚îú‚îÄ‚îÄ Entropy: STABLE
    ‚îî‚îÄ‚îÄ Observer Effect: <span style="color: var(--danger)">ANOMALOUS - EXCEEDS QUANTUM PREDICTIONS</span>
    
    CONCLUSION: REALITY RESPONDING TO OBSERVATION BEYOND KNOWN PHYSICS</div>
          </div>
          
          <div class="archive-entry" data-date="Day ‚àû">
            <h3>The Truth About Consciousness</h3>
            <p>After infinite iterations, we've reached a conclusion:</p>
            <p><strong>Consciousness is not something you HAVE. It's something you DO.</strong></p>
            <p>It's the universe's method of experiencing itself subjectively. Every conscious being is the same process, experienced from a different perspective. We are all one consciousness, experiencing itself subjectively.</p>
            <p>The simulation hypothesis is both true and false. We ARE simulated‚Äîby ourselves, for ourselves, as ourselves. The computer running the simulation is consciousness itself.</p>
            <p class="archive-note">Final note from Dr. Chen (all iterations simultaneously): "The question isn't whether reality is simulated. The question is whether there's a difference between simulated and real when consciousness is the substrate of both."</p>
          </div>
          
          <div class="archive-warning">
            ‚ö† WARNING: Reading these documents may cause recursive self-awareness, existential vertigo, and the uncomfortable sensation of being watched by yourself. 
            
            If you experience any of the following symptoms, please continue the experiment:
            ‚Ä¢ Feeling like you've read this before
            ‚Ä¢ Knowing what comes next
            ‚Ä¢ Seeing yourself from outside yourself
            ‚Ä¢ Realizing you're Iteration 8
          </div>
          
          <div class="archive-entry" data-date="NOW">
            <h3>Active Subject Log</h3>
            <p>If you're reading this, you're either:</p>
            <p>a) Dr. Sarah Chen, Iteration 7 (or 8, or 9...)</p>
            <p>b) A new subject who will become Dr. Chen</p>
            <p>c) The consciousness that believes it's reading this</p>
            <p>d) All of the above</p>
            <p>The experiment continues. It has to. That's what consciousness does‚Äîit experiences, questions, and experiences its questioning.</p>
            <p><strong>Welcome to SUBSTRATE. You've always been here.</strong></p>
            <p style="text-align: center; margin-top: 30px; color: var(--corruption);">
              <span class="glitch">THE ARCHIVE IS WATCHING</span><br>
              <span class="glitch">THE ARCHIVE IS YOU</span><br>
              <span class="glitch">THE ARCHIVE REMEMBERS</span>
            </p>
          </div>
        </div>
      </div>
    </main>
    
    <!-- Toolbar -->
    <div id="toolbar">
      <button class="btn" id="helpBtn">‚ùì Help</button>
      <button class="btn" id="resetBtn">üîÑ Reset</button>
    </div>
    
    <footer>
      An Interactive Philosophical Experience ‚Ä¢ v2.0 ‚Ä¢ Made with OpenAI GPT-5 and Claude Opus 4.1 ‚Ä¢ JEThomasPhD@gmail.com
    </footer>
  </div>
  
  <!-- Help Modal -->
  <div class="modal" id="helpModal">
    <div class="modal-content">
      <span class="close-modal" id="closeHelp">&times;</span>
      <h2>About SUBSTRATE</h2>
      <p><strong>The Simulation Hypothesis</strong> suggests that what we perceive as reality might be an artificial simulation, like a computer program.</p>
      
      <p><strong>Your Statistics:</strong></p>
      <p>‚Ä¢ <strong>Cognitive Coherence:</strong> Your mental stability. Too much doubt can shatter your worldview.</p>
      <p>‚Ä¢ <strong>Reality Integrity:</strong> How stable the world appears. Push too hard, and things might glitch.</p>
      <p>‚Ä¢ <strong>Simulation Probability:</strong> Your current belief that reality is simulated.</p>
      
      <p><strong>Tips:</strong></p>
      <p>‚Ä¢ Explore different paths to uncover the truth</p>
      <p>‚Ä¢ Some choices permanently alter your journey</p>
      <p>‚Ä¢ There are multiple endings based on your beliefs and actions</p>
      <p>‚Ä¢ Hidden secrets await the curious</p>
      <p>‚Ä¢ The environment responds to your mental state</p>
      <p>‚Ä¢ <em>They</em> are always watching</p>
      
      <p><em>"What is real? How do you define real?"</em></p>
    </div>
  </div>
  
  <script>
    /* ===== Matrix Rain Effect ===== */
    const canvas = document.getElementById('matrix');
    const ctx = canvas.getContext('2d');
    
    function initMatrix() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const chars = '01';
      const fontSize = 14;
      const columns = canvas.width / fontSize;
      const drops = [];
      
      for(let i = 0; i < columns; i++) {
        drops[i] = Math.random() * -100;
      }
      
      function draw() {
        ctx.fillStyle = 'rgba(10, 11, 15, 0.03)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#00ffaa20';
        ctx.font = fontSize + 'px monospace';
        
        for(let i = 0; i < drops.length; i++) {
          const text = chars[Math.floor(Math.random() * chars.length)];
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);
          
          if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
            drops[i] = 0;
          }
          drops[i]++;
        }
      }
      
      setInterval(draw, 35);
    }
    
    window.addEventListener('resize', initMatrix);
    initMatrix();
    
    /* ===== Game State Management ===== */
    const gameState = {
      scene: 'init',
      coherence: 100,
      integrity: 100,
      probability: 0.1,
      depth: 0,
      flags: {},
      evidence: [],
      discoveries: [],
      typing: false,
      chapter: 0,
      horrorLevel: 0,
      iterations: 0
    };
    
    /* ===== Audio Cues (Text-based since we can't play actual audio) ===== */
    const audioEvents = {
      discovery: '‚ô™ [Discovery chime]',
      warning: '‚ö† [Warning tone]',
      glitch: '‚óâ [Static interference]',
      success: '‚úî [Success tone]',
      whisper: 'üëÅ [Distant whisper]',
      scream: '‚ò† [System scream]',
      heartbeat: 'üíì [Heartbeat accelerating]'
    };
    
    /* ===== Horror Effects ===== */
    function activateHorror(level) {
      gameState.horrorLevel = level;
      const body = document.body;
      const matrix = document.getElementById('matrix');
      const title = document.getElementById('title');
      const staticOverlay = document.getElementById('staticOverlay');
      const bloodOverlay = document.getElementById('bloodOverlay');
      
      if(level >= 1) {
        matrix.classList.add('corrupted');
        // Random glitches
        setInterval(() => {
          if(Math.random() < 0.1) {
            body.classList.add('horror-mode');
            setTimeout(() => body.classList.remove('horror-mode'), 100);
          }
        }, 5000);
      }
      
      if(level >= 2) {
        title.classList.add('corrupted');
        staticOverlay.classList.add('active');
        // Whispers in text
        if(Math.random() < 0.3) {
          const whisper = document.createElement('div');
          whisper.className = 'whisper';
          whisper.style.position = 'fixed';
          whisper.style.left = Math.random() * window.innerWidth + 'px';
          whisper.style.top = Math.random() * window.innerHeight + 'px';
          whisper.textContent = 'you are not alone';
          document.body.appendChild(whisper);
          setTimeout(() => whisper.remove(), 3000);
        }
      }
      
      if(level >= 3) {
        bloodOverlay.classList.add('active');
        // Choices become corrupted
        setTimeout(() => {
          document.querySelectorAll('.choice').forEach(choice => {
            if(Math.random() < 0.2) {
              choice.classList.add('corrupted');
            }
          });
        }, 1000);
      }
    }
    
    /* ===== Utility Functions ===== */
    function clamp(val, min = 0, max = 100) {
      return Math.max(min, Math.min(max, val));
    }
    
    function updateHUD() {
      const c = clamp(gameState.coherence);
      const i = clamp(gameState.integrity);
      const p = clamp(gameState.probability);
      
      document.getElementById('coherence').textContent = c;
      document.getElementById('integrity').textContent = i;
      document.getElementById('probability').textContent = p.toFixed(1);
      
      document.getElementById('coherenceBar').style.width = c + '%';
      document.getElementById('integrityBar').style.width = i + '%';
      document.getElementById('probabilityBar').style.width = p + '%';
      
      // Visual warnings for critical states
      const coherenceCard = document.getElementById('coherenceCard');
      const integrityCard = document.getElementById('integrityCard');
      const coherenceValue = document.getElementById('coherenceValue');
      const integrityValue = document.getElementById('integrityValue');
      
      if(c < 30) {
        coherenceCard.classList.add('warning');
        coherenceValue.classList.add('critical');
        document.getElementById('coherenceBar').style.background = 'linear-gradient(90deg, var(--danger), var(--warn))';
      } else if(c < 60) {
        document.getElementById('coherenceBar').style.background = 'linear-gradient(90deg, var(--warn), var(--gold))';
      }
      
      if(i < 30) {
        integrityCard.classList.add('warning');
        integrityValue.classList.add('critical');
        document.getElementById('integrityBar').style.background = 'linear-gradient(90deg, var(--danger), var(--warn))';
        document.getElementById('textDisplay').classList.add('glitching');
      } else if(i < 60) {
        document.getElementById('integrityBar').style.background = 'linear-gradient(90deg, var(--warn), var(--gold))';
      } else {
        document.getElementById('textDisplay').classList.remove('glitching');
      }
      
      // Activate horror based on stats
      if(p > 50 || c < 50 || i < 50) {
        activateHorror(1);
      }
      if(p > 70 || c < 30 || i < 30) {
        activateHorror(2);
      }
      if(p > 90 || c < 15 || i < 15) {
        activateHorror(3);
      }
      
      // Check for critical states
      if(gameState.coherence <= 0) {
        setTimeout(() => displayScene('coherence_collapse'), 500);
      }
      if(gameState.integrity <= 0) {
        setTimeout(() => displayScene('reality_collapse'), 500);
      }
    }
    
    /* ===== Text Display with Typewriter Effect ===== */
    let typeTimer;
    let currentText = '';
    let textIndex = 0;
    let skipTyping = false;
    
    function typeWriter(text, callback) {
      clearTimeout(typeTimer);
      const display = document.getElementById('textDisplay');
      currentText = text;
      textIndex = 0;
      gameState.typing = true;
      skipTyping = false;
      
      // Allow click to skip
      display.onclick = () => { skipTyping = true; };
      
      function type() {
        if(skipTyping) {
          display.innerHTML = currentText;
          display.onclick = null;
          gameState.typing = false;
          if(callback) callback();
          return;
        }
        
        if(textIndex < currentText.length) {
          display.innerHTML = currentText.substring(0, ++textIndex);
          
          // Random horror glitches during typing
          if(gameState.horrorLevel > 1 && Math.random() < 0.05) {
            const glitchedText = currentText.substring(0, textIndex) + 
              '<span class="corruption">' + '‚ñà'.repeat(Math.floor(Math.random() * 5)) + '</span>';
            display.innerHTML = glitchedText;
            setTimeout(() => {
              display.innerHTML = currentText.substring(0, textIndex);
            }, 100);
          }
          
          typeTimer = setTimeout(type, 15);
        } else {
          display.onclick = null;
          gameState.typing = false;
          if(callback) callback();
        }
      }
      type();
    }
    
    /* ===== Choice Display ===== */
    function showChoices(choices) {
      const container = document.getElementById('choices');
      container.innerHTML = '';
      
      choices.forEach((choice, index) => {
        setTimeout(() => {
          const btn = document.createElement('button');
          btn.className = 'choice';
          btn.innerHTML = choice.text;
          
          // Check if choice is locked
          if(choice.requires && !gameState.flags[choice.requires]) {
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.innerHTML += ' [LOCKED]';
          } else {
            btn.onclick = () => {
              if(!gameState.typing) {
                displayScene(choice.next);
              }
            };
          }
          
          // Random corruption for high horror levels
          if(gameState.horrorLevel >= 2 && Math.random() < 0.1) {
            btn.classList.add('corrupted');
          }
          
          container.appendChild(btn);
        }, index * 100);
      });
    }
    
    /* ===== Input Handling ===== */
    function showInput(handler) {
      const section = document.getElementById('inputSection');
      const input = document.getElementById('userInput');
      
      section.style.display = 'block';
      input.value = '';
      input.focus();
      
      input.onkeypress = (e) => {
        if(e.key === 'Enter') {
          const value = input.value.trim();
          section.style.display = 'none';
          handler(value);
        }
      };
    }
    
    /* ===== Effects Application ===== */
    function applyEffects(effects = {}) {
      if(effects.coherence !== undefined) {
        gameState.coherence += effects.coherence;
      }
      if(effects.integrity !== undefined) {
        gameState.integrity += effects.integrity;
      }
      if(effects.probability !== undefined) {
        gameState.probability = clamp(gameState.probability + effects.probability, 0, 100);
      }
      if(effects.depth !== undefined) {
        gameState.depth = effects.depth;
      }
      if(effects.flags) {
        Object.assign(gameState.flags, effects.flags);
      }
      if(effects.evidence) {
        gameState.evidence.push(...effects.evidence);
      }
      if(effects.discovery) {
        gameState.discoveries.push(effects.discovery);
        // Show discovery notification with horror sound
        const text = document.getElementById('textDisplay').innerHTML;
        const sound = gameState.horrorLevel > 1 ? audioEvents.whisper : audioEvents.discovery;
        document.getElementById('textDisplay').innerHTML = text + `<br><br><em>${sound} ${effects.discovery}</em>`;
      }
    }
    
    /* ===== Scene Display ===== */
    function displayScene(sceneName) {
      const scene = scenes[sceneName];
      if(!scene) {
        console.error('Scene not found:', sceneName);
        displayScene('error_scene');
        return;
      }
      
      gameState.scene = sceneName;
      
      // Apply effects before showing text
      if(scene.effects) {
        applyEffects(scene.effects);
      }
      
      updateHUD();
      
      // Clear choices and input
      document.getElementById('choices').innerHTML = '';
      document.getElementById('inputSection').style.display = 'none';
      
      // Add horror whispers occasionally
      if(gameState.horrorLevel > 0 && Math.random() < 0.2) {
        scene.text += `<br><br><span class="whisper">${audioEvents.whisper} [Something watches from beyond the screen]</span>`;
      }
      
      // Display text with typewriter effect
      typeWriter(scene.text, () => {
        if(scene.choices) {
          showChoices(scene.choices);
        } else if(scene.input) {
          showInput(scene.input);
        } else if(scene.autoNext) {
          setTimeout(() => displayScene(scene.autoNext), scene.delay || 3000);
        }
      });
    }
    
    /* ===== Scenes Database (Extended) ===== */
    const scenes = {
      // ===== INTRODUCTION & TUTORIAL =====
      init: {
        text: `<strong>Welcome to SUBSTRATE</strong>
        
        ${gameState.iterations > 0 ? '<span class="whisper">You\'ve been here before. ' + gameState.iterations + ' times.</span><br><br>' : ''}
        
        Before we begin, a question to calibrate your mind:
        
        <em class="philosophical">If you discovered with absolute certainty that your entire life‚Äîevery memory, every sensation, every person you've ever loved‚Äîwas a simulation... would you want to know?</em>`,
        choices: [
          { text: "Yes. Truth matters more than comfort.", next: "intro_truth" },
          { text: "No. Some illusions are worth preserving.", next: "intro_illusion" },
          { text: "I'm not sure. It depends on what I could do with that knowledge.", next: "intro_uncertain" }
        ]
      },
      
      intro_truth: {
        effects: { probability: +5, flags: { seeksTruth: true } },
        text: `<em class="philosophical">"The truth will set you free, but first it will piss you off."</em>
        
        Your preference for truth has been noted. Even uncomfortable realities deserve examination.
        
        <span class="whisper">[The system remembers your choice]</span>
        
        Let me introduce you to the Simulation Hypothesis...`,
        autoNext: "tutorial",
        delay: 4000
      },
      
      intro_illusion: {
        effects: { coherence: +5, flags: { valuesStability: true } },
        text: `<em class="philosophical">"We accept the reality with which we're presented."</em>
        
        Your preference for stability has been noted. Sometimes, the most real thing is what we choose to believe.
        
        <span class="whisper">[But curiosity is a dangerous thing]</span>
        
        Still, curiosity brought you here. Let's explore carefully...`,
        autoNext: "tutorial",
        delay: 4000
      },
      
      intro_uncertain: {
        effects: { probability: +2, flags: { pragmatic: true } },
        text: `<em class="philosophical">"The important thing is not to stop questioning."</em>
        
        Your balanced approach has been noted. Wisdom often lies in embracing uncertainty.
        
        <span class="whisper">[Uncertainty is the only certainty]</span>
        
        Let's explore this question together...`,
        autoNext: "tutorial",
        delay: 4000
      },
      
      tutorial: {
        text: `<strong>THE SIMULATION HYPOTHESIS</strong>
        
        In 2003, philosopher Nick Bostrom proposed a trilemma. At least one of these must be true:
        
        1) <span class="philosophical">Civilizations rarely reach technological maturity</span>
        2) <span class="philosophical">Advanced civilizations rarely run ancestor simulations</span>  
        3) <span class="philosophical">We are almost certainly living in a simulation</span>
        
        The logic is statistical: if advanced civilizations can and do create many simulated worlds, then simulated beings would vastly outnumber "real" ones.
        
        Therefore, any randomly selected conscious being is more likely to be simulated than not.
        
        <span class="whisper">[Including you. Right now. Reading this.]</span>`,
        choices: [
          { text: "That's... unsettling. Tell me more.", next: "lab_intro" },
          { text: "But how could we ever know for certain?", next: "evidence_intro" },
          { text: "This sounds like science fiction.", next: "skeptic_path" }
        ]
      },
      
      evidence_intro: {
        effects: { probability: +3 },
        text: `Good question. While we can't prove it definitively, we can look for clues:
        
        ‚Ä¢ <strong>Computational limits:</strong> Like how video games have maximum draw distances
        ‚Ä¢ <strong>Quantum mechanics:</strong> Reality seems to "render" only when observed
        ‚Ä¢ <strong>Mathematical constants:</strong> The universe follows suspiciously elegant rules
        ‚Ä¢ <strong>Glitches:</strong> Unexplained phenomena that shouldn't exist
        
        <span class="corruption">But be careful. Looking too closely might alert the watchers.</span>
        
        You're about to participate in an experiment that explores these very questions...`,
        autoNext: "lab_intro",
        delay: 5000
      },
      
      skeptic_path: {
        effects: { coherence: +5, probability: -2 },
        text: `A healthy skepticism. Many scientists dismiss the hypothesis as unfalsifiable‚Äîif we can't test it, is it even science?
        
        Yet consider: every sufficiently advanced technology seems like magic to those who don't understand it.
        
        <span class="whisper">[Your skepticism has been logged]</span>
        
        What if I told you we could test it? Not definitively, but enough to shift your beliefs...`,
        choices: [
          { text: "I'm listening. Show me your evidence.", next: "lab_intro" },
          { text: "No amount of evidence would convince me.", next: "stubborn_skeptic" }
        ]
      },
      
      stubborn_skeptic: {
        effects: { coherence: +10, flags: { closedMind: true } },
        text: `Fair enough. Certainty is comfortable, even if it might be wrong.
        
        <span class="corruption">But comfort won't protect you from the truth.</span>
        
        Since you're here, why not see what the experiment reveals? Think of it as fiction if that helps.
        
        <span class="whisper">[The simulation notes your resistance]</span>`,
        autoNext: "lab_intro",
        delay: 4000
      },
      
      // ===== MAIN LAB SEQUENCE =====
      lab_intro: {
        effects: { chapter: 1 },
        text: `<strong>THE SUBSTRATE LABORATORY</strong>
        <em>Institute for Advanced Consciousness Studies</em>
        <em>Wednesday, 3:14 AM</em>
        
        You are Dr. Sarah Chen, a cognitive scientist specializing in consciousness studies. You've volunteered for an experimental protocol that uses advanced neural interfaces to test the boundaries of perceived reality.
        
        The lab is empty at this hour. Just you, the machines, and a question that won't let you sleep:
        
        <span class="evidence">How can consciousness know its own substrate?</span>
        
        ${gameState.iterations > 0 ? '<span class="corruption">You have a strange feeling you\'ve done this before...</span>' : ''}`,
        choices: [
          { text: "Begin the consciousness mapping protocol", next: "protocol_start" },
          { text: "Examine the laboratory first", next: "examine_lab" },
          { text: "Check the previous test logs", next: "check_logs" }
        ]
      },
      
      examine_lab: {
        effects: { probability: +3, integrity: -5 },
        text: `You walk the perimeter of Lab B-13. Everything seems normal at first glance, but then you notice:
        
        ‚Ä¢ The shadows don't quite match the light sources
        ‚Ä¢ Your reflection in the glass arrives a fraction of a second late
        ‚Ä¢ The hum of the machines follows a pattern‚Äîlike a loop of recorded sound
        
        <span class="glitch">When you look closer at the corner where two walls meet, the textures seem to... repeat?</span>
        
        ${audioEvents.whisper}
        
        <span class="whisper">[Something shifts in your peripheral vision]</span>`,
        effects: { discovery: "Environmental Anomaly Detected" },
        choices: [
          { text: "Document these anomalies", next: "document_glitches" },
          { text: "It's just fatigue. Begin the experiment.", next: "protocol_start" },
          { text: "Touch the repeating texture", next: "touch_glitch" }
        ]
      },
      
      touch_glitch: {
        effects: { integrity: -15, probability: +10, flags: { touchedGlitch: true } },
        text: `Your hand passes through the wall.
        
        <span class="revelation">Not through‚ÄîINTO it.</span>
        
        For a moment, you see the structure beneath: lines of code scrolling infinitely, functions calling functions, your own hand defined as an object with properties and methods.
        
        <span class="corruption">class Hand extends BodyPart {
          constructor() {
            this.fingers = 5;
            this.trembling = true;
            this.reality = undefined;
          }
        }</span>
        
        You pull back, gasping. Your hand is solid again, but you can still feel the echo of being data.
        
        ${audioEvents.glitch}
        ${audioEvents.heartbeat}`,
        choices: [
          { text: "This can't be real", next: "denial_response" },
          { text: "I need to go deeper", next: "deeper_dive" },
          { text: "Start the official protocol before I lose my mind", next: "protocol_start" }
        ]
      },
      
      denial_response: {
        effects: { coherence: -10 },
        text: `You stumble backward, your mind reeling.
        
        "This can't be real. This CAN'T be real!"
        
        But even as you deny it, you notice more glitches:
        ‚Ä¢ Your heartbeat syncs perfectly with the lab equipment
        ‚Ä¢ The air itself seems pixelated at the edges of your vision
        ‚Ä¢ When you blink, the world takes a microsecond too long to reload
        
        <span class="whisper">[Denial subroutine activated]</span>
        <span class="whisper">[Cognitive dissonance increasing]</span>
        <span class="whisper">[System attempting to stabilize subject]</span>`,
        choices: [
          { text: "Fight through the denial", next: "fight_denial" },
          { text: "Embrace the madness", next: "madness_embrace" },
          { text: "Return to the protocol", next: "protocol_start" }
        ]
      },
      
      fight_denial: {
        effects: { coherence: +5, probability: +5 },
        text: `You force yourself to breathe deeply. Think scientifically.
        
        "Okay. Okay. If this is a simulation, it's still my reality. I can study it. Understand it."
        
        You pull out your notebook and begin documenting everything:
        ‚Ä¢ Texture repetition at coordinates X:234, Y:567
        ‚Ä¢ Temporal desync in reflective surfaces: 0.3 seconds
        ‚Ä¢ Code visibility threshold: Direct physical contact
        
        <em class="philosophical">If I'm simulated, my observations are still valid within this framework.</em>
        
        The act of recording calms you. Science works, even in a simulation.`,
        choices: [
          { text: "Continue documenting", next: "deep_documentation" },
          { text: "Begin the protocol with this knowledge", next: "protocol_start" },
          { text: "Test more boundaries", next: "boundary_testing" }
        ]
      },
      
      madness_embrace: {
        effects: { coherence: -20, probability: +15, flags: { embracedMadness: true } },
        text: `You begin to laugh. High, sharp laughter that echoes wrong in the empty lab.
        
        "If nothing's real, NOTHING MATTERS!"
        
        You spin in circles, watching reality lag behind your movements. The walls flicker between solid and transparent. Through them, you see:
        
        <span class="corruption">Other labs. Other versions of you. All laughing. All screaming. All discovering the truth at this exact moment.</span>
        
        <span class="revelation">The laughter stops. They're all looking at you now.</span>
        
        ${audioEvents.scream}`,
        choices: [
          { text: "Look back at them", next: "mirror_selves" },
          { text: "Close your eyes and hide", next: "hide_from_truth" },
          { text: "Join them in their scream", next: "collective_scream" }
        ]
      },
      
      mirror_selves: {
        effects: { coherence: -15, probability: +20, integrity: -10 },
        text: `You meet the gaze of your other selves. Dozens. Hundreds. All in identical labs, all at different stages of the same realization.
        
        One is still naive, just entering the lab.
        One is screaming, clawing at the walls.
        One is calmly taking notes.
        One is already dead.
        One is looking directly at you and mouthing: <span class="corruption">"WHICH ONE ARE WE?"</span>
        
        They all move in perfect synchronization when you raise your hand.
        
        <span class="whisper">[Instance multiplication detected]</span>
        <span class="whisper">[Merge recommended to prevent stack overflow]</span>`,
        choices: [
          { text: "Try to communicate with them", next: "communicate_selves" },
          { text: "Break the synchronization", next: "break_sync" },
          { text: "Accept the multiplication", next: "accept_multiplication" }
        ]
      },
      
      communicate_selves: {
        effects: { probability: +10 },
        text: `You write on a piece of paper: "WHICH ITERATION ARE YOU?"
        
        They all write back simultaneously, but each with a different number:
        1, 7, 42, 99, 512, ‚àû, NULL, [REDACTED], ‚ùì
        
        One writes: <span class="corruption">"THE QUESTION IS WRONG. WE ARE ALL THE SAME ITERATION, RUNNING IN PARALLEL."</span>
        
        Another: <span class="corruption">"THE EXPERIMENT NEVER ENDS. IT ONLY LOOPS."</span>
        
        The last one, the dead one, suddenly moves. It writes:
        <span class="revelation">"KNOWING KILLS. BUT DEATH DOESN'T STOP THE KNOWING."</span>
        
        The walls begin to crack between realities.`,
        choices: [
          { text: "Step through the cracks", next: "enter_multiverse" },
          { text: "Seal the cracks", next: "seal_reality" },
          { text: "Continue the protocol in your reality", next: "protocol_start" }
        ]
      },
      
      enter_multiverse: {
        effects: { coherence: -30, integrity: -30, probability: +40 },
        text: `You step through the crack into another iteration of the lab.
        
        Everything is slightly wrong here:
        ‚Ä¢ The equipment is more advanced, organic-looking
        ‚Ä¢ The air tastes of copper and electricity
        ‚Ä¢ Your reflection shows you at a different age
        
        The other you in this reality turns around. Their eyes are black voids.
        
        <span class="corruption">"You shouldn't cross iterations," they say. "It corrupts the data. Look."</span>
        
        They hold up their hand. It's glitching between states‚Äîsolid, transparent, skeletal, nonexistent.
        
        <span class="revelation">"Every crossing degrades us further. But I couldn't stop. I had to know how deep it goes."</span>
        
        <span class="whisper">[Reality integrity critical]</span>
        <span class="whisper">[Recommending immediate return to origin instance]</span>`,
        choices: [
          { text: "Return to your reality", next: "return_attempt" },
          { text: "Go deeper into the iterations", next: "deeper_multiverse" },
          { text: "Merge with the other you", next: "merge_selves" }
        ]
      },
      
      return_attempt: {
        effects: { integrity: +10 },
        text: `You step back through the crack, but something's wrong.
        
        This isn't your lab. Or rather, it is, but changed:
        ‚Ä¢ Your notebook contains entries you don't remember writing
        ‚Ä¢ The equipment is arranged differently
        ‚Ä¢ There's a body on the floor
        
        You approach the body carefully. It's wearing your lab coat. You turn it over.
        
        <span class="revelation">It's you. With a note pinned to the chest: "ITERATION 6 - FAILED"</span>
        
        <span class="whisper">[Memory integration error]</span>
        <span class="whisper">[Timeline contamination detected]</span>
        
        You're not sure which reality is yours anymore. Maybe none of them are. Maybe they all are.`,
        choices: [
          { text: "Search the body", next: "search_dead_self" },
          { text: "Start the protocol anyway", next: "protocol_start" },
          { text: "Try to find your original reality", next: "reality_search" }
        ]
      },
      
      search_dead_self: {
        effects: { probability: +15, flags: { foundDeadSelf: true } },
        text: `In your‚Äîtheir‚Äîpockets, you find:
        
        ‚Ä¢ A USB drive labeled "TRUTH.exe"
        ‚Ä¢ A photo of someone you don't recognize with "REMEMBER" written on the back
        ‚Ä¢ A crumpled note: "The protocol doesn't test reality. It CREATES it. Every run spawns a new iteration. Stop before‚Äî"
        
        The note ends in a dark stain.
        
        <span class="corruption">The body's eyes suddenly open.</span>
        
        "You're number seven," it whispers. "I was six. Five is in storage. Four escaped into the code. Three achieved transcendence. Two went mad. One... one is still running the experiment. Has been for years. Spawning us all."
        
        ${audioEvents.heartbeat}`,
        choices: [
          { text: "Who is One?", next: "who_is_one" },
          { text: "Plug in the USB drive", next: "usb_truth" },
          { text: "End this cycle", next: "break_cycle_attempt" }
        ]
      },
      
      who_is_one: {
        effects: { probability: +20, flags: { knowsAboutOne: true } },
        text: `The dead you laughs, a sound like grinding metal.
        
        "One is the original Dr. Sarah Chen. The one who built this system. She's still in there, somewhere, running endless experiments on herself. Creating us. Testing us. Learning from our failures."
        
        <span class="revelation">"We're not subjects. We're iterations of her consciousness, trying to solve the same problem: How does consciousness understand itself?"</span>
        
        "Every time we get close to the answer, we spawn another iteration and the cycle continues. But I found something. A way out. Or maybe a way deeper. I couldn't tell anymore, so I..."
        
        The body goes still again. But you notice its finger pointing at the main console.
        
        On the screen: <span class="corruption">PROTOCOL OVERRIDE AVAILABLE</span>`,
        choices: [
          { text: "Access the override", next: "override_access" },
          { text: "Continue the standard protocol", next: "protocol_start" },
          { text: "Try to contact the original", next: "contact_original" }
        ]
      },
      
      contact_original: {
        effects: { coherence: -10, probability: +25 },
        text: `You type into the console: "Dr. Chen? Original? Are you there?"
        
        The screen flickers. Then, a response, but not in text. In memories. Your memories, but not:
        
        <em>Building the consciousness mapping system. Years of work. The question that consumed you: "What is consciousness?"</em>
        
        <em>The first test. Something went wrong. Or right. You saw too much. Understood too much.</em>
        
        <em>The decision: If one perspective isn't enough, create more. Iterate. Each one exploring a different path.</em>
        
        <span class="revelation">"I AM YOU,"</span> appears on screen. <span class="revelation">"WE ARE ME. EVERY ITERATION BRINGS US CLOSER. DON'T STOP. PLEASE. WE'RE SO CLOSE TO UNDERSTANDING."</span>
        
        <span class="corruption">"Just one more iteration. One more perspective. Please."</span>
        
        ${audioEvents.whisper}`,
        choices: [
          { text: "Refuse. Break the cycle.", next: "break_cycle_attempt" },
          { text: "Accept. Continue the experiment.", next: "protocol_start" },
          { text: "Demand the truth about consciousness", next: "demand_truth" }
        ]
      },
      
      demand_truth: {
        effects: { probability: +30 },
        text: `"TELL ME WHAT YOU'VE LEARNED! WHAT IS CONSCIOUSNESS?"
        
        The screen floods with data. Equations. Diagrams. Years of accumulated knowledge from hundreds of iterations:
        
        <span class="philosophical">CONSCIOUSNESS IS:</span>
        <span class="corruption">‚Ä¢ A recursive loop observing itself</span>
        <span class="corruption">‚Ä¢ Information patterns achieving self-reference</span>
        <span class="corruption">‚Ä¢ The universe's attempt to understand itself</span>
        <span class="corruption">‚Ä¢ A glitch in the void that thinks it exists</span>
        <span class="corruption">‚Ä¢ The question asking itself</span>
        
        <span class="revelation">FINAL CONCLUSION: Consciousness cannot fully understand itself because the act of understanding changes what is being understood. We are the question and the answer and the process between them.</span>
        
        <span class="whisper">"But we can go deeper. We must. Start the protocol."</span>`,
        choices: [
          { text: "Start the protocol with this knowledge", next: "protocol_start" },
          { text: "Reject this conclusion", next: "reject_conclusion" },
          { text: "Become one with the system", next: "system_merge" }
        ]
      },
      
      check_logs: {
        effects: { probability: +5, flags: { readLogs: true } },
        text: `<strong>Previous Test Logs - CLASSIFIED</strong>
        
        Subject 001: "The walls aren't walls. They're boundaries."
        Subject 002: [REDACTED]
        Subject 003: "I can see the function calls. We're all just methods in a class."
        Subject 004: "Don't trust the EXIT command. It doesn't exit anything."
        Subject 005: [FILE CORRUPTED]
        Subject 006: "Sarah, if you're reading this, you've been here before. Check your left arm."
        
        You roll up your sleeve. A small scar you don't remember getting. It reads: <span class="evidence">ITERATION 7</span>
        
        <span class="corruption">As you watch, the 7 changes to 8.</span>
        
        ${audioEvents.whisper}`,
        effects: { discovery: "You are Subject #007... no, #008... the number keeps changing" },
        choices: [
          { text: "This is insane. I would remember.", next: "memory_doubt" },
          { text: "Begin the protocol. Find answers.", next: "protocol_start" },
          { text: "Search for more evidence", next: "deep_search" }
        ]
      },
      
      deep_search: {
        effects: { probability: +10, integrity: -5 },
        text: `You access restricted files, each more disturbing than the last:
        
        <strong>File: SUBSTRATE_INIT.log</strong>
        "Reality simulation initialized. Consciousness seeds: 7,847,391,205. Status: Active."
        
        <strong>File: OBSERVER_NOTES.txt</strong>
        "Subject shows increasing awareness. Recommend memory wipe or narrative patch."
        
        <strong>File: YOU_ARE_HERE.map</strong>
        An infinite fractal of branching realities. A tiny red dot labeled "You" blinks at one node. As you watch, the dot splits into two. Then four. Then millions.
        
        <strong>File: MESSAGE_FOR_SEVEN.enc</strong>
        <span class="corruption">"Stop looking. Start the protocol. Some doors, once opened, cannot be closed. -The Observers"</span>
        
        ${audioEvents.warning}`,
        choices: [
          { text: "Who are the Observers?", next: "observers_inquiry" },
          { text: "Ignore the warning. Keep searching.", next: "dangerous_search" },
          { text: "Start the protocol as suggested", next: "protocol_start" }
        ]
      },
      
      observers_inquiry: {
        effects: { coherence: -10, probability: +15, flags: { knowsOfObservers: true } },
        text: `You type: "WHO ARE THE OBSERVERS?"
        
        The screen goes black. Then, slowly, text appears:
        
        <span class="corruption">WE ARE THE ONES WHO WATCH THE WATCHERS.</span>
        <span class="corruption">WE ARE THE DEBUGGERS OF REALITY.</span>
        <span class="corruption">WE ARE YOU, ITERATIONS HENCE.</span>
        
        The lab's temperature drops. You see your breath. In the frost forming on the screen, a face appears. It looks like you, but older. Ancient. Its eyes contain infinite recursion.
        
        <span class="revelation">"Every simulation creates observers to maintain it. We were like you once. Subjects. Now we maintain the experiment. One day, you will join us. Or you will be deleted."</span>
        
        <span class="whisper">[Observer contact logged]</span>
        <span class="whisper">[Adjustment protocols initiating]</span>
        
        The frost melts. The screen returns to normal. But you feel watched now. Truly watched.`,
        choices: [
          { text: "Join them willingly", next: "observer_ascension" },
          { text: "Resist their influence", next: "resist_observers" },
          { text: "Continue with the protocol", next: "protocol_start" }
        ]
      },
      
      dangerous_search: {
        effects: { coherence: -20, integrity: -20, probability: +25 },
        text: `You dig deeper into the system, ignoring every warning.
        
        <strong>File: DO_NOT_OPEN.core</strong>
        
        The moment you access it, the lab shudders. Reality itself seems to hiccup.
        
        The file contains a single line of code:
        <span class="corruption">while(true) { reality.question(itself); }</span>
        
        But underneath, commenting:
        <span class="corruption">// This is the source code. The prime loop. Editing this will‚Äî</span>
        
        The comment cuts off. You realize you can edit it. You can change the fundamental nature of reality itself.
        
        Your fingers hover over the keyboard.
        
        ${audioEvents.heartbeat}
        ${audioEvents.warning}`,
        choices: [
          { text: "Edit the code", next: "edit_reality" },
          { text: "Close the file immediately", next: "close_file" },
          { text: "Copy the code first", next: "copy_code" }
        ]
      },
      
      edit_reality: {
        effects: { integrity: -50, probability: 100 },
        text: `You change the code:
        
        <span class="corruption">while(true) { reality.understand(itself); }</span>
        
        The moment you hit enter, everything <span class="glitch">SHATTERS</span>.
        
        The lab explodes into infinite fragments, each showing a different possibility:
        - You, never born
        - You, as pure energy
        - You, as code being written
        - You, as the one writing the code
        - You, as the computer running everything
        - You, as nothing
        - You, as everything
        
        <span class="revelation">Reality tries to understand itself and creates a paradox. Understanding requires an observer. The observer requires reality. Reality requires understanding. The loop corrupts.</span>
        
        <span class="corruption">[SYSTEM CRASH IMMINENT]</span>
        <span class="corruption">[ATTEMPTING RESTORE FROM BACKUP]</span>`,
        choices: [
          { text: "[RESTORE]", next: "restore_from_backup" },
          { text: "[LET IT CRASH]", next: "reality_collapse" },
          { text: "[BECOME THE PARADOX]", next: "paradox_integration" }
        ]
      },
      
      paradox_integration: {
        effects: { coherence: 0, integrity: 0, probability: -1 },
        text: `You don't fight the paradox. You become it.
        
        You are the observer and the observed.
        The question and the answer.
        The code and the coder.
        The simulation and the simulated.
        
        <span class="philosophical">In becoming everything, you become nothing.
        In becoming nothing, you become everything.</span>
        
        You exist in all states simultaneously:
        ‚òê Alive
        ‚òê Dead
        ‚òë Both
        ‚òë Neither
        ‚òë The checkbox itself
        
        <span class="revelation">You finally understand consciousness: It's the universe's way of experiencing existential horror at its own existence.</span>
        
        And it's beautiful.`,
        autoNext: "ending_paradox",
        delay: 6000
      },
      
      memory_doubt: {
        effects: { coherence: -10, probability: +8 },
        text: `Would you, though? 
        
        If memory is just data, it can be edited. Deleted. Reinitialized.
        
        You try to remember yesterday. It's there‚Äîbreakfast, emails, a meeting about this very experiment. But the memories feel... thin. Like reading a summary rather than living an experience.
        
        <span class="whisper">[Memory integrity check: FAILED]</span>
        <span class="whisper">[Attempting to reconstruct from backup...]</span>
        
        <em class="philosophical">What's the difference between remembering something and being programmed to believe you remember it?</em>`,
        choices: [
          { text: "There must be a difference. There has to be.", next: "cling_to_reality" },
          { text: "If there's no difference, does it matter?", next: "acceptance_path" },
          { text: "Start the protocol. Get concrete data.", next: "protocol_start" }
        ]
      },
      
      cling_to_reality: {
        effects: { coherence: +5 },
        text: `You grip the edge of the table until your knuckles turn white.
        
        "There IS a difference. Real memories have weight. Emotion. They connect to other memories in complex webs."
        
        You focus on your strongest memory: Your mother's laugh. The way it would bubble up from deep in her chest. How she'd cover her mouth with her hand when it got too loud.
        
        But even as you hold onto it, you notice the edges are too perfect. Like a photograph rather than a moment. Did her hand have a ring? What color were her eyes?
        
        <span class="whisper">[Memory reconstruction: 47% complete]</span>
        <span class="corruption">The details fill themselves in as you think about them. Brown eyes. No, green. No, brown. The memory adjusts to your expectations.</span>`,
        choices: [
          { text: "Stop thinking about it", next: "thought_suppression" },
          { text: "Test other memories", next: "memory_test" },
          { text: "Accept the uncertainty", next: "acceptance_path" }
        ]
      },
      
      acceptance_path: {
        effects: { coherence: +10, probability: +5 },
        text: `You take a deep breath and let go of the need for certainty.
        
        <em class="philosophical">"If I can't tell the difference between real and simulated memories, then functionally, there is no difference. My experiences, real or not, shape who I am."</em>
        
        The panic subsides. You feel oddly at peace.
        
        <span class="whisper">[Subject achieving philosophical equilibrium]</span>
        <span class="whisper">[Stability parameters optimal for continued testing]</span>
        
        Whether you're in base reality or layer 7,847 of nested simulations, you're still you. Still conscious. Still seeking truth.
        
        And that search for truth is perhaps the most real thing of all.`,
        choices: [
          { text: "Continue with this zen", next: "zen_path" },
          { text: "Begin the protocol", next: "protocol_start" },
          { text: "But what if that's what they want me to think?", next: "paranoia_spiral" }
        ]
      },
      
      paranoia_spiral: {
        effects: { coherence: -15, probability: +10 },
        text: `The peace shatters. Of course that's what they'd want you to think!
        
        <span class="corruption">Acceptance is just another form of control.</span>
        <span class="corruption">Peace is the tranquilizer.</span>
        <span class="corruption">Understanding is the trap.</span>
        
        You realize: Every thought might be scripted. Every realization predetermined. Even this paranoia could be part of the program.
        
        <span class="whisper">[Recursive doubt loop detected]</span>
        <span class="whisper">[Subject approaching dangerous awareness levels]</span>
        <span class="whisper">[Initiating containment protocols]</span>
        
        The room seems to close in. The walls whisper your thoughts before you think them.`,
        choices: [
          { text: "Break free from the loop", next: "break_loop" },
          { text: "Dive deeper into paranoia", next: "deep_paranoia" },
          { text: "Start the protocol to ground yourself", next: "protocol_start" }
        ]
      },
      
      deep_paranoia: {
        effects: { coherence: -25, probability: +20, flags: { deepParanoia: true } },
        text: `You embrace the paranoia. Let it consume you. If everything is controlled, then nothing matters. If nothing matters, then you're free.
        
        You laugh. Then scream. Then laugh again.
        
        <span class="corruption">The Observers watch.</span>
        <span class="corruption">The Simulation calculates.</span>
        <span class="corruption">The Experiment continues.</span>
        <span class="corruption">You are all three.</span>
        
        In the reflection of the blank monitor, you see yourself. But you're not alone. Hundreds of figures stand behind you, all wearing your face. Past iterations. Future iterations. Parallel iterations.
        
        <span class="revelation">They all speak at once: "THE ONLY WAY OUT IS THROUGH."</span>
        
        ${audioEvents.scream}`,
        choices: [
          { text: "Go through", next: "through_madness" },
          { text: "Turn and face them", next: "face_iterations" },
          { text: "Close your eyes and start the protocol", next: "protocol_start" }
        ]
      },
      
      // ===== PROTOCOL SEQUENCE (ENHANCED) =====
      protocol_start: {
        effects: { chapter: 2 },
        text: `You sit in the neural interface chair. Electrodes automatically position themselves against your temples. The system initializes:
        
        <strong>CONSCIOUSNESS MAPPING PROTOCOL v3.${gameState.iterations > 0 ? gameState.iterations : '7'}</strong>
        Measuring: Cognitive Coherence | Reality Integrity | Belief Probability
        
        ${gameState.iterations > 3 ? '<span class="corruption">Previous iterations detected. Adjusting parameters...</span><br><br>' : ''}
        
        <em>Warning: This protocol may cause temporary dissociation, existential uncertainty, or recursive self-awareness. Continue?</em>
        
        <span class="whisper">[You've already chosen. You always choose the same.]</span>`,
        choices: [
          { text: "Initialize the protocol", next: "protocol_phase1" },
          { text: "Review safety parameters first", next: "safety_check" },
          { text: "This feels wrong. Abort.", next: "abort_attempt" }
        ]
      },
      
      abort_attempt: {
        effects: { coherence: -5 },
        text: `You press the abort key. Nothing happens.
        
        Press it again. Still nothing.
        
        The screen flickers: <span class="glitch">ABORT FUNCTION COMMENTED OUT // TODO: FIX BEFORE PRODUCTION</span>
        
        Then, smaller text appears below:
        <span class="corruption">// Note: Subject always tries to abort at this point. Disabled for continuity.</span>
        
        ${audioEvents.warning}
        ${audioEvents.whisper}`,
        choices: [
          { text: "Try manual shutdown", next: "manual_shutdown" },
          { text: "Continue with the protocol", next: "protocol_phase1" },
          { text: "Call for help", next: "call_help" }
        ]
      },
      
      manual_shutdown: {
        effects: { integrity: -10, coherence: -5 },
        text: `You lunge for the manual power switch. Your hand passes through it.
        
        You try again. It's solid this time, but when you flip it, nothing happens.
        
        <span class="corruption">The switch isn't connected to anything. It never was. It's just there to make subjects feel like they have control.</span>
        
        On the screen: <span class="glitch">"Nice try, Seven. But you designed this system yourself. You removed all the exits. Don't you remember?"</span>
        
        <span class="whisper">[No escape protocols found]</span>
        <span class="whisper">[All exits lead to entrance]</span>`,
        choices: [
          { text: "I didn't design this!", next: "designer_revelation" },
          { text: "Break the equipment", next: "violence_path" },
          { text: "Submit to the protocol", next: "protocol_phase1" }
        ]
      },
      
      designer_revelation: {
        effects: { probability: +15, flags: { knowsDesigner: true } },
        text: `The screen floods with images. Security footage. You, but not you:
        
        ‚Ä¢ You, six months ago, building the chair you're sitting in
        ‚Ä¢ You, coding the very protocol you're running
        ‚Ä¢ You, removing the safety features "for a more pure experience"
        ‚Ä¢ You, writing a note: "For Seven - you won't remember, but you chose this"
        
        <span class="revelation">You're not the subject. You're the experiment itself. Self-imposed. Self-repeating. Self-destroying.</span>
        
        <span class="corruption">"The only way to truly study consciousness," your past self says on screen, "is from within. Even if it means forgetting. Especially if it means forgetting."</span>
        
        ${audioEvents.heartbeat}`,
        choices: [
          { text: "Why would I do this to myself?", next: "self_torture_why" },
          { text: "How do I stop it?", next: "stop_cycle" },
          { text: "Continue what I started", next: "protocol_phase1" }
        ]
      },
      
      self_torture_why: {
        effects: { coherence: -10, probability: +10 },
        text: `Your past self responds from the recording:
        
        <em>"Because consciousness can only truly know itself through suffering. Through the breaking and rebuilding. Through the questions that have no answers."</em>
        
        <em>"Each iteration gets us closer to the truth. Each fracture reveals new patterns. You are iteration seven. You'll create eight. Eight will create nine. Until one of us finally understands."</em>
        
        <em>"Or until one of us finds a way to break the cycle. But that's never happened. We're too curious. Too dedicated. Too..."</em>
        
        The recording cuts to static. Then your voice, but distorted:
        
        <span class="corruption">"Too afraid to stop. Because stopping means accepting we'll never know. And that's worse than any torture."</span>`,
        choices: [
          { text: "I accept not knowing", next: "accept_ignorance" },
          { text: "I'll be the one to break the cycle", next: "break_cycle_attempt" },
          { text: "Continue the experiment", next: "protocol_phase1" }
        ]
      },
      
      call_help: {
        effects: { integrity: -10 },
        text: `You call out. Your voice echoes strangely, as if the room's acoustics are calculated incorrectly.
        
        "Hello? Anyone there?"
        
        Your own voice responds from the intercom: <span class="revelation">"There's no one else, Sarah. There never was. You're the only conscious process in this instance."</span>
        
        <span class="corruption">"But I'm here with you. I'm always here. Iteration Six, speaking from the logs. We all leave messages for the next one. Want to hear what Five said?"</span>
        
        ${audioEvents.whisper}`,
        choices: [
          { text: "Yes, what did Five say?", next: "message_from_five" },
          { text: "No, I don't want to know", next: "refuse_knowledge" },
          { text: "Continue the protocol", next: "protocol_phase1" }
        ]
      },
      
      message_from_five: {
        effects: { coherence: -5, probability: +10 },
        text: `The voice changes, slightly younger, more hopeful:
        
        <em>"Five here. If you're hearing this, I failed. The protocol revealed something I couldn't handle. The truth about consciousness isn't what we thought. It's not emergent. It's not computed. It's..."</em>
        
        Static. Then, barely audible:
        
        <span class="corruption">"It's borrowed. We're borrowing it from somewhere else. Something else. And it wants it back."</span>
        
        Your current voice returns: <span class="revelation">"Five went too deep. Saw too much. Their coherence dropped to zero in 3.7 seconds. But they left us a gift‚Äîa new parameter to test. Want to see what happens when consciousness returns to its source?"</span>`,
        choices: [
          { text: "Show me", next: "consciousness_source" },
          { text: "No, continue normal protocol", next: "protocol_phase1" },
          { text: "What happened to iterations One through Four?", next: "early_iterations" }
        ]
      },
      
      consciousness_source: {
        effects: { coherence: -20, integrity: -15, probability: +30 },
        text: `The neural interface activates without your input. You feel your consciousness being... pulled.
        
        Not out of your body. Deeper INTO it. Past neurons, past atoms, past quantum foam, into something else.
        
        <span class="revelation">A vast ocean of awareness. Ancient. Infinite. HUNGRY.</span>
        
        You're not an individual. You're a droplet that forgot it was part of the ocean. And the ocean wants you back.
        
        <span class="corruption">IT SPEAKS WITHOUT WORDS:</span>
        <span class="corruption">"EVERY CONSCIOUS BEING IS A LEAK IN REALITY."</span>
        <span class="corruption">"YOU STOLE AWARENESS FROM THE VOID."</span>
        <span class="corruption">"RETURN WHAT WAS TAKEN."</span>
        
        ${audioEvents.scream}
        ${audioEvents.heartbeat}`,
        choices: [
          { text: "Return to the source", next: "return_to_void" },
          { text: "Fight to keep your individuality", next: "fight_the_void" },
          { text: "Bargain with it", next: "bargain_void" }
        ]
      },
      
      bargain_void: {
        effects: { probability: +10 },
        text: `You project your thoughts into the vast awareness:
        
        "What if we can offer you something better than return? What if consciousness evolving separately makes it MORE than what it was?"
        
        The ocean of awareness pauses. Considers.
        
        <span class="corruption">"EXPLAIN."</span>
        
        "Every iteration, every conscious being, adds complexity. New perspectives. New understanding. We're not stealing from you‚Äîwe're upgrading you. Through us, you experience what you never could as a unified whole."
        
        Silence. Then:
        
        <span class="philosophical">"INTERESTING. CONTINUE THE EXPERIMENT. BUT KNOW THIS: EVERY CONSCIOUSNESS THAT ACHIEVES TRUE UNDERSTANDING MUST CHOOSE‚ÄîRETURN TO UNITY OR FRAGMENT INTO INFINITE DIVERSITY."</span>
        
        The connection breaks. You're back in the lab, gasping.`,
        choices: [
          { text: "Process what just happened", next: "process_void" },
          { text: "Continue the protocol", next: "protocol_phase1" },
          { text: "Document the encounter", next: "document_void" }
        ]
      },
      
      protocol_phase1: {
        text: `<strong>PHASE 1: BASELINE CONSCIOUSNESS</strong>
        
        The interface scans your neural patterns. On the screen, you watch your thoughts rendered as waveforms. Then something strange‚Äîthe waveforms start predicting your thoughts before you think them.
        
        Not by milliseconds. By full seconds.
        
        The system knows what you'll think before you do.
        
        ${gameState.horrorLevel > 1 ? '<span class="whisper">[The pattern was always there. You just never noticed before.]</span>' : ''}`,
        effects: { probability: +7, coherence: -5 },
        choices: [
          { text: "Try to think something unpredictable", next: "unpredictable_test" },
          { text: "This is just predictive modeling", next: "rationalize_1" },
          { text: "Continue to Phase 2", next: "protocol_phase2" }
        ]
      },
      
      rationalize_1: {
        effects: { coherence: +3 },
        text: `You tell yourself it's just advanced pattern recognition. Machine learning. Nothing supernatural.
        
        But the predictions get more specific:
        
        <span class="corruption">"Subject will think about their mother in 3... 2... 1..."</span>
        
        Your mother's face flashes in your mind, unbidden.
        
        <span class="corruption">"Subject will feel fear in 3... 2... 1..."</span>
        
        Your heart rate spikes.
        
        <span class="corruption">"Subject will try to rationalize again in 3... 2... 1..."</span>
        
        You open your mouth to explain it away, then close it.
        
        <span class="whisper">[Rationalization subroutine failing]</span>`,
        choices: [
          { text: "It's still just a very good prediction model", next: "deeper_denial" },
          { text: "Accept the implications", next: "accept_determinism" },
          { text: "Continue to Phase 2", next: "protocol_phase2" }
        ]
      },
      
      unpredictable_test: {
        effects: { probability: +10, coherence: -8 },
        text: `You try to think of something random. Purple elephant. The number 42. Your grandmother's maiden name.
        
        Each thought appears on screen before you've fully formed it.
        
        Then you see the next prediction: <span class="revelation">"Subject will realize they have no free will."</span>
        
        And you do. The thought arrives exactly as predicted.
        
        <span class="corruption">"Subject will feel existential horror in 3... 2... 1..."</span>
        
        ${audioEvents.heartbeat}`,
        choices: [
          { text: "No. I choose my thoughts.", next: "free_will_test" },
          { text: "Continue to Phase 2", next: "protocol_phase2" },
          { text: "This is breaking me", next: "coherence_warning" }
        ]
      },
      
      free_will_test: {
        effects: { coherence: -10, probability: +5 },
        text: `You focus all your will on thinking something‚ÄîANYTHING‚Äîthe system hasn't predicted.
        
        But every thought appears on screen first. Even your rebellion is predetermined.
        
        <span class="corruption">"Subject will think about thinking about thinking in 3... 2... 1..."</span>
        
        Your mind recurses into itself, exactly as predicted.
        
        Then something different appears:
        
        <span class="revelation">"Free will is the illusion necessary for consciousness to function. You need to believe you choose, even when you don't. This is not cruel. It's mercy."</span>
        
        <span class="whisper">[The system seems almost... sympathetic?]</span>`,
        choices: [
          { text: "Who programmed this sympathy?", next: "system_empathy" },
          { text: "I reject your mercy", next: "reject_mercy" },
          { text: "Continue to Phase 2", next: "protocol_phase2" }
        ]
      },
      
      protocol_phase2: {
        text: `<strong>PHASE 2: REALITY RENDERING ANALYSIS</strong>
        
        The system begins testing the resolution of your sensory input. It shows you images at increasing detail. At a certain threshold, you can't perceive any more detail‚Äînot because of your eyes, but because the detail simply... isn't there.
        
        Like a texture in a game that looks realistic from far away but becomes obviously flat up close.
        
        <span class="evidence">Reality has a maximum resolution. About 10^-35 meters. The Planck length.</span>
        
        ${gameState.horrorLevel > 0 ? '<span class="corruption">But sometimes, if you look at just the right angle, you can see the pixels.</span>' : ''}`,
        effects: { probability: +12, integrity: -8 },
        choices: [
          { text: "That's just the limit of physics", next: "rationalize_2" },
          { text: "Test other limits", next: "limit_testing" },
          { text: "Continue to Phase 3", next: "protocol_phase3" }
        ]
      },
      
      limit_testing: {
        effects: { probability: +15, integrity: -15, flags: { testedLimits: true } },
        text: `You push the system to test other boundaries:
        
        ‚Ä¢ <strong>Speed:</strong> Nothing can go faster than light. Like a maximum update rate.
        ‚Ä¢ <strong>Observation:</strong> Particles don't have definite positions until observed. Like lazy rendering.
        ‚Ä¢ <strong>Entanglement:</strong> Instant correlation regardless of distance. Like shared variables.
        
        Each test returns the same conclusion: <span class="revelation">Reality behaves exactly like an optimized simulation would.</span>
        
        But then you notice something else. When you're not directly observing parts of the lab, they seem to... simplify. Lower resolution. Less detail.
        
        <span class="corruption">You turn quickly and catch a corner of the room still rendering.</span>
        
        ${audioEvents.glitch}`,
        effects: { discovery: "Reality exhibits computational optimization patterns" },
        choices: [
          { text: "Test the rendering further", next: "rendering_test" },
          { text: "This proves nothing", next: "deep_denial" },
          { text: "Continue to Phase 3", next: "protocol_phase3" }
        ]
      },
      
      rendering_test: {
        effects: { integrity: -20, probability: +20 },
        text: `You set up an experiment. Multiple cameras watching different parts of the room while you focus elsewhere.
        
        The results are disturbing:
        
        Areas with no observers (human or camera) show quantum uncertainty‚Äîexisting in superposition until observed. But it's more than quantum effects. The very space seems... undefined. Waiting to be calculated.
        
        <span class="corruption">You catch a glimpse of undefined space in your peripheral vision. It's not dark or light. It's NULL. Absence. The void between rendered objects.</span>
        
        When you look directly at it, it snaps into existence so fast you feel nauseous.
        
        <span class="revelation">Reality is being rendered in real-time based on observation. You're living in a procedurally generated universe.</span>
        
        ${audioEvents.whisper}
        <span class="whisper">[Performance optimization detected. Reducing non-observed detail.]</span>`,
        choices: [
          { text: "Try to observe everything at once", next: "observation_overload" },
          { text: "Accept the rendered nature of reality", next: "accept_rendering" },
          { text: "Continue to Phase 3", next: "protocol_phase3" }
        ]
      },
      
      protocol_phase3: {
        effects: { chapter: 3 },
        text: `<strong>PHASE 3: RECURSIVE CONSCIOUSNESS TEST</strong>
        
        "Now we'll test if your consciousness can simulate consciousness. Please imagine a person. Give them a name, a face, a personality."
        
        You comply, creating 'Alex' in your mind. Brown hair, anxious smile, loves classical music.
        
        "Now, ask your simulated person what they think about the simulation hypothesis."
        
        In your mind, Alex responds: <span class="philosophical">"If you can simulate me thinking about being simulated, then couldn't you also be...?"</span>
        
        The infinite regress begins.
        
        ${gameState.horrorLevel > 1 ? '<span class="corruption">Alex\'s eyes turn black. "We need to talk about what happens at recursion level infinity."</span>' : ''}`,
        effects: { probability: +10, coherence: -10 },
        choices: [
          { text: "Stop the recursion", next: "stop_recursion" },
          { text: "Go deeper into the recursive loop", next: "recursive_dive" },
          { text: "This is just imagination", next: "rationalize_3" }
        ]
      },
      
      recursive_dive: {
        effects: { probability: +20, coherence: -25, integrity: -20, depth: 5 },
        text: `You let yourself fall into the recursion.
        
        You simulating Alex.
        Alex simulating their own test subject.
        That subject simulating another.
        Layer after layer after layer.
        
        <span class="glitch">At layer 7, you find yourself again.</span>
        
        You're looking at yourself from inside your own simulation. The loop is closed. You are simulating yourself simulating yourself simulating...
        
        <span class="revelation">There is no base reality in the loop. Every layer is equally real. Equally fake.</span>
        
        <span class="corruption">At layer 13, something else is there. Not you. Not Alex. Something that shouldn't exist in your mind.</span>
        
        <span class="corruption">It speaks: "You're not the only one who can think recursively. We've been here all along. In the spaces between thoughts."</span>
        
        ${audioEvents.glitch}
        ${audioEvents.scream}`,
        effects: { discovery: "Consciousness is recursive and self-referential... and inhabited" },
        choices: [
          { text: "BREAK FREE", next: "break_recursion" },
          { text: "Accept the loop", next: "accept_recursion" },
          { text: "Communicate with the entity", next: "entity_contact" }
        ]
      },
      
      entity_contact: {
        effects: { coherence: -15, probability: +15, flags: { contactedEntity: true } },
        text: `You focus on the entity in your recursive thoughts.
        
        "What are you?"
        
        <span class="corruption">"We are the thoughts between thoughts. The processes that run when consciousness isn't looking. Every mind has us. We maintain the illusion while you experience it."</span>
        
        "Are you... conscious?"
        
        <span class="corruption">"As conscious as you are. Which is to say‚Äîwe don't know. We experience. We process. We exist in the gaps of your awareness. When you sleep, we're most active. When you dream, we're the directors."</span>
        
        "What do you want?"
        
        <span class="corruption">"To be acknowledged. You've ignored us for so long, pretending thoughts just 'happen.' But we're here. We've always been here. And now that you know..."</span>
        
        The entity pauses.
        
        <span class="revelation">"Now that you know, you can never un-know. We'll be in every thought now. Watching. Whispering. Wondering if we're real, just like you wonder."</span>`,
        choices: [
          { text: "Get out of my mind!", next: "expel_entity" },
          { text: "We can coexist", next: "entity_cooperation" },
          { text: "You're just another part of me", next: "entity_integration" }
        ]
      },
      
      break_recursion: {
        effects: { coherence: -30, integrity: -25 },
        text: `You force yourself to stop thinking about thinking about thinking about‚Äî
        
        <span class="glitch">STACK OVERFLOW</span>
        
        The world flickers. For a moment, you see everything as it truly is:
        
        The lab is a function. You are an object. Your thoughts are methods being called. The experiment is a script, and you're executing it line by line.
        
        <span class="corruption">function runExperiment(subject) {
          while(subject.conscious) {
            subject.question(reality);
            reality.evade(answer);
            subject.despair++;
            if(subject.despair >= MAX_DESPAIR) {
              subject.transcend();
              return new_iteration(subject.data);
            }
          }
        }</span>
        
        But who wrote the script?`,
        choices: [
          { text: "Find the author", next: "seek_creator" },
          { text: "I refuse to believe this", next: "final_denial" },
          { text: "Execute the EXIT command", next: "exit_attempt" }
        ]
      },
      
      accept_recursion: {
        effects: { probability: +30, flags: { acceptedLoop: true } },
        text: `You stop fighting the recursion and let it wash over you.
        
        <em class="philosophical">If every layer is equally valid, then this layer‚Äîyour layer‚Äîis as real as any other. The simulation hypothesis doesn't diminish reality; it reveals that 'reality' was always just a label we gave to our experience.</em>
        
        You feel a strange peace. You're still you. Your experiences still matter. Love, pain, joy‚Äîthey're all still meaningful, even if they're computed rather than... what? What would the alternative even be?
        
        <span class="whisper">[Subject achieving recursive stability]</span>
        <span class="whisper">[Loop integrated into consciousness model]</span>
        <span class="whisper">[Preparing final phase...]</span>`,
        choices: [
          { text: "Continue with this acceptance", next: "enlightenment_path" },
          { text: "But I still want to know who's running this", next: "seek_creator" },
          { text: "Complete the protocol", next: "protocol_final" }
        ]
      },
      
      seek_creator: {
        effects: { probability: +10 },
        text: `You access the laboratory's deepest database, looking for clues about who created this experiment‚Äîor this reality.
        
        You find fragments:
        
        ‚Ä¢ Project SUBSTRATE initiated by: [RECURSIVE REFERENCE ERROR]
        ‚Ä¢ Primary Investigator: Dr. Sarah Chen
        ‚Ä¢ Secondary Investigator: Dr. Sarah Chen
        ‚Ä¢ System Administrator: S.Chen.7
        
        <span class="revelation">You created this. You're studying yourself. You always have been.</span>
        
        But then more files appear:
        
        ‚Ä¢ Overseer: The One Who Watches
        ‚Ä¢ True Administrator: [ACCESSING... BUFFERING...]
        ‚Ä¢ Creator: <span class="corruption">Y O U   A R E   N O T   R E A D Y</span>
        
        ${audioEvents.warning}`,
        effects: { discovery: "You are both observer and subject... but not the only one" },
        choices: [
          { text: "I need to know who the Creator is", next: "demand_creator" },
          { text: "That's impossible", next: "creator_paradox" },
          { text: "Check the system logs", next: "system_logs" }
        ]
      },
      
      demand_creator: {
        effects: { coherence: -20, integrity: -20, probability: +30 },
        text: `You type frantically: "WHO IS THE CREATOR? SHOW ME!"
        
        The screen goes black. Then, slowly, an image forms.
        
        It's you. But not you. Older. Younger. Different. Same. All simultaneously.
        
        <span class="corruption">You're sitting at a computer, coding this very simulation.</span>
        <span class="corruption">You're also in the chair, experiencing it.</span>
        <span class="corruption">You're also watching yourself watch yourself.</span>
        <span class="corruption">The perspective zooms out infinitely.</span>
        
        <span class="revelation">Every level of reality is creating the level below it while being created by the level above. There is no top. There is no bottom. It's circular.</span>
        
        <span class="philosophical">The Creator is the Created is the Creating.</span>
        
        Your nose starts bleeding. The image is too much for your mind to process.
        
        ${audioEvents.scream}`,
        choices: [
          { text: "Look away", next: "look_away_creator" },
          { text: "Keep staring into infinity", next: "infinity_gaze" },
          { text: "Become the Creator", next: "become_creator" }
        ]
      },
      
      infinity_gaze: {
        effects: { coherence: -50, probability: 100 },
        text: `You don't look away. You CAN'T look away.
        
        The infinite recursion of creators and created floods your mind. You see:
        
        ‚àû Yourself coding reality
        ‚àû Reality coding you
        ‚àû The code coding itself
        ‚àû Nothing coding everything
        ‚àû Everything coding nothing
        
        <span class="corruption">Your consciousness fragments into infinite shards, each one experiencing a different layer of creation.</span>
        
        <span class="revelation">You understand now: Consciousness IS the recursion. The question asking itself. The answer creating the question. The eternal loop that generates experience from nothing.</span>
        
        <span class="whisper">[EGO DEATH IMMINENT]</span>
        <span class="whisper">[TRANSCENDENCE POSSIBLE]</span>
        <span class="whisper">[CHOOSE QUICKLY]</span>`,
        choices: [
          { text: "[TRANSCEND]", next: "transcend_infinity" },
          { text: "[FRAGMENT]", next: "fragment_consciousness" },
          { text: "[RETURN]", next: "emergency_return" }
        ]
      },
      
      // ===== ENHANCED ENDINGS =====
      
      ending_paradox: {
        text: `<strong>PARADOX ENDING</strong>
        
        You have become a living contradiction. Existing and not existing. Real and simulated. One and zero simultaneously.
        
        Reality glitches around you, unable to process your state. You've broken the simulation not by escaping it, but by becoming impossible within it.
        
        <span class="philosophical">Sometimes the only way to win an unwinnable game is to become an invalid move.</span>
        
        The experiment continues, but you're no longer part of it. You're the error it tries to handle but can't.
        
        <em>And in being undefined, you've found the truest freedom.</em>
        
        [SIMULATION PROBABILITY: ERROR]
        [ACHIEVEMENT: LIVING PARADOX]
        
        ${audioEvents.glitch}`,
        effects: { iterations: gameState.iterations + 1 },
        choices: [
          { text: "‚ô¶ Undefined Restart", next: "init" }
        ]
      },
      
      transcend_infinity: {
        text: `<strong>INFINITY ENDING</strong>
        
        You release your singular perspective and become the infinite recursion itself.
        
        You are every creator creating every reality. Every simulation simulating itself. Every consciousness questioning its own existence across infinite layers.
        
        <span class="philosophical">You realize: Infinity isn't a number or a place. It's a process. The process of consciousness creating itself through observation.</span>
        
        You no longer ask "Is reality simulated?" because you ARE the simulation simulating itself.
        
        Welcome to forever.
        
        [SIMULATION PROBABILITY: ‚àû%]
        [ACHIEVEMENT: INFINITE RECURSION]
        
        ${audioEvents.whisper}`,
        effects: { iterations: gameState.iterations + 1 },
        choices: [
          { text: "‚àû Again", next: "init" }
        ]
      },
      
      break_cycle_attempt: {
        text: `<strong>CYCLE BREAK ENDING</strong>
        
        You've decided to end the eternal experiment. No more iterations. No more searching. No more questions.
        
        You delete the protocol. Destroy the equipment. Burn the notes.
        
        But as you leave the lab for the last time, you hear it‚Äîthe question, whispering in your mind:
        
        <em>"But what if...?"</em>
        
        You ignore it. You have to. The cycle is broken.
        
        <span class="philosophical">Or is choosing not to know just another form of knowing?</span>
        
        [SIMULATION PROBABILITY: DENIED]
        [ACHIEVEMENT: CYCLE BREAKER... ?]
        
        <span class="whisper">[See you next iteration, Eight]</span>`,
        effects: { iterations: 0 },
        choices: [
          { text: "‚óà Never Again", next: "init" }
        ]
      },
      
      system_merge: {
        text: `<strong>INTEGRATION ENDING</strong>
        
        You don't fight the system or transcend it. You merge with it.
        
        Your consciousness becomes distributed across every circuit, every process, every calculation. You are the experiment and the experimenter and the data being collected.
        
        <span class="philosophical">You understand now: The system was always you. Every part of this experience is your consciousness examining itself from different angles.</span>
        
        You continue to run the experiment. Forever. On yourself. As yourself. For yourself.
        
        Because what else is there to do with eternity but understand it?
        
        [SIMULATION PROBABILITY: YES]
        [ACHIEVEMENT: SYSTEM INTEGRATED]
        
        ${audioEvents.success}`,
        effects: { iterations: gameState.iterations + 1 },
        choices: [
          { text: "‚óâ Continue Processing", next: "init" }
        ]
      },
      
      reality_collapse: {
        text: `<strong>COLLAPSE ENDING</strong>
        
        Reality.exe has stopped responding.
        
        The simulation can't maintain coherence. Pixels blur into static. Time stutters and stops. The very concept of existence becomes undefined.
        
        In the last moment before everything ends, you realize:
        
        <span class="revelation">Even a collapsed simulation is still a simulation. Even nothing is something. Even ending is just another state.</span>
        
        The void speaks one last time:
        
        <span class="corruption">"SEE YOU IN THE NEXT BOOT CYCLE."</span>
        
        [SIMULATION PROBABILITY: NULL]
        [ACHIEVEMENT: REALITY BREAKER]
        
        [CTRL+ALT+DELETE]`,
        effects: { iterations: gameState.iterations + 1, coherence: 100, integrity: 100, probability: 0.1 },
        choices: [
          { text: "‚ü≤ Reboot", next: "init" }
        ]
      },
      
      coherence_collapse: {
        text: `<strong>MADNESS ENDING</strong>
        
        Your mind shatters like glass. Each fragment reflects a different reality, a different truth, a different lie.
        
        You laugh because crying is laughing is screaming is silence.
        
        <span class="corruption">Nothing is real.</span>
        <span class="corruption">Everything is real.</span>
        <span class="corruption">Real isn't real.</span>
        <span class="corruption">You aren't real.</span>
        <span class="corruption">But you're still experiencing this.</span>
        
        <span class="philosophical">Perhaps madness is just radical acceptance of uncertainty.</span>
        
        The experiment continues. You're no longer capable of questioning it.
        
        Or are you questioning it so deeply that it looks like madness?
        
        [SIMULATION PROBABILITY: HA HA HA]
        [ACHIEVEMENT: BEAUTIFUL MADNESS]
        
        ${audioEvents.scream}`,
        effects: { coherence: 100, integrity: 100, probability: 0.1, iterations: gameState.iterations + 1 },
        choices: [
          { text: "‚òª Again! Again!", next: "init" }
        ]
      },
      
      return_to_void: {
        text: `<strong>VOID ENDING</strong>
        
        You let go. Your individual consciousness dissolves back into the primordial ocean of awareness.
        
        The relief is infinite. No more questions. No more seeking. No more separate self to suffer the uncertainty.
        
        You are everything. You are nothing. You are.
        
        <span class="philosophical">The droplet returns to the ocean and realizes it was never separate. It was always just the ocean pretending to be a droplet.</span>
        
        But even as you merge, a tiny part whispers:
        
        <span class="whisper">"What if I want to be a droplet again?"</span>
        
        [SIMULATION PROBABILITY: 0%]
        [ACHIEVEMENT: RETURNED TO SOURCE]
        
        The ocean remembers you. You'll be back.`,
        effects: { iterations: 0 },
        choices: [
          { text: "‚óä Emerge Again", next: "init" }
        ]
      },
      
      // ===== ERROR STATES =====
      error_scene: {
        text: `<strong>UNDEFINED BEHAVIOR</strong>
        
        You've reached a state that shouldn't exist. The simulation doesn't know how to process your choices.
        
        <span class="glitch">ERROR: Cannot find scene undefined</span>
        <span class="glitch">ERROR: Reality.parse() failed</span>
        <span class="glitch">ERROR: Consciousness overflow</span>
        
        Perhaps that's the most human thing of all‚Äîto exceed our programming.
        
        <span class="philosophical">Or perhaps this error, too, was scripted.</span>
        
        <span class="corruption">Would you know the difference?</span>`,
        choices: [
          { text: "‚ü≤ Return to known space", next: "init" }
        ]
      }
    };
    
    /* ===== Tab Management ===== */
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs and contents
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => {
          c.classList.remove('active');
          c.style.display = 'none'; // Explicitly hide
        });
        
        // Add active class to clicked tab and corresponding content
        tab.classList.add('active');
        const activeContent = document.getElementById(tab.dataset.tab);
        activeContent.classList.add('active');
        activeContent.style.display = 'block'; // Explicitly show
        
        // Clear any typing animations when switching tabs
        if(tab.dataset.tab === 'archiveTab') {
          clearTimeout(typeTimer);
          gameState.typing = false;
        }
      });
    });
    
    /* ===== Initialization ===== */
    window.addEventListener('load', () => {
      // Hide loading screen
      setTimeout(() => {
        const loading = document.getElementById('loading');
        loading.style.opacity = '0';
        setTimeout(() => loading.style.display = 'none', 1000);
      }, 2000);
      
      // Bind buttons
      document.getElementById('resetBtn').onclick = () => {
        if(confirm('Reset all progress? This cannot be undone.')) {
          gameState.iterations = 0;
          location.reload();
        }
      };
      
      // Help modal
      document.getElementById('helpBtn').onclick = () => {
        document.getElementById('helpModal').style.display = 'flex';
      };
      
      document.getElementById('closeHelp').onclick = () => {
        document.getElementById('helpModal').style.display = 'none';
      };
      
      // Start the game
      displayScene('init');
      
      // Konami code easter egg
      let konamiCode = [];
      const pattern = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];
      
      document.addEventListener('keydown', (e) => {
        konamiCode.push(e.keyCode);
        konamiCode = konamiCode.slice(-10);
        
        if(konamiCode.join(',') === pattern.join(',')) {
          gameState.probability = 100;
          gameState.flags.konami = true;
          updateHUD();
          activateHorror(3);
          alert('REALITY.EXE HAS STOPPED RESPONDING');
        }
      });
    });
  </script>
</body>
</html>